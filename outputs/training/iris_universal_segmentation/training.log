2025-09-10 17:01:52,418 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-10 17:01:52,418 - __main__ - INFO - ==================================================
2025-09-10 17:01:52,418 - __main__ - INFO - IRIS Framework Training
2025-09-10 17:01:52,418 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-10 17:01:52,418 - __main__ - INFO - ==================================================
2025-09-10 17:01:52,418 - __main__ - INFO - Configuration: train_config.yaml
2025-09-10 17:01:52,418 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-10 17:01:52,419 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-10 17:01:52,419 - __main__ - INFO - Using device: cuda:0
2025-09-10 17:01:52,419 - __main__ - INFO - Loading datasets...
2025-09-10 17:01:52,419 - data_loader - WARNING - Directory ../AUTO_SEGMENTATION_TRAIN does not exist
2025-09-10 17:01:52,419 - data_loader - WARNING - Directory ../AUTO_SEGMENTATION_TEST does not exist
2025-09-10 17:01:52,419 - data_loader - INFO - Found 0 training cases
2025-09-10 17:01:52,419 - data_loader - INFO - Found 0 test cases
2025-09-10 17:01:52,419 - data_loader - INFO - Enhanced Dataset Info:
2025-09-10 17:01:52,419 - data_loader - INFO -  Training cases: 0
2025-09-10 17:01:52,419 - data_loader - INFO -  Test cases: 0
2025-09-10 17:01:52,419 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-10 17:01:52,419 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-10 17:01:52,419 - data_loader - INFO -  Normalization: robust
2025-09-10 17:01:52,419 - data_loader - WARNING - No training cases found!
2025-09-10 17:01:52,419 - __main__ - INFO - Loaded 0 training samples, 0 validation samples
2025-09-10 17:01:52,419 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-10 17:01:52,419 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-10 17:01:52,419 - __main__ - INFO - Creating Iris model...
2025-09-10 17:01:52,984 - __main__ - INFO - Model Information:
2025-09-10 17:01:52,984 - __main__ - INFO -   total_parameters: 38676900
2025-09-10 17:01:52,984 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-10 17:01:52,984 - __main__ - INFO -   embed_dim: 192
2025-09-10 17:01:52,984 - __main__ - INFO -   num_classes: 2
2025-09-10 17:01:52,984 - __main__ - INFO -   deep_supervision: False
2025-09-10 17:01:52,984 - __main__ - INFO -   multi_scale: False
2025-09-10 17:01:52,984 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-10 17:01:54,477 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-10 17:01:54,477 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-10 17:01:54,477 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-10 17:01:54,479 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-10 17:01:54,479 - __main__ - INFO - Starting training...
2025-09-10 17:01:54,479 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-10 17:01:54,480 - __main__ - ERROR - Training failed with error: No available classes for episodic training
2025-09-10 17:01:54,480 - __main__ - ERROR - Failed to complete training: No available classes for episodic training
2025-09-10 17:02:05,156 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-10 17:02:05,156 - __main__ - INFO - ==================================================
2025-09-10 17:02:05,156 - __main__ - INFO - IRIS Framework Training
2025-09-10 17:02:05,156 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-10 17:02:05,156 - __main__ - INFO - ==================================================
2025-09-10 17:02:05,156 - __main__ - INFO - Configuration: train_config.yaml
2025-09-10 17:02:05,156 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-10 17:02:05,156 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-10 17:02:05,156 - __main__ - INFO - Using device: cuda:0
2025-09-10 17:02:05,156 - __main__ - INFO - Loading datasets...
2025-09-10 17:02:05,156 - data_loader - WARNING - Directory ../AUTO_SEGMENTATION_TRAIN does not exist
2025-09-10 17:02:05,156 - data_loader - WARNING - Directory ../AUTO_SEGMENTATION_TEST does not exist
2025-09-10 17:02:05,156 - data_loader - INFO - Found 0 training cases
2025-09-10 17:02:05,156 - data_loader - INFO - Found 0 test cases
2025-09-10 17:02:05,156 - data_loader - INFO - Enhanced Dataset Info:
2025-09-10 17:02:05,156 - data_loader - INFO -  Training cases: 0
2025-09-10 17:02:05,156 - data_loader - INFO -  Test cases: 0
2025-09-10 17:02:05,156 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-10 17:02:05,156 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-10 17:02:05,156 - data_loader - INFO -  Normalization: robust
2025-09-10 17:02:05,156 - data_loader - WARNING - No training cases found!
2025-09-10 17:02:05,156 - __main__ - INFO - Loaded 0 training samples, 0 validation samples
2025-09-10 17:02:05,156 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-10 17:02:05,156 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-10 17:02:05,156 - __main__ - INFO - Creating Iris model...
2025-09-10 17:02:05,491 - __main__ - INFO - Model Information:
2025-09-10 17:02:05,492 - __main__ - INFO -   total_parameters: 38676900
2025-09-10 17:02:05,492 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-10 17:02:05,492 - __main__ - INFO -   embed_dim: 192
2025-09-10 17:02:05,492 - __main__ - INFO -   num_classes: 2
2025-09-10 17:02:05,492 - __main__ - INFO -   deep_supervision: False
2025-09-10 17:02:05,492 - __main__ - INFO -   multi_scale: False
2025-09-10 17:02:05,492 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-10 17:02:07,071 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-10 17:02:07,071 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-10 17:02:07,071 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-10 17:02:07,073 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-10 17:02:07,073 - __main__ - INFO - Starting training...
2025-09-10 17:02:07,073 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-10 17:02:07,074 - __main__ - ERROR - Training failed with error: No available classes for episodic training
2025-09-10 17:02:07,074 - __main__ - ERROR - Failed to complete training: No available classes for episodic training
2025-09-10 17:13:11,110 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-10 17:13:11,110 - __main__ - INFO - ==================================================
2025-09-10 17:13:11,110 - __main__ - INFO - IRIS Framework Training
2025-09-10 17:13:11,110 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-10 17:13:11,110 - __main__ - INFO - ==================================================
2025-09-10 17:13:11,110 - __main__ - INFO - Configuration: train_config.yaml
2025-09-10 17:13:11,110 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-10 17:13:11,110 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-10 17:13:11,110 - __main__ - INFO - Using device: cuda:0
2025-09-10 17:13:11,110 - __main__ - INFO - Loading datasets...
2025-09-10 17:13:11,111 - data_loader - INFO - Found 31 training cases
2025-09-10 17:13:11,111 - data_loader - INFO - Found 4 test cases
2025-09-10 17:13:11,111 - data_loader - INFO - Enhanced Dataset Info:
2025-09-10 17:13:11,111 - data_loader - INFO -  Training cases: 31
2025-09-10 17:13:11,111 - data_loader - INFO -  Test cases: 4
2025-09-10 17:13:11,111 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-10 17:13:11,111 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-10 17:13:11,111 - data_loader - INFO -  Normalization: robust
2025-09-10 17:13:11,111 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-10 17:13:18,234 - data_loader - INFO - Global statistics computed:
2025-09-10 17:13:18,235 - data_loader - INFO -   Mean: -55.44
2025-09-10 17:13:18,235 - data_loader - INFO -   Std: 100.41
2025-09-10 17:13:18,235 - data_loader - INFO -   Median: -125.00
2025-09-10 17:13:18,237 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-10 17:13:19,206 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-10 17:13:19,206 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 17:13:19,206 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 17:13:20,402 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-10 17:13:20,403 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 17:13:20,403 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 17:13:21,604 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-10 17:13:21,604 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 17:13:21,604 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 17:13:45,112 - data_loader - INFO - Successfully loaded 25 cases
2025-09-10 17:13:45,113 - data_loader - INFO - Loading 4 test cases...
2025-09-10 17:13:49,862 - data_loader - INFO - Final enhanced dataset:
2025-09-10 17:13:49,862 - data_loader - INFO -  Training: 25 cases
2025-09-10 17:13:49,863 - data_loader - INFO -  Validation: 4 cases
2025-09-10 17:13:49,863 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 17:13:49,867 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 17:13:49,867 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-10 17:13:50,000 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-10 17:13:50,000 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-10 17:13:50,000 - __main__ - INFO - Creating Iris model...
2025-09-10 17:13:50,397 - __main__ - INFO - Model Information:
2025-09-10 17:13:50,397 - __main__ - INFO -   total_parameters: 38676900
2025-09-10 17:13:50,397 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-10 17:13:50,398 - __main__ - INFO -   embed_dim: 192
2025-09-10 17:13:50,398 - __main__ - INFO -   num_classes: 2
2025-09-10 17:13:50,398 - __main__ - INFO -   deep_supervision: False
2025-09-10 17:13:50,398 - __main__ - INFO -   multi_scale: False
2025-09-10 17:13:50,398 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-10 17:13:51,940 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-10 17:13:51,940 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-10 17:13:51,940 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-10 17:13:51,941 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-10 17:13:51,941 - __main__ - INFO - Starting training...
2025-09-10 17:13:51,941 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-10 17:13:59,262 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-09-10 17:15:25,794 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-10 17:15:25,794 - __main__ - INFO - ==================================================
2025-09-10 17:15:25,794 - __main__ - INFO - IRIS Framework Training
2025-09-10 17:15:25,794 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-10 17:15:25,794 - __main__ - INFO - ==================================================
2025-09-10 17:15:25,794 - __main__ - INFO - Configuration: train_config.yaml
2025-09-10 17:15:25,794 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-10 17:15:25,794 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-10 17:15:25,794 - __main__ - INFO - Using device: cuda:0
2025-09-10 17:15:25,794 - __main__ - INFO - Loading datasets...
2025-09-10 17:15:25,795 - data_loader - INFO - Found 31 training cases
2025-09-10 17:15:25,795 - data_loader - INFO - Found 4 test cases
2025-09-10 17:15:25,795 - data_loader - INFO - Enhanced Dataset Info:
2025-09-10 17:15:25,795 - data_loader - INFO -  Training cases: 31
2025-09-10 17:15:25,795 - data_loader - INFO -  Test cases: 4
2025-09-10 17:15:25,795 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-10 17:15:25,795 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-10 17:15:25,795 - data_loader - INFO -  Normalization: robust
2025-09-10 17:15:25,795 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-10 17:15:32,831 - data_loader - INFO - Global statistics computed:
2025-09-10 17:15:32,831 - data_loader - INFO -   Mean: -55.44
2025-09-10 17:15:32,831 - data_loader - INFO -   Std: 100.41
2025-09-10 17:15:32,831 - data_loader - INFO -   Median: -125.00
2025-09-10 17:15:32,833 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-10 17:15:33,771 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-10 17:15:33,772 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 17:15:33,772 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 17:15:34,949 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-10 17:15:34,949 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 17:15:34,949 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 17:15:36,125 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-10 17:15:36,125 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 17:15:36,125 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 17:15:59,632 - data_loader - INFO - Successfully loaded 25 cases
2025-09-10 17:15:59,633 - data_loader - INFO - Loading 4 test cases...
2025-09-10 17:16:04,145 - data_loader - INFO - Final enhanced dataset:
2025-09-10 17:16:04,145 - data_loader - INFO -  Training: 25 cases
2025-09-10 17:16:04,146 - data_loader - INFO -  Validation: 4 cases
2025-09-10 17:16:04,146 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 17:16:04,149 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 17:16:04,149 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-10 17:16:04,285 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-10 17:16:04,285 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-10 17:16:04,285 - __main__ - INFO - Creating Iris model...
2025-09-10 17:16:04,618 - __main__ - INFO - Model Information:
2025-09-10 17:16:04,618 - __main__ - INFO -   total_parameters: 38676900
2025-09-10 17:16:04,618 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-10 17:16:04,618 - __main__ - INFO -   embed_dim: 192
2025-09-10 17:16:04,618 - __main__ - INFO -   num_classes: 2
2025-09-10 17:16:04,618 - __main__ - INFO -   deep_supervision: False
2025-09-10 17:16:04,618 - __main__ - INFO -   multi_scale: False
2025-09-10 17:16:04,618 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-10 17:16:06,087 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-10 17:16:06,087 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-10 17:16:06,087 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-10 17:16:06,088 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-10 17:16:06,088 - __main__ - INFO - Starting training...
2025-09-10 17:16:06,088 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-10 17:16:13,577 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-09-10 18:10:08,299 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-09-10 18:11:28,047 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-10 18:11:28,047 - __main__ - INFO - ==================================================
2025-09-10 18:11:28,047 - __main__ - INFO - IRIS Framework Training
2025-09-10 18:11:28,047 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-10 18:11:28,047 - __main__ - INFO - ==================================================
2025-09-10 18:11:28,047 - __main__ - INFO - Configuration: train_config.yaml
2025-09-10 18:11:28,047 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-10 18:11:28,047 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-10 18:11:28,047 - __main__ - INFO - Using device: cuda:7
2025-09-10 18:11:28,047 - __main__ - INFO - Loading datasets...
2025-09-10 18:11:28,047 - data_loader - INFO - Found 31 training cases
2025-09-10 18:11:28,047 - data_loader - INFO - Found 4 test cases
2025-09-10 18:11:28,048 - data_loader - INFO - Enhanced Dataset Info:
2025-09-10 18:11:28,048 - data_loader - INFO -  Training cases: 31
2025-09-10 18:11:28,048 - data_loader - INFO -  Test cases: 4
2025-09-10 18:11:28,048 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-10 18:11:28,048 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-10 18:11:28,048 - data_loader - INFO -  Normalization: robust
2025-09-10 18:11:28,048 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-10 18:11:35,362 - data_loader - INFO - Global statistics computed:
2025-09-10 18:11:35,363 - data_loader - INFO -   Mean: -55.44
2025-09-10 18:11:35,363 - data_loader - INFO -   Std: 100.41
2025-09-10 18:11:35,363 - data_loader - INFO -   Median: -125.00
2025-09-10 18:11:35,364 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-10 18:11:36,316 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-10 18:11:36,317 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 18:11:36,317 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 18:11:37,516 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-10 18:11:37,517 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 18:11:37,517 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 18:11:38,745 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-10 18:11:38,746 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 18:11:38,746 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 18:12:02,344 - data_loader - INFO - Successfully loaded 25 cases
2025-09-10 18:12:02,344 - data_loader - INFO - Loading 4 test cases...
2025-09-10 18:12:07,264 - data_loader - INFO - Final enhanced dataset:
2025-09-10 18:12:07,264 - data_loader - INFO -  Training: 25 cases
2025-09-10 18:12:07,264 - data_loader - INFO -  Validation: 4 cases
2025-09-10 18:12:07,265 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 18:12:07,268 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 18:12:07,268 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-10 18:12:07,390 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-10 18:12:07,391 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-10 18:12:07,391 - __main__ - INFO - Creating Iris model...
2025-09-10 18:12:07,722 - __main__ - INFO - Model Information:
2025-09-10 18:12:07,722 - __main__ - INFO -   total_parameters: 38676900
2025-09-10 18:12:07,722 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-10 18:12:07,722 - __main__ - INFO -   embed_dim: 192
2025-09-10 18:12:07,722 - __main__ - INFO -   num_classes: 2
2025-09-10 18:12:07,722 - __main__ - INFO -   deep_supervision: False
2025-09-10 18:12:07,722 - __main__ - INFO -   multi_scale: False
2025-09-10 18:12:07,722 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-10 18:12:07,961 - __main__ - ERROR - Failed to complete training: CUDA error: invalid device ordinal
CUDA kernel errors might be asynchronously reported at some other API call, so the stacktrace below might be incorrect.
For debugging consider passing CUDA_LAUNCH_BLOCKING=1
Compile with `TORCH_USE_CUDA_DSA` to enable device-side assertions.

2025-09-10 18:14:41,993 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-10 18:14:41,993 - __main__ - INFO - ==================================================
2025-09-10 18:14:41,993 - __main__ - INFO - IRIS Framework Training
2025-09-10 18:14:41,993 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-10 18:14:41,993 - __main__ - INFO - ==================================================
2025-09-10 18:14:41,993 - __main__ - INFO - Configuration: train_config.yaml
2025-09-10 18:14:41,993 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-10 18:14:41,993 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-10 18:14:42,115 - __main__ - INFO - Using device: cuda
2025-09-10 18:14:42,116 - __main__ - INFO - Loading datasets...
2025-09-10 18:14:42,116 - data_loader - INFO - Found 31 training cases
2025-09-10 18:14:42,116 - data_loader - INFO - Found 4 test cases
2025-09-10 18:14:42,116 - data_loader - INFO - Enhanced Dataset Info:
2025-09-10 18:14:42,116 - data_loader - INFO -  Training cases: 31
2025-09-10 18:14:42,116 - data_loader - INFO -  Test cases: 4
2025-09-10 18:14:42,116 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-10 18:14:42,116 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-10 18:14:42,116 - data_loader - INFO -  Normalization: robust
2025-09-10 18:14:42,116 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-10 18:14:49,084 - data_loader - INFO - Global statistics computed:
2025-09-10 18:14:49,084 - data_loader - INFO -   Mean: -55.44
2025-09-10 18:14:49,084 - data_loader - INFO -   Std: 100.41
2025-09-10 18:14:49,084 - data_loader - INFO -   Median: -125.00
2025-09-10 18:14:49,086 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-10 18:14:50,061 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-10 18:14:50,062 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 18:14:50,062 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 18:14:51,202 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-10 18:14:51,202 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 18:14:51,202 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 18:14:52,354 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-10 18:14:52,354 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 18:14:52,354 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 18:15:16,881 - data_loader - INFO - Successfully loaded 25 cases
2025-09-10 18:15:16,881 - data_loader - INFO - Loading 4 test cases...
2025-09-10 18:15:21,336 - data_loader - INFO - Final enhanced dataset:
2025-09-10 18:15:21,336 - data_loader - INFO -  Training: 25 cases
2025-09-10 18:15:21,336 - data_loader - INFO -  Validation: 4 cases
2025-09-10 18:15:21,337 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-10 18:15:21,339 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-10 18:15:21,340 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-10 18:15:21,454 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-10 18:15:21,454 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-10 18:15:21,454 - __main__ - INFO - Creating Iris model...
2025-09-10 18:15:21,781 - __main__ - INFO - Model Information:
2025-09-10 18:15:21,781 - __main__ - INFO -   total_parameters: 38676900
2025-09-10 18:15:21,781 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-10 18:15:21,781 - __main__ - INFO -   embed_dim: 192
2025-09-10 18:15:21,781 - __main__ - INFO -   num_classes: 2
2025-09-10 18:15:21,781 - __main__ - INFO -   deep_supervision: False
2025-09-10 18:15:21,781 - __main__ - INFO -   multi_scale: False
2025-09-10 18:15:21,781 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-10 18:15:22,662 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-10 18:15:22,662 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-10 18:15:22,662 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-10 18:15:22,664 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-10 18:15:22,664 - __main__ - INFO - Starting training...
2025-09-10 18:15:22,664 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-10 18:15:25,216 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-09-10 18:30:11,088 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-09-10 18:50:47,436 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_1000.pth
2025-09-10 19:30:43,918 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_2000.pth
2025-09-10 20:05:36,960 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_3000.pth
2025-09-10 20:44:00,847 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_4000.pth
2025-09-10 21:17:56,136 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_5000.pth
2025-09-10 21:56:19,028 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_6000.pth
2025-09-10 22:30:00,409 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_7000.pth
2025-09-10 23:03:39,874 - __main__ - INFO - Training completed! Final validation DICE: 0.0108
2025-09-10 23:03:39,891 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-09-10 23:03:39,891 - __main__ - INFO - Running inference demonstration...
2025-09-10 23:03:39,906 - __main__ - INFO - Inference demo completed!
2025-09-10 23:03:39,906 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-09-10 23:03:39,906 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-09-10 23:03:39,962 - __main__ - INFO - Sample prediction density: 0.5715
2025-09-10 23:03:39,962 - __main__ - INFO - Training and demonstration completed successfully!
2025-09-24 15:45:42,220 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-24 15:45:42,221 - __main__ - INFO - ==================================================
2025-09-24 15:45:42,221 - __main__ - INFO - IRIS Framework Training
2025-09-24 15:45:42,221 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-24 15:45:42,221 - __main__ - INFO - ==================================================
2025-09-24 15:45:42,221 - __main__ - INFO - Configuration: train_config.yaml
2025-09-24 15:45:42,221 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-24 15:45:42,221 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-24 15:45:42,317 - __main__ - INFO - Using device: cuda
2025-09-24 15:45:42,317 - __main__ - INFO - Loading datasets...
2025-09-24 15:45:42,325 - data_loader - INFO - Found 31 training cases
2025-09-24 15:45:42,325 - data_loader - INFO - Found 4 test cases
2025-09-24 15:45:42,325 - data_loader - INFO - Enhanced Dataset Info:
2025-09-24 15:45:42,325 - data_loader - INFO -  Training cases: 31
2025-09-24 15:45:42,325 - data_loader - INFO -  Test cases: 4
2025-09-24 15:45:42,325 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-24 15:45:42,325 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-24 15:45:42,325 - data_loader - INFO -  Normalization: robust
2025-09-24 15:45:42,325 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-24 15:45:49,359 - data_loader - INFO - Global statistics computed:
2025-09-24 15:45:49,360 - data_loader - INFO -   Mean: -55.44
2025-09-24 15:45:49,360 - data_loader - INFO -   Std: 100.41
2025-09-24 15:45:49,360 - data_loader - INFO -   Median: -125.00
2025-09-24 15:45:49,361 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-24 15:45:50,375 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-24 15:45:50,376 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:45:50,376 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:45:51,640 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-24 15:45:51,640 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:45:51,640 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:45:52,881 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-24 15:45:52,881 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:45:52,882 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:46:17,377 - data_loader - INFO - Successfully loaded 25 cases
2025-09-24 15:46:17,377 - data_loader - INFO - Loading 4 test cases...
2025-09-24 15:46:22,085 - data_loader - INFO - Final enhanced dataset:
2025-09-24 15:46:22,085 - data_loader - INFO -  Training: 25 cases
2025-09-24 15:46:22,085 - data_loader - INFO -  Validation: 4 cases
2025-09-24 15:46:22,086 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:46:22,089 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:46:22,089 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-24 15:46:22,215 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-24 15:46:22,215 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-24 15:46:22,215 - __main__ - INFO - Creating Iris model...
2025-09-24 15:46:22,549 - __main__ - INFO - Model Information:
2025-09-24 15:46:22,549 - __main__ - INFO -   total_parameters: 38676900
2025-09-24 15:46:22,549 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-24 15:46:22,549 - __main__ - INFO -   embed_dim: 192
2025-09-24 15:46:22,549 - __main__ - INFO -   num_classes: 2
2025-09-24 15:46:22,549 - __main__ - INFO -   deep_supervision: False
2025-09-24 15:46:22,549 - __main__ - INFO -   multi_scale: False
2025-09-24 15:46:22,549 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-24 15:46:23,808 - __main__ - ERROR - Failed to complete training: 'FixedEpisodicTrainer' object has no attribute 'maxiterations'
2025-09-24 15:49:00,641 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-24 15:49:00,641 - __main__ - INFO - ==================================================
2025-09-24 15:49:00,641 - __main__ - INFO - IRIS Framework Training
2025-09-24 15:49:00,641 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-24 15:49:00,641 - __main__ - INFO - ==================================================
2025-09-24 15:49:00,641 - __main__ - INFO - Configuration: train_config.yaml
2025-09-24 15:49:00,641 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-24 15:49:00,641 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-24 15:49:00,736 - __main__ - INFO - Using device: cuda
2025-09-24 15:49:00,736 - __main__ - INFO - Loading datasets...
2025-09-24 15:49:00,737 - data_loader - INFO - Found 31 training cases
2025-09-24 15:49:00,737 - data_loader - INFO - Found 4 test cases
2025-09-24 15:49:00,737 - data_loader - INFO - Enhanced Dataset Info:
2025-09-24 15:49:00,737 - data_loader - INFO -  Training cases: 31
2025-09-24 15:49:00,737 - data_loader - INFO -  Test cases: 4
2025-09-24 15:49:00,737 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-24 15:49:00,737 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-24 15:49:00,737 - data_loader - INFO -  Normalization: robust
2025-09-24 15:49:00,737 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-24 15:49:07,808 - data_loader - INFO - Global statistics computed:
2025-09-24 15:49:07,808 - data_loader - INFO -   Mean: -55.44
2025-09-24 15:49:07,808 - data_loader - INFO -   Std: 100.41
2025-09-24 15:49:07,808 - data_loader - INFO -   Median: -125.00
2025-09-24 15:49:07,810 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-24 15:49:08,883 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-24 15:49:08,883 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:49:08,883 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:49:10,044 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-24 15:49:10,044 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:49:10,044 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:49:11,200 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-24 15:49:11,200 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:49:11,200 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:49:35,185 - data_loader - INFO - Successfully loaded 25 cases
2025-09-24 15:49:35,185 - data_loader - INFO - Loading 4 test cases...
2025-09-24 15:49:39,619 - data_loader - INFO - Final enhanced dataset:
2025-09-24 15:49:39,619 - data_loader - INFO -  Training: 25 cases
2025-09-24 15:49:39,619 - data_loader - INFO -  Validation: 4 cases
2025-09-24 15:49:39,619 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:49:39,622 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:49:39,622 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-24 15:49:39,750 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-24 15:49:39,750 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-24 15:49:39,750 - __main__ - INFO - Creating Iris model...
2025-09-24 15:49:40,076 - __main__ - INFO - Model Information:
2025-09-24 15:49:40,076 - __main__ - INFO -   total_parameters: 38676900
2025-09-24 15:49:40,076 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-24 15:49:40,076 - __main__ - INFO -   embed_dim: 192
2025-09-24 15:49:40,076 - __main__ - INFO -   num_classes: 2
2025-09-24 15:49:40,076 - __main__ - INFO -   deep_supervision: False
2025-09-24 15:49:40,076 - __main__ - INFO -   multi_scale: False
2025-09-24 15:49:40,076 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-24 15:49:40,862 - __main__ - ERROR - Failed to complete training: 'FixedEpisodicTrainer' object has no attribute 'episode_length'
2025-09-24 15:50:19,309 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-24 15:50:19,310 - __main__ - INFO - ==================================================
2025-09-24 15:50:19,310 - __main__ - INFO - IRIS Framework Training
2025-09-24 15:50:19,310 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-24 15:50:19,310 - __main__ - INFO - ==================================================
2025-09-24 15:50:19,310 - __main__ - INFO - Configuration: train_config.yaml
2025-09-24 15:50:19,310 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-24 15:50:19,310 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-24 15:50:19,393 - __main__ - INFO - Using device: cuda
2025-09-24 15:50:19,393 - __main__ - INFO - Loading datasets...
2025-09-24 15:50:19,394 - data_loader - INFO - Found 31 training cases
2025-09-24 15:50:19,394 - data_loader - INFO - Found 4 test cases
2025-09-24 15:50:19,394 - data_loader - INFO - Enhanced Dataset Info:
2025-09-24 15:50:19,394 - data_loader - INFO -  Training cases: 31
2025-09-24 15:50:19,394 - data_loader - INFO -  Test cases: 4
2025-09-24 15:50:19,394 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-24 15:50:19,394 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-24 15:50:19,394 - data_loader - INFO -  Normalization: robust
2025-09-24 15:50:19,394 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-24 15:50:26,813 - data_loader - INFO - Global statistics computed:
2025-09-24 15:50:26,814 - data_loader - INFO -   Mean: -55.44
2025-09-24 15:50:26,814 - data_loader - INFO -   Std: 100.41
2025-09-24 15:50:26,814 - data_loader - INFO -   Median: -125.00
2025-09-24 15:50:26,816 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-24 15:50:27,826 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-24 15:50:27,827 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:50:27,827 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:50:29,103 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-24 15:50:29,104 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:50:29,104 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:50:30,387 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-24 15:50:30,387 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:50:30,387 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:50:55,438 - data_loader - INFO - Successfully loaded 25 cases
2025-09-24 15:50:55,438 - data_loader - INFO - Loading 4 test cases...
2025-09-24 15:51:00,252 - data_loader - INFO - Final enhanced dataset:
2025-09-24 15:51:00,252 - data_loader - INFO -  Training: 25 cases
2025-09-24 15:51:00,252 - data_loader - INFO -  Validation: 4 cases
2025-09-24 15:51:00,293 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 15:51:00,321 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 15:51:00,321 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-24 15:51:00,423 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-24 15:51:00,424 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-24 15:51:00,424 - __main__ - INFO - Creating Iris model...
2025-09-24 15:51:00,826 - __main__ - INFO - Model Information:
2025-09-24 15:51:00,826 - __main__ - INFO -   total_parameters: 38676900
2025-09-24 15:51:00,826 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-24 15:51:00,826 - __main__ - INFO -   embed_dim: 192
2025-09-24 15:51:00,826 - __main__ - INFO -   num_classes: 2
2025-09-24 15:51:00,826 - __main__ - INFO -   deep_supervision: False
2025-09-24 15:51:00,826 - __main__ - INFO -   multi_scale: False
2025-09-24 15:51:00,826 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-24 15:51:01,694 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-24 15:51:01,695 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-24 15:51:01,695 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-24 15:51:01,696 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-24 15:51:01,696 - __main__ - INFO - Starting training...
2025-09-24 15:51:01,696 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-24 15:51:04,489 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-09-24 16:05:48,301 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-09-24 16:25:35,813 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_1000.pth
2025-09-24 17:04:21,813 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_2000.pth
2025-09-24 17:38:16,502 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_3000.pth
2025-09-24 18:17:35,462 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_4000.pth
2025-09-24 18:52:51,012 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_5000.pth
2025-09-24 19:16:46,203 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-09-24 19:31:13,301 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_6000.pth
2025-09-24 20:05:05,323 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_7000.pth
2025-09-24 20:39:04,874 - __main__ - INFO - Training completed! Final validation DICE: 0.0105
2025-09-24 20:39:04,892 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-09-24 20:39:04,893 - __main__ - INFO - Running inference demonstration...
2025-09-24 20:39:04,908 - __main__ - INFO - Inference demo completed!
2025-09-24 20:39:04,908 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-09-24 20:39:04,908 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-09-24 20:39:04,964 - __main__ - INFO - Sample prediction density: 0.5504
2025-09-24 20:39:04,964 - __main__ - INFO - Running real inference on test set...
2025-09-24 20:39:04,966 - data_loader - INFO - Found 31 training cases
2025-09-24 20:39:04,966 - data_loader - INFO - Found 4 test cases
2025-09-24 20:39:04,966 - data_loader - INFO - Enhanced Dataset Info:
2025-09-24 20:39:04,966 - data_loader - INFO -  Training cases: 31
2025-09-24 20:39:04,966 - data_loader - INFO -  Test cases: 4
2025-09-24 20:39:04,966 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-24 20:39:04,966 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-24 20:39:04,966 - data_loader - INFO -  Normalization: robust
2025-09-24 20:39:04,966 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-24 20:39:11,280 - data_loader - INFO - Global statistics computed:
2025-09-24 20:39:11,281 - data_loader - INFO -   Mean: -55.44
2025-09-24 20:39:11,281 - data_loader - INFO -   Std: 100.41
2025-09-24 20:39:11,281 - data_loader - INFO -   Median: -125.00
2025-09-24 20:39:11,282 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-24 20:39:12,164 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-24 20:39:12,165 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 20:39:12,165 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 20:39:13,269 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-24 20:39:13,269 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 20:39:13,269 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 20:39:14,493 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-24 20:39:14,494 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 20:39:14,494 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 20:39:37,676 - data_loader - INFO - Successfully loaded 25 cases
2025-09-24 20:39:37,677 - data_loader - INFO - Loading 4 test cases...
2025-09-24 20:39:42,026 - data_loader - INFO - Final enhanced dataset:
2025-09-24 20:39:42,027 - data_loader - INFO -  Training: 25 cases
2025-09-24 20:39:42,027 - data_loader - INFO -  Validation: 4 cases
2025-09-24 20:39:42,027 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-24 20:39:42,030 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-24 20:39:42,042 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-09-24 20:39:42,042 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-09-24 20:39:42,097 - __main__ - INFO - Sample prediction density: 0.4849
2025-09-24 20:39:42,097 - __main__ - INFO - Training and demonstration completed successfully!
2025-09-26 06:05:02,545 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-26 06:05:02,545 - __main__ - INFO - ==================================================
2025-09-26 06:05:02,545 - __main__ - INFO - IRIS Framework Training
2025-09-26 06:05:02,545 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-26 06:05:02,545 - __main__ - INFO - ==================================================
2025-09-26 06:05:02,545 - __main__ - INFO - Configuration: train_config.yaml
2025-09-26 06:05:02,545 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-26 06:05:02,545 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-26 06:05:04,523 - __main__ - INFO - Using device: cuda
2025-09-26 06:05:04,524 - __main__ - INFO - Loading datasets...
2025-09-26 06:05:04,525 - data_loader - INFO - Found 31 training cases
2025-09-26 06:05:04,525 - data_loader - INFO - Found 4 test cases
2025-09-26 06:05:04,525 - data_loader - INFO - Enhanced Dataset Info:
2025-09-26 06:05:04,525 - data_loader - INFO -  Training cases: 31
2025-09-26 06:05:04,525 - data_loader - INFO -  Test cases: 4
2025-09-26 06:05:04,525 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-26 06:05:04,525 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-26 06:05:04,525 - data_loader - INFO -  Normalization: robust
2025-09-26 06:05:04,525 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-26 06:05:11,291 - data_loader - INFO - Global statistics computed:
2025-09-26 06:05:11,291 - data_loader - INFO -   Mean: -55.44
2025-09-26 06:05:11,291 - data_loader - INFO -   Std: 100.41
2025-09-26 06:05:11,291 - data_loader - INFO -   Median: -125.00
2025-09-26 06:05:11,293 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-26 06:05:12,215 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-26 06:05:12,216 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 06:05:12,216 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 06:05:13,326 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-26 06:05:13,326 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 06:05:13,326 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 06:05:14,477 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-26 06:05:14,478 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 06:05:14,478 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 06:05:37,702 - data_loader - INFO - Successfully loaded 25 cases
2025-09-26 06:05:37,702 - data_loader - INFO - Loading 4 test cases...
2025-09-26 06:05:42,167 - data_loader - INFO - Final enhanced dataset:
2025-09-26 06:05:42,168 - data_loader - INFO -  Training: 25 cases
2025-09-26 06:05:42,168 - data_loader - INFO -  Validation: 4 cases
2025-09-26 06:05:42,168 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 06:05:42,171 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 06:05:42,171 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-26 06:05:42,304 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-26 06:05:42,304 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-26 06:05:42,304 - __main__ - INFO - Creating Iris model...
2025-09-26 06:05:42,817 - __main__ - INFO - Model Information:
2025-09-26 06:05:42,817 - __main__ - INFO -   total_parameters: 38676900
2025-09-26 06:05:42,817 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-26 06:05:42,818 - __main__ - INFO -   embed_dim: 192
2025-09-26 06:05:42,818 - __main__ - INFO -   num_classes: 2
2025-09-26 06:05:42,818 - __main__ - INFO -   deep_supervision: False
2025-09-26 06:05:42,818 - __main__ - INFO -   multi_scale: False
2025-09-26 06:05:42,818 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-26 06:05:43,915 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-26 06:05:43,915 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-26 06:05:43,915 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-26 06:05:43,916 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-26 06:05:43,916 - __main__ - INFO - Starting training...
2025-09-26 06:05:43,916 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-26 06:05:46,848 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-09-26 06:20:06,510 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-09-26 06:25:31,874 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-26 06:25:31,874 - __main__ - INFO - ==================================================
2025-09-26 06:25:31,874 - __main__ - INFO - IRIS Framework Training
2025-09-26 06:25:31,874 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-26 06:25:31,874 - __main__ - INFO - ==================================================
2025-09-26 06:25:31,874 - __main__ - INFO - Configuration: train_config.yaml
2025-09-26 06:25:31,874 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-26 06:25:31,874 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-26 06:25:32,024 - __main__ - INFO - Using device: cuda
2025-09-26 06:25:32,025 - __main__ - INFO - Loading datasets...
2025-09-26 06:25:32,025 - data_loader - INFO - Found 31 training cases
2025-09-26 06:25:32,025 - data_loader - INFO - Found 4 test cases
2025-09-26 06:25:32,025 - data_loader - INFO - Enhanced Dataset Info:
2025-09-26 06:25:32,025 - data_loader - INFO -  Training cases: 31
2025-09-26 06:25:32,025 - data_loader - INFO -  Test cases: 4
2025-09-26 06:25:32,025 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-26 06:25:32,025 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-26 06:25:32,025 - data_loader - INFO -  Normalization: robust
2025-09-26 06:25:32,025 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-26 06:25:38,623 - data_loader - INFO - Global statistics computed:
2025-09-26 06:25:38,623 - data_loader - INFO -   Mean: -55.44
2025-09-26 06:25:38,623 - data_loader - INFO -   Std: 100.41
2025-09-26 06:25:38,623 - data_loader - INFO -   Median: -125.00
2025-09-26 06:25:38,625 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-26 06:25:39,590 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-26 06:25:39,591 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 06:25:39,591 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 06:25:40,782 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-26 06:25:40,782 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 06:25:40,782 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 06:25:41,908 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-26 06:25:41,908 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 06:25:41,908 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 06:26:05,058 - data_loader - INFO - Successfully loaded 25 cases
2025-09-26 06:26:05,059 - data_loader - INFO - Loading 4 test cases...
2025-09-26 06:26:09,549 - data_loader - INFO - Final enhanced dataset:
2025-09-26 06:26:09,549 - data_loader - INFO -  Training: 25 cases
2025-09-26 06:26:09,549 - data_loader - INFO -  Validation: 4 cases
2025-09-26 06:26:09,549 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 06:26:09,552 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 06:26:09,552 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-26 06:26:09,689 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-26 06:26:09,690 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-26 06:26:09,690 - __main__ - INFO - Creating Iris model...
2025-09-26 06:26:10,022 - __main__ - INFO - Model Information:
2025-09-26 06:26:10,022 - __main__ - INFO -   total_parameters: 38676900
2025-09-26 06:26:10,022 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-26 06:26:10,022 - __main__ - INFO -   embed_dim: 192
2025-09-26 06:26:10,022 - __main__ - INFO -   num_classes: 2
2025-09-26 06:26:10,022 - __main__ - INFO -   deep_supervision: False
2025-09-26 06:26:10,022 - __main__ - INFO -   multi_scale: False
2025-09-26 06:26:10,022 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-26 06:26:10,811 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-26 06:26:10,812 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-26 06:26:10,812 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-26 06:26:10,813 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-26 06:26:10,813 - __main__ - INFO - Starting training...
2025-09-26 06:26:10,813 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-26 06:26:13,345 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-09-26 06:40:34,354 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-09-26 06:59:53,828 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_1000.pth
2025-09-26 07:37:59,420 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_2000.pth
2025-09-26 08:11:38,531 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_3000.pth
2025-09-26 08:49:43,785 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_4000.pth
2025-09-26 09:23:26,576 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_5000.pth
2025-09-26 10:01:30,833 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_6000.pth
2025-09-26 10:35:11,141 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_7000.pth
2025-09-26 11:08:47,961 - __main__ - INFO - Training completed! Final validation DICE: 0.0137
2025-09-26 11:08:47,977 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-09-26 11:08:47,978 - __main__ - INFO - Running inference demonstration...
2025-09-26 11:08:47,991 - __main__ - INFO - Inference demo completed!
2025-09-26 11:08:47,992 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-09-26 11:08:47,992 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-09-26 11:08:48,048 - __main__ - INFO - Sample prediction density: 0.5398
2025-09-26 11:08:48,048 - __main__ - INFO - Running real inference on test set...
2025-09-26 11:08:48,050 - data_loader - INFO - Found 31 training cases
2025-09-26 11:08:48,050 - data_loader - INFO - Found 4 test cases
2025-09-26 11:08:48,050 - data_loader - INFO - Enhanced Dataset Info:
2025-09-26 11:08:48,050 - data_loader - INFO -  Training cases: 31
2025-09-26 11:08:48,050 - data_loader - INFO -  Test cases: 4
2025-09-26 11:08:48,050 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-26 11:08:48,050 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-26 11:08:48,050 - data_loader - INFO -  Normalization: robust
2025-09-26 11:08:48,050 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-26 11:08:54,892 - data_loader - INFO - Global statistics computed:
2025-09-26 11:08:54,892 - data_loader - INFO -   Mean: -55.44
2025-09-26 11:08:54,892 - data_loader - INFO -   Std: 100.41
2025-09-26 11:08:54,892 - data_loader - INFO -   Median: -125.00
2025-09-26 11:08:54,893 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-26 11:08:55,851 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-26 11:08:55,851 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 11:08:55,851 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 11:08:57,041 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-26 11:08:57,041 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 11:08:57,041 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 11:08:58,231 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-26 11:08:58,231 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 11:08:58,232 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 11:09:22,341 - data_loader - INFO - Successfully loaded 25 cases
2025-09-26 11:09:22,341 - data_loader - INFO - Loading 4 test cases...
2025-09-26 11:09:26,956 - data_loader - INFO - Final enhanced dataset:
2025-09-26 11:09:26,956 - data_loader - INFO -  Training: 25 cases
2025-09-26 11:09:26,956 - data_loader - INFO -  Validation: 4 cases
2025-09-26 11:09:26,957 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 11:09:26,960 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 11:09:26,971 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-09-26 11:09:26,971 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-09-26 11:09:27,026 - __main__ - INFO - Sample prediction density: 0.4783
2025-09-26 11:09:27,026 - __main__ - INFO - Running real inference on multiple test set samples...
2025-09-26 11:09:27,028 - data_loader - INFO - Found 31 training cases
2025-09-26 11:09:27,029 - data_loader - INFO - Found 4 test cases
2025-09-26 11:09:27,029 - data_loader - INFO - Enhanced Dataset Info:
2025-09-26 11:09:27,029 - data_loader - INFO -  Training cases: 31
2025-09-26 11:09:27,029 - data_loader - INFO -  Test cases: 4
2025-09-26 11:09:27,029 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-26 11:09:27,029 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-26 11:09:27,029 - data_loader - INFO -  Normalization: robust
2025-09-26 11:09:27,029 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-26 11:09:33,601 - data_loader - INFO - Global statistics computed:
2025-09-26 11:09:33,601 - data_loader - INFO -   Mean: -55.44
2025-09-26 11:09:33,601 - data_loader - INFO -   Std: 100.41
2025-09-26 11:09:33,601 - data_loader - INFO -   Median: -125.00
2025-09-26 11:09:33,603 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-26 11:09:34,495 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-26 11:09:34,495 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 11:09:34,495 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 11:09:35,691 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-26 11:09:35,691 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 11:09:35,691 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 11:09:36,900 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-26 11:09:36,900 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 11:09:36,900 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 11:10:01,008 - data_loader - INFO - Successfully loaded 25 cases
2025-09-26 11:10:01,009 - data_loader - INFO - Loading 4 test cases...
2025-09-26 11:10:05,711 - data_loader - INFO - Final enhanced dataset:
2025-09-26 11:10:05,711 - data_loader - INFO -  Training: 25 cases
2025-09-26 11:10:05,711 - data_loader - INFO -  Validation: 4 cases
2025-09-26 11:10:05,711 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-26 11:10:05,714 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-26 11:10:05,781 - __main__ - INFO - New dice 0.45127293942928687, old dice from one shot 0.4782829284667969
2025-09-26 11:10:05,781 - __main__ - INFO - [Sample 0] Prediction shape: torch.Size([1, 2, 64, 64, 64]), Dice: 0.4783
2025-09-26 11:10:05,803 - __main__ - ERROR - Failed to complete training: Invalid shape (2, 64, 64) for image data
2025-09-29 20:02:57,985 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-29 20:02:57,986 - __main__ - INFO - ==================================================
2025-09-29 20:02:57,986 - __main__ - INFO - IRIS Framework Training
2025-09-29 20:02:57,986 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-29 20:02:57,986 - __main__ - INFO - ==================================================
2025-09-29 20:02:57,986 - __main__ - INFO - Configuration: train_config.yaml
2025-09-29 20:02:57,986 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-29 20:02:57,986 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-29 20:02:58,129 - __main__ - INFO - Using device: cuda
2025-09-29 20:02:58,129 - __main__ - INFO - Loading datasets...
2025-09-29 20:02:58,130 - data_loader - INFO - Found 31 training cases
2025-09-29 20:02:58,130 - data_loader - INFO - Found 4 test cases
2025-09-29 20:02:58,130 - data_loader - INFO - Enhanced Dataset Info:
2025-09-29 20:02:58,130 - data_loader - INFO -  Training cases: 31
2025-09-29 20:02:58,130 - data_loader - INFO -  Test cases: 4
2025-09-29 20:02:58,130 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-29 20:02:58,130 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-29 20:02:58,130 - data_loader - INFO -  Normalization: robust
2025-09-29 20:02:58,130 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-29 20:03:05,363 - data_loader - INFO - Global statistics computed:
2025-09-29 20:03:05,363 - data_loader - INFO -   Mean: -55.44
2025-09-29 20:03:05,363 - data_loader - INFO -   Std: 100.41
2025-09-29 20:03:05,363 - data_loader - INFO -   Median: -125.00
2025-09-29 20:03:05,365 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-29 20:03:06,511 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-29 20:03:06,512 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-29 20:03:06,512 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-29 20:03:07,712 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-29 20:03:07,712 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-29 20:03:07,712 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-29 20:03:08,964 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-29 20:03:08,964 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-29 20:03:08,964 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-29 20:03:34,096 - data_loader - INFO - Successfully loaded 25 cases
2025-09-29 20:03:34,096 - data_loader - INFO - Loading 4 test cases...
2025-09-29 20:03:38,794 - data_loader - INFO - Final enhanced dataset:
2025-09-29 20:03:38,794 - data_loader - INFO -  Training: 25 cases
2025-09-29 20:03:38,794 - data_loader - INFO -  Validation: 4 cases
2025-09-29 20:03:38,795 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-29 20:03:38,804 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-29 20:03:38,804 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-29 20:03:38,960 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-29 20:03:38,960 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-29 20:03:38,960 - __main__ - INFO - Creating Iris model...
2025-09-29 20:03:39,300 - __main__ - INFO - Model Information:
2025-09-29 20:03:39,300 - __main__ - INFO -   total_parameters: 38676900
2025-09-29 20:03:39,301 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-29 20:03:39,301 - __main__ - INFO -   embed_dim: 192
2025-09-29 20:03:39,301 - __main__ - INFO -   num_classes: 2
2025-09-29 20:03:39,301 - __main__ - INFO -   deep_supervision: False
2025-09-29 20:03:39,301 - __main__ - INFO -   multi_scale: False
2025-09-29 20:03:39,301 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-29 20:03:40,555 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-29 20:03:40,555 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-29 20:03:40,555 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-29 20:03:40,556 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-29 20:03:40,556 - __main__ - INFO - Starting training...
2025-09-29 20:03:40,556 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-29 20:03:43,515 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-09-29 20:07:17,830 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-09-29 20:07:17,830 - __main__ - INFO - ==================================================
2025-09-29 20:07:17,830 - __main__ - INFO - IRIS Framework Training
2025-09-29 20:07:17,830 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-09-29 20:07:17,830 - __main__ - INFO - ==================================================
2025-09-29 20:07:17,830 - __main__ - INFO - Configuration: train_config.yaml
2025-09-29 20:07:17,830 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-09-29 20:07:17,830 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-09-29 20:07:17,941 - __main__ - INFO - Using device: cuda
2025-09-29 20:07:17,941 - __main__ - INFO - Loading datasets...
2025-09-29 20:07:17,941 - data_loader - INFO - Found 31 training cases
2025-09-29 20:07:17,942 - data_loader - INFO - Found 4 test cases
2025-09-29 20:07:17,942 - data_loader - INFO - Enhanced Dataset Info:
2025-09-29 20:07:17,942 - data_loader - INFO -  Training cases: 31
2025-09-29 20:07:17,942 - data_loader - INFO -  Test cases: 4
2025-09-29 20:07:17,942 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-29 20:07:17,942 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-29 20:07:17,942 - data_loader - INFO -  Normalization: robust
2025-09-29 20:07:17,942 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-29 20:07:24,632 - data_loader - INFO - Global statistics computed:
2025-09-29 20:07:24,632 - data_loader - INFO -   Mean: -55.44
2025-09-29 20:07:24,632 - data_loader - INFO -   Std: 100.41
2025-09-29 20:07:24,632 - data_loader - INFO -   Median: -125.00
2025-09-29 20:07:24,635 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-29 20:07:25,663 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-29 20:07:25,665 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-29 20:07:25,665 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-29 20:07:26,910 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-29 20:07:26,911 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-29 20:07:26,911 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-29 20:07:28,142 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-29 20:07:28,142 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-29 20:07:28,143 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-29 20:07:53,856 - data_loader - INFO - Successfully loaded 25 cases
2025-09-29 20:07:53,857 - data_loader - INFO - Loading 4 test cases...
2025-09-29 20:07:58,533 - data_loader - INFO - Final enhanced dataset:
2025-09-29 20:07:58,534 - data_loader - INFO -  Training: 25 cases
2025-09-29 20:07:58,534 - data_loader - INFO -  Validation: 4 cases
2025-09-29 20:07:58,543 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-29 20:07:58,570 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-29 20:07:58,570 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-09-29 20:07:58,688 - __main__ - INFO - Training dataset: 8000 episodes
2025-09-29 20:07:58,688 - __main__ - INFO - Validation dataset: 2000 episodes
2025-09-29 20:07:58,688 - __main__ - INFO - Creating Iris model...
2025-09-29 20:07:59,025 - __main__ - INFO - Model Information:
2025-09-29 20:07:59,025 - __main__ - INFO -   total_parameters: 38676900
2025-09-29 20:07:59,025 - __main__ - INFO -   trainable_parameters: 38676900
2025-09-29 20:07:59,025 - __main__ - INFO -   embed_dim: 192
2025-09-29 20:07:59,025 - __main__ - INFO -   num_classes: 2
2025-09-29 20:07:59,025 - __main__ - INFO -   deep_supervision: False
2025-09-29 20:07:59,025 - __main__ - INFO -   multi_scale: False
2025-09-29 20:07:59,025 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-09-29 20:08:00,012 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-09-29 20:08:00,013 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-09-29 20:08:00,013 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-09-29 20:08:00,014 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-09-29 20:08:00,014 - __main__ - INFO - Starting training...
2025-09-29 20:08:00,014 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-09-29 20:08:02,702 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-09-29 20:23:03,537 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-09-29 20:45:28,014 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_1000.pth
2025-09-29 21:49:16,139 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_2000.pth
2025-09-29 22:39:54,294 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_3000.pth
2025-09-29 23:22:19,545 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_4000.pth
2025-09-30 00:02:12,248 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_5000.pth
2025-09-30 00:44:09,610 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_6000.pth
2025-09-30 01:20:06,797 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_7000.pth
2025-09-30 01:55:59,534 - __main__ - INFO - Training completed! Final validation DICE: 0.0116
2025-09-30 01:55:59,552 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-09-30 01:55:59,554 - __main__ - INFO - Running inference demonstration...
2025-09-30 01:55:59,570 - __main__ - INFO - Inference demo completed!
2025-09-30 01:55:59,570 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-09-30 01:55:59,570 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-09-30 01:55:59,625 - __main__ - INFO - Sample prediction density: 0.5815
2025-09-30 01:55:59,625 - __main__ - INFO - Running real inference on test set...
2025-09-30 01:55:59,628 - data_loader - INFO - Found 31 training cases
2025-09-30 01:55:59,628 - data_loader - INFO - Found 4 test cases
2025-09-30 01:55:59,628 - data_loader - INFO - Enhanced Dataset Info:
2025-09-30 01:55:59,628 - data_loader - INFO -  Training cases: 31
2025-09-30 01:55:59,629 - data_loader - INFO -  Test cases: 4
2025-09-30 01:55:59,629 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-30 01:55:59,629 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-30 01:55:59,629 - data_loader - INFO -  Normalization: robust
2025-09-30 01:55:59,629 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-30 01:56:06,192 - data_loader - INFO - Global statistics computed:
2025-09-30 01:56:06,192 - data_loader - INFO -   Mean: -55.44
2025-09-30 01:56:06,192 - data_loader - INFO -   Std: 100.41
2025-09-30 01:56:06,192 - data_loader - INFO -   Median: -125.00
2025-09-30 01:56:06,193 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-30 01:56:07,217 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-30 01:56:07,217 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-30 01:56:07,217 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-30 01:56:08,457 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-30 01:56:08,458 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-30 01:56:08,458 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-30 01:56:09,665 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-30 01:56:09,665 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-30 01:56:09,665 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-30 01:56:34,112 - data_loader - INFO - Successfully loaded 25 cases
2025-09-30 01:56:34,113 - data_loader - INFO - Loading 4 test cases...
2025-09-30 01:56:38,803 - data_loader - INFO - Final enhanced dataset:
2025-09-30 01:56:38,803 - data_loader - INFO -  Training: 25 cases
2025-09-30 01:56:38,803 - data_loader - INFO -  Validation: 4 cases
2025-09-30 01:56:38,804 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-30 01:56:38,807 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-30 01:56:38,821 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-09-30 01:56:38,821 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-09-30 01:56:38,874 - __main__ - INFO - Sample prediction density: 0.4789
2025-09-30 01:56:38,874 - __main__ - INFO - Running real inference on multiple test set samples...
2025-09-30 01:56:38,877 - data_loader - INFO - Found 31 training cases
2025-09-30 01:56:38,877 - data_loader - INFO - Found 4 test cases
2025-09-30 01:56:38,877 - data_loader - INFO - Enhanced Dataset Info:
2025-09-30 01:56:38,877 - data_loader - INFO -  Training cases: 31
2025-09-30 01:56:38,877 - data_loader - INFO -  Test cases: 4
2025-09-30 01:56:38,877 - data_loader - INFO -  Target size: (64, 64, 64)
2025-09-30 01:56:38,877 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-09-30 01:56:38,877 - data_loader - INFO -  Normalization: robust
2025-09-30 01:56:38,877 - data_loader - INFO - Computing global statistics from 31 cases...
2025-09-30 01:56:45,366 - data_loader - INFO - Global statistics computed:
2025-09-30 01:56:45,366 - data_loader - INFO -   Mean: -55.44
2025-09-30 01:56:45,366 - data_loader - INFO -   Std: 100.41
2025-09-30 01:56:45,366 - data_loader - INFO -   Median: -125.00
2025-09-30 01:56:45,367 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-09-30 01:56:46,296 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-09-30 01:56:46,297 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-30 01:56:46,297 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-30 01:56:47,419 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-09-30 01:56:47,419 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-30 01:56:47,419 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-30 01:56:48,581 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-09-30 01:56:48,582 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-30 01:56:48,582 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-30 01:57:13,736 - data_loader - INFO - Successfully loaded 25 cases
2025-09-30 01:57:13,736 - data_loader - INFO - Loading 4 test cases...
2025-09-30 01:57:18,550 - data_loader - INFO - Final enhanced dataset:
2025-09-30 01:57:18,550 - data_loader - INFO -  Training: 25 cases
2025-09-30 01:57:18,550 - data_loader - INFO -  Validation: 4 cases
2025-09-30 01:57:18,551 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-09-30 01:57:18,553 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-09-30 01:57:18,622 - __main__ - INFO - New dice 0.33229105940960485, old dice from one shot 0.4788551330566406
2025-09-30 01:57:18,622 - __main__ - INFO - [Sample 0] Prediction shape: torch.Size([1, 2, 64, 64, 64]), Dice: 0.4789
2025-09-30 01:57:18,624 - __main__ - ERROR - Failed to complete training: too many indices for tensor of dimension 3
2025-10-01 16:05:30,449 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-01 16:05:30,449 - __main__ - INFO - ==================================================
2025-10-01 16:05:30,449 - __main__ - INFO - IRIS Framework Training
2025-10-01 16:05:30,449 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-01 16:05:30,449 - __main__ - INFO - ==================================================
2025-10-01 16:05:30,449 - __main__ - INFO - Configuration: train_config.yaml
2025-10-01 16:05:30,449 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-01 16:05:30,449 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-01 16:05:30,534 - __main__ - INFO - Using device: cuda
2025-10-01 16:05:30,534 - __main__ - INFO - Loading datasets...
2025-10-01 16:05:30,534 - data_loader - INFO - Found 31 training cases
2025-10-01 16:05:30,534 - data_loader - INFO - Found 4 test cases
2025-10-01 16:05:30,534 - data_loader - INFO - Enhanced Dataset Info:
2025-10-01 16:05:30,534 - data_loader - INFO -  Training cases: 31
2025-10-01 16:05:30,534 - data_loader - INFO -  Test cases: 4
2025-10-01 16:05:30,534 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-01 16:05:30,534 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-01 16:05:30,534 - data_loader - INFO -  Normalization: robust
2025-10-01 16:05:30,534 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-01 16:05:37,422 - data_loader - INFO - Global statistics computed:
2025-10-01 16:05:37,422 - data_loader - INFO -   Mean: -55.44
2025-10-01 16:05:37,422 - data_loader - INFO -   Std: 100.41
2025-10-01 16:05:37,422 - data_loader - INFO -   Median: -125.00
2025-10-01 16:05:37,424 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-01 16:05:38,424 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-01 16:05:38,425 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 16:05:38,425 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 16:05:39,555 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-01 16:05:39,556 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 16:05:39,556 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 16:05:40,673 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-01 16:05:40,674 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 16:05:40,674 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 16:06:03,400 - data_loader - INFO - Successfully loaded 25 cases
2025-10-01 16:06:03,400 - data_loader - INFO - Loading 4 test cases...
2025-10-01 16:06:07,742 - data_loader - INFO - Final enhanced dataset:
2025-10-01 16:06:07,743 - data_loader - INFO -  Training: 25 cases
2025-10-01 16:06:07,743 - data_loader - INFO -  Validation: 4 cases
2025-10-01 16:06:07,743 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 16:06:07,746 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 16:06:07,746 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-01 16:06:07,877 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-01 16:06:07,877 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-01 16:06:07,877 - __main__ - INFO - Creating Iris model...
2025-10-01 16:06:08,202 - __main__ - INFO - Model Information:
2025-10-01 16:06:08,202 - __main__ - INFO -   total_parameters: 38676900
2025-10-01 16:06:08,202 - __main__ - INFO -   trainable_parameters: 38676900
2025-10-01 16:06:08,202 - __main__ - INFO -   embed_dim: 192
2025-10-01 16:06:08,203 - __main__ - INFO -   num_classes: 2
2025-10-01 16:06:08,203 - __main__ - INFO -   deep_supervision: False
2025-10-01 16:06:08,203 - __main__ - INFO -   multi_scale: False
2025-10-01 16:06:08,203 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-10-01 16:06:08,959 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-01 16:06:08,959 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-10-01 16:06:08,959 - fixed_episodic_trainer - INFO - Save interval: 1000
2025-10-01 16:06:08,960 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-01 16:06:08,960 - __main__ - INFO - Starting training...
2025-10-01 16:06:08,960 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-01 16:06:11,322 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-01 16:20:30,545 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 16:34:49,993 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 16:39:48,263 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_1000.pth
2025-10-01 16:49:12,312 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 17:03:34,330 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 17:17:54,531 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_2000.pth
2025-10-01 17:46:35,733 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 17:51:34,275 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_3000.pth
2025-10-01 18:00:57,536 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 18:15:18,187 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 18:29:57,460 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 18:29:58,049 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_4000.pth
2025-10-01 18:44:23,693 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 19:03:41,180 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_5000.pth
2025-10-01 19:41:42,278 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_6000.pth
2025-10-01 19:56:11,301 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 20:16:08,465 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_7000.pth
2025-10-01 20:25:30,928 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 20:39:54,490 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-01 20:49:55,986 - __main__ - INFO - Training completed! Final validation DICE: 0.4237
2025-10-01 20:49:56,005 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-01 20:49:56,005 - __main__ - INFO - Running real inference on test set...
2025-10-01 20:49:56,009 - data_loader - INFO - Found 31 training cases
2025-10-01 20:49:56,009 - data_loader - INFO - Found 4 test cases
2025-10-01 20:49:56,009 - data_loader - INFO - Enhanced Dataset Info:
2025-10-01 20:49:56,009 - data_loader - INFO -  Training cases: 31
2025-10-01 20:49:56,009 - data_loader - INFO -  Test cases: 4
2025-10-01 20:49:56,009 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-01 20:49:56,009 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-01 20:49:56,009 - data_loader - INFO -  Normalization: robust
2025-10-01 20:49:56,009 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-01 20:50:02,476 - data_loader - INFO - Global statistics computed:
2025-10-01 20:50:02,476 - data_loader - INFO -   Mean: -55.44
2025-10-01 20:50:02,476 - data_loader - INFO -   Std: 100.41
2025-10-01 20:50:02,476 - data_loader - INFO -   Median: -125.00
2025-10-01 20:50:02,477 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-01 20:50:03,380 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-01 20:50:03,380 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:50:03,380 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:50:04,486 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-01 20:50:04,486 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:50:04,486 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:50:05,610 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-01 20:50:05,610 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:50:05,610 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:50:28,133 - data_loader - INFO - Successfully loaded 25 cases
2025-10-01 20:50:28,133 - data_loader - INFO - Loading 4 test cases...
2025-10-01 20:50:32,441 - data_loader - INFO - Final enhanced dataset:
2025-10-01 20:50:32,441 - data_loader - INFO -  Training: 25 cases
2025-10-01 20:50:32,441 - data_loader - INFO -  Validation: 4 cases
2025-10-01 20:50:32,441 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:50:32,444 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:50:32,456 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-10-01 20:50:32,456 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-10-01 20:50:32,511 - __main__ - INFO - Sample prediction density: 0.0311
2025-10-01 20:50:32,515 - __main__ - INFO - ==================================================
2025-10-01 20:50:32,515 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-01 20:50:32,515 - __main__ - INFO - ==================================================
2025-10-01 20:50:32,517 - data_loader - INFO - Found 31 training cases
2025-10-01 20:50:32,517 - data_loader - INFO - Found 4 test cases
2025-10-01 20:50:32,517 - data_loader - INFO - Enhanced Dataset Info:
2025-10-01 20:50:32,517 - data_loader - INFO -  Training cases: 31
2025-10-01 20:50:32,517 - data_loader - INFO -  Test cases: 4
2025-10-01 20:50:32,517 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-01 20:50:32,517 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-01 20:50:32,517 - data_loader - INFO -  Normalization: robust
2025-10-01 20:50:32,517 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-01 20:50:38,716 - data_loader - INFO - Global statistics computed:
2025-10-01 20:50:38,717 - data_loader - INFO -   Mean: -55.44
2025-10-01 20:50:38,717 - data_loader - INFO -   Std: 100.41
2025-10-01 20:50:38,717 - data_loader - INFO -   Median: -125.00
2025-10-01 20:50:38,717 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-01 20:50:39,655 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-01 20:50:39,655 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:50:39,655 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:50:40,812 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-01 20:50:40,812 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:50:40,812 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:50:41,970 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-01 20:50:41,970 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:50:41,970 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:51:04,407 - data_loader - INFO - Successfully loaded 25 cases
2025-10-01 20:51:04,407 - data_loader - INFO - Loading 4 test cases...
2025-10-01 20:51:08,722 - data_loader - INFO - Final enhanced dataset:
2025-10-01 20:51:08,723 - data_loader - INFO -  Training: 25 cases
2025-10-01 20:51:08,723 - data_loader - INFO -  Validation: 4 cases
2025-10-01 20:51:08,723 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:51:08,726 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:51:08,727 - __main__ - INFO - Processing Sample 0:
2025-10-01 20:51:08,727 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-01 20:51:08,727 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-01 20:51:08,727 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-01 20:51:08,795 - __main__ - INFO - -------------------------
2025-10-01 20:51:08,795 - __main__ - INFO - Inference Results:
2025-10-01 20:51:08,795 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 2, 64, 64, 64])
2025-10-01 20:51:08,795 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-01 20:51:08,795 - __main__ - INFO -  - Dice Score: {'class_1': 0.0, 'class_2': 0.0}
2025-10-01 20:51:08,795 - __main__ - INFO - -------------------------
2025-10-01 20:51:08,795 - __main__ - INFO - ==================================================
2025-10-01 20:51:08,795 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-01 20:51:08,795 - __main__ - INFO - ==================================================
2025-10-01 20:51:08,798 - data_loader - INFO - Found 31 training cases
2025-10-01 20:51:08,798 - data_loader - INFO - Found 4 test cases
2025-10-01 20:51:08,798 - data_loader - INFO - Enhanced Dataset Info:
2025-10-01 20:51:08,798 - data_loader - INFO -  Training cases: 31
2025-10-01 20:51:08,798 - data_loader - INFO -  Test cases: 4
2025-10-01 20:51:08,798 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-01 20:51:08,798 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-01 20:51:08,798 - data_loader - INFO -  Normalization: robust
2025-10-01 20:51:08,798 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-01 20:51:15,006 - data_loader - INFO - Global statistics computed:
2025-10-01 20:51:15,006 - data_loader - INFO -   Mean: -55.44
2025-10-01 20:51:15,006 - data_loader - INFO -   Std: 100.41
2025-10-01 20:51:15,006 - data_loader - INFO -   Median: -125.00
2025-10-01 20:51:15,007 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-01 20:51:15,895 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-01 20:51:15,895 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:51:15,895 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:51:16,980 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-01 20:51:16,980 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:51:16,980 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:51:18,079 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-01 20:51:18,079 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:51:18,079 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:51:40,943 - data_loader - INFO - Successfully loaded 25 cases
2025-10-01 20:51:40,943 - data_loader - INFO - Loading 4 test cases...
2025-10-01 20:51:45,434 - data_loader - INFO - Final enhanced dataset:
2025-10-01 20:51:45,434 - data_loader - INFO -  Training: 25 cases
2025-10-01 20:51:45,434 - data_loader - INFO -  Validation: 4 cases
2025-10-01 20:51:45,435 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-01 20:51:45,438 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-01 20:51:45,438 - __main__ - INFO - Processing Sample 1/4
2025-10-01 20:51:45,505 - __main__ - INFO -  - Dice Score from new calculation: 1.9223
2025-10-01 20:51:45,505 - __main__ - INFO -  - Dice Score from old method: 0.0311
2025-10-01 20:51:45,529 - __main__ - ERROR - Failed to complete training: Invalid shape (2, 64, 64) for image data
2025-10-02 03:40:10,437 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-02 03:40:10,437 - __main__ - INFO - ==================================================
2025-10-02 03:40:10,437 - __main__ - INFO - IRIS Framework Training
2025-10-02 03:40:10,437 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-02 03:40:10,437 - __main__ - INFO - ==================================================
2025-10-02 03:40:10,437 - __main__ - INFO - Configuration: train_config.yaml
2025-10-02 03:40:10,437 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-02 03:40:10,437 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-02 03:40:10,527 - __main__ - INFO - Using device: cuda
2025-10-02 03:40:10,527 - __main__ - INFO - Loading datasets...
2025-10-02 03:40:10,528 - data_loader - INFO - Found 31 training cases
2025-10-02 03:40:10,528 - data_loader - INFO - Found 4 test cases
2025-10-02 03:40:10,528 - data_loader - INFO - Enhanced Dataset Info:
2025-10-02 03:40:10,528 - data_loader - INFO -  Training cases: 31
2025-10-02 03:40:10,528 - data_loader - INFO -  Test cases: 4
2025-10-02 03:40:10,528 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-02 03:40:10,528 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-02 03:40:10,528 - data_loader - INFO -  Normalization: robust
2025-10-02 03:40:10,528 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-02 03:40:17,656 - data_loader - INFO - Global statistics computed:
2025-10-02 03:40:17,656 - data_loader - INFO -   Mean: -55.44
2025-10-02 03:40:17,656 - data_loader - INFO -   Std: 100.41
2025-10-02 03:40:17,656 - data_loader - INFO -   Median: -125.00
2025-10-02 03:40:17,658 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-02 03:40:18,737 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-02 03:40:18,738 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 03:40:18,738 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 03:40:20,071 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-02 03:40:20,072 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 03:40:20,072 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 03:40:21,372 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-02 03:40:21,372 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 03:40:21,372 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 03:40:45,583 - data_loader - INFO - Successfully loaded 25 cases
2025-10-02 03:40:45,583 - data_loader - INFO - Loading 4 test cases...
2025-10-02 03:40:50,054 - data_loader - INFO - Final enhanced dataset:
2025-10-02 03:40:50,054 - data_loader - INFO -  Training: 25 cases
2025-10-02 03:40:50,054 - data_loader - INFO -  Validation: 4 cases
2025-10-02 03:40:50,055 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 03:40:50,058 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 03:40:50,058 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-02 03:40:50,219 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-02 03:40:50,219 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-02 03:40:50,220 - __main__ - INFO - Creating Iris model...
2025-10-02 03:40:50,557 - __main__ - INFO - Model Information:
2025-10-02 03:40:50,557 - __main__ - INFO -   total_parameters: 38676900
2025-10-02 03:40:50,557 - __main__ - INFO -   trainable_parameters: 38676900
2025-10-02 03:40:50,557 - __main__ - INFO -   embed_dim: 192
2025-10-02 03:40:50,557 - __main__ - INFO -   num_classes: 2
2025-10-02 03:40:50,557 - __main__ - INFO -   deep_supervision: False
2025-10-02 03:40:50,557 - __main__ - INFO -   multi_scale: False
2025-10-02 03:40:50,557 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-10-02 03:40:51,350 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-02 03:40:51,350 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-10-02 03:40:51,350 - fixed_episodic_trainer - INFO - Save interval: 8000
2025-10-02 03:40:51,351 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-02 03:40:51,351 - __main__ - INFO - Starting training...
2025-10-02 03:40:51,351 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-02 03:40:53,980 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-02 04:11:26,675 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 04:42:17,303 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 05:13:06,650 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 05:43:39,279 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 06:14:10,145 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 06:44:41,997 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 07:15:08,979 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 07:40:53,756 - __main__ - INFO - Training completed! Final validation DICE: 0.4113
2025-10-02 07:40:53,773 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-02 07:40:53,774 - __main__ - INFO - Running real inference on test set...
2025-10-02 07:40:53,776 - data_loader - INFO - Found 31 training cases
2025-10-02 07:40:53,776 - data_loader - INFO - Found 4 test cases
2025-10-02 07:40:53,776 - data_loader - INFO - Enhanced Dataset Info:
2025-10-02 07:40:53,776 - data_loader - INFO -  Training cases: 31
2025-10-02 07:40:53,776 - data_loader - INFO -  Test cases: 4
2025-10-02 07:40:53,776 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-02 07:40:53,776 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-02 07:40:53,776 - data_loader - INFO -  Normalization: robust
2025-10-02 07:40:53,776 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-02 07:41:00,072 - data_loader - INFO - Global statistics computed:
2025-10-02 07:41:00,072 - data_loader - INFO -   Mean: -55.44
2025-10-02 07:41:00,072 - data_loader - INFO -   Std: 100.41
2025-10-02 07:41:00,072 - data_loader - INFO -   Median: -125.00
2025-10-02 07:41:00,073 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-02 07:41:00,959 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-02 07:41:00,960 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:41:00,960 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:41:02,056 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-02 07:41:02,056 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:41:02,056 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:41:03,180 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-02 07:41:03,180 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:41:03,180 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:41:25,815 - data_loader - INFO - Successfully loaded 25 cases
2025-10-02 07:41:25,815 - data_loader - INFO - Loading 4 test cases...
2025-10-02 07:41:30,158 - data_loader - INFO - Final enhanced dataset:
2025-10-02 07:41:30,158 - data_loader - INFO -  Training: 25 cases
2025-10-02 07:41:30,158 - data_loader - INFO -  Validation: 4 cases
2025-10-02 07:41:30,159 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:41:30,162 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:41:30,173 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-10-02 07:41:30,173 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-10-02 07:41:30,228 - __main__ - INFO - Sample prediction density: 0.0345
2025-10-02 07:41:30,231 - __main__ - INFO - ==================================================
2025-10-02 07:41:30,231 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-02 07:41:30,231 - __main__ - INFO - ==================================================
2025-10-02 07:41:30,234 - data_loader - INFO - Found 31 training cases
2025-10-02 07:41:30,234 - data_loader - INFO - Found 4 test cases
2025-10-02 07:41:30,234 - data_loader - INFO - Enhanced Dataset Info:
2025-10-02 07:41:30,234 - data_loader - INFO -  Training cases: 31
2025-10-02 07:41:30,234 - data_loader - INFO -  Test cases: 4
2025-10-02 07:41:30,234 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-02 07:41:30,234 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-02 07:41:30,234 - data_loader - INFO -  Normalization: robust
2025-10-02 07:41:30,234 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-02 07:41:36,486 - data_loader - INFO - Global statistics computed:
2025-10-02 07:41:36,486 - data_loader - INFO -   Mean: -55.44
2025-10-02 07:41:36,486 - data_loader - INFO -   Std: 100.41
2025-10-02 07:41:36,486 - data_loader - INFO -   Median: -125.00
2025-10-02 07:41:36,487 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-02 07:41:37,388 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-02 07:41:37,388 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:41:37,388 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:41:38,495 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-02 07:41:38,496 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:41:38,496 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:41:39,614 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-02 07:41:39,614 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:41:39,614 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:42:02,662 - data_loader - INFO - Successfully loaded 25 cases
2025-10-02 07:42:02,662 - data_loader - INFO - Loading 4 test cases...
2025-10-02 07:42:06,970 - data_loader - INFO - Final enhanced dataset:
2025-10-02 07:42:06,971 - data_loader - INFO -  Training: 25 cases
2025-10-02 07:42:06,971 - data_loader - INFO -  Validation: 4 cases
2025-10-02 07:42:06,971 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:42:06,974 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:42:06,975 - __main__ - INFO - Processing Sample 0:
2025-10-02 07:42:06,975 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-02 07:42:06,975 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-02 07:42:06,975 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-02 07:42:07,043 - __main__ - INFO - -------------------------
2025-10-02 07:42:07,043 - __main__ - INFO - Inference Results:
2025-10-02 07:42:07,043 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 2, 64, 64, 64])
2025-10-02 07:42:07,043 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-02 07:42:07,043 - __main__ - INFO -  - Dice Score: {'class_1': 0.0, 'class_2': 0.0}
2025-10-02 07:42:07,043 - __main__ - INFO - -------------------------
2025-10-02 07:42:07,046 - __main__ - INFO - ==================================================
2025-10-02 07:42:07,046 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-02 07:42:07,046 - __main__ - INFO - ==================================================
2025-10-02 07:42:07,049 - data_loader - INFO - Found 31 training cases
2025-10-02 07:42:07,049 - data_loader - INFO - Found 4 test cases
2025-10-02 07:42:07,049 - data_loader - INFO - Enhanced Dataset Info:
2025-10-02 07:42:07,049 - data_loader - INFO -  Training cases: 31
2025-10-02 07:42:07,049 - data_loader - INFO -  Test cases: 4
2025-10-02 07:42:07,049 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-02 07:42:07,049 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-02 07:42:07,049 - data_loader - INFO -  Normalization: robust
2025-10-02 07:42:07,049 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-02 07:42:13,222 - data_loader - INFO - Global statistics computed:
2025-10-02 07:42:13,222 - data_loader - INFO -   Mean: -55.44
2025-10-02 07:42:13,222 - data_loader - INFO -   Std: 100.41
2025-10-02 07:42:13,222 - data_loader - INFO -   Median: -125.00
2025-10-02 07:42:13,224 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-02 07:42:14,139 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-02 07:42:14,139 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:42:14,139 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:42:15,307 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-02 07:42:15,307 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:42:15,307 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:42:16,445 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-02 07:42:16,446 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:42:16,446 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:42:39,816 - data_loader - INFO - Successfully loaded 25 cases
2025-10-02 07:42:39,816 - data_loader - INFO - Loading 4 test cases...
2025-10-02 07:42:44,277 - data_loader - INFO - Final enhanced dataset:
2025-10-02 07:42:44,277 - data_loader - INFO -  Training: 25 cases
2025-10-02 07:42:44,277 - data_loader - INFO -  Validation: 4 cases
2025-10-02 07:42:44,279 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 07:42:44,282 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 07:42:44,282 - __main__ - INFO - Processing Sample 1/4
2025-10-02 07:42:44,356 - __main__ - INFO -  - Dice Score from new calculation: 2.0112
2025-10-02 07:42:44,357 - __main__ - INFO -  - Dice Score from old method: 0.0345
2025-10-02 07:42:44,377 - __main__ - ERROR - Failed to complete training: Invalid shape (2, 64, 64) for image data
2025-10-02 14:19:06,586 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-02 14:19:06,586 - __main__ - INFO - ==================================================
2025-10-02 14:19:06,586 - __main__ - INFO - IRIS Framework Training
2025-10-02 14:19:06,586 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-02 14:19:06,586 - __main__ - INFO - ==================================================
2025-10-02 14:19:06,586 - __main__ - INFO - Configuration: train_config.yaml
2025-10-02 14:19:06,586 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-02 14:19:06,586 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-02 14:19:06,704 - __main__ - INFO - Using device: cuda
2025-10-02 14:19:06,704 - __main__ - INFO - Loading datasets...
2025-10-02 14:19:06,704 - data_loader - INFO - Found 31 training cases
2025-10-02 14:19:06,704 - data_loader - INFO - Found 4 test cases
2025-10-02 14:19:06,704 - data_loader - INFO - Enhanced Dataset Info:
2025-10-02 14:19:06,704 - data_loader - INFO -  Training cases: 31
2025-10-02 14:19:06,704 - data_loader - INFO -  Test cases: 4
2025-10-02 14:19:06,704 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-02 14:19:06,704 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-02 14:19:06,704 - data_loader - INFO -  Normalization: robust
2025-10-02 14:19:06,704 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-02 14:19:13,223 - data_loader - INFO - Global statistics computed:
2025-10-02 14:19:13,224 - data_loader - INFO -   Mean: -55.44
2025-10-02 14:19:13,224 - data_loader - INFO -   Std: 100.41
2025-10-02 14:19:13,224 - data_loader - INFO -   Median: -125.00
2025-10-02 14:19:13,226 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-02 14:19:14,139 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-02 14:19:14,139 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 14:19:14,139 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 14:19:15,256 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-02 14:19:15,257 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 14:19:15,257 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 14:19:16,394 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-02 14:19:16,394 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 14:19:16,394 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 14:19:38,717 - data_loader - INFO - Successfully loaded 25 cases
2025-10-02 14:19:38,717 - data_loader - INFO - Loading 4 test cases...
2025-10-02 14:19:42,990 - data_loader - INFO - Final enhanced dataset:
2025-10-02 14:19:42,990 - data_loader - INFO -  Training: 25 cases
2025-10-02 14:19:42,990 - data_loader - INFO -  Validation: 4 cases
2025-10-02 14:19:42,990 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 14:19:42,993 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 14:19:42,993 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-02 14:19:43,127 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-02 14:19:43,127 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-02 14:19:43,127 - __main__ - INFO - Creating Iris model...
2025-10-02 14:19:43,452 - __main__ - INFO - Model Information:
2025-10-02 14:19:43,452 - __main__ - INFO -   total_parameters: 38676900
2025-10-02 14:19:43,452 - __main__ - INFO -   trainable_parameters: 38676900
2025-10-02 14:19:43,452 - __main__ - INFO -   embed_dim: 192
2025-10-02 14:19:43,452 - __main__ - INFO -   num_classes: 2
2025-10-02 14:19:43,452 - __main__ - INFO -   deep_supervision: False
2025-10-02 14:19:43,452 - __main__ - INFO -   multi_scale: False
2025-10-02 14:19:43,452 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-10-02 14:19:44,201 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-02 14:19:44,202 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-10-02 14:19:44,202 - fixed_episodic_trainer - INFO - Save interval: 8000
2025-10-02 14:19:44,203 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-02 14:19:44,203 - __main__ - INFO - Starting training...
2025-10-02 14:19:44,203 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-02 14:19:46,491 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-02 14:49:01,945 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 15:18:24,207 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 15:47:46,902 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 16:46:36,827 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 17:16:10,154 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-02 18:10:29,513 - __main__ - INFO - Training completed! Final validation DICE: 0.4043
2025-10-02 18:10:29,529 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-02 18:10:29,530 - __main__ - INFO - Running real inference on test set...
2025-10-02 18:10:29,532 - data_loader - INFO - Found 31 training cases
2025-10-02 18:10:29,533 - data_loader - INFO - Found 4 test cases
2025-10-02 18:10:29,533 - data_loader - INFO - Enhanced Dataset Info:
2025-10-02 18:10:29,533 - data_loader - INFO -  Training cases: 31
2025-10-02 18:10:29,533 - data_loader - INFO -  Test cases: 4
2025-10-02 18:10:29,533 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-02 18:10:29,533 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-02 18:10:29,533 - data_loader - INFO -  Normalization: robust
2025-10-02 18:10:29,533 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-02 18:10:35,687 - data_loader - INFO - Global statistics computed:
2025-10-02 18:10:35,687 - data_loader - INFO -   Mean: -55.44
2025-10-02 18:10:35,687 - data_loader - INFO -   Std: 100.41
2025-10-02 18:10:35,687 - data_loader - INFO -   Median: -125.00
2025-10-02 18:10:35,688 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-02 18:10:36,579 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-02 18:10:36,579 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:10:36,579 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:10:37,671 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-02 18:10:37,671 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:10:37,671 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:10:38,794 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-02 18:10:38,795 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:10:38,795 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:11:01,363 - data_loader - INFO - Successfully loaded 25 cases
2025-10-02 18:11:01,363 - data_loader - INFO - Loading 4 test cases...
2025-10-02 18:11:05,672 - data_loader - INFO - Final enhanced dataset:
2025-10-02 18:11:05,672 - data_loader - INFO -  Training: 25 cases
2025-10-02 18:11:05,672 - data_loader - INFO -  Validation: 4 cases
2025-10-02 18:11:05,684 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:11:05,716 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:11:05,730 - __main__ - INFO - Prediction shape: torch.Size([1, 2, 64, 64, 64])
2025-10-02 18:11:05,730 - __main__ - INFO - Task embedding shape: torch.Size([1, 7, 192])
2025-10-02 18:11:05,783 - __main__ - INFO - Sample prediction density: 0.0335
2025-10-02 18:11:05,783 - __main__ - INFO - ==================================================
2025-10-02 18:11:05,783 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-02 18:11:05,783 - __main__ - INFO - ==================================================
2025-10-02 18:11:05,787 - data_loader - INFO - Found 31 training cases
2025-10-02 18:11:05,787 - data_loader - INFO - Found 4 test cases
2025-10-02 18:11:05,787 - data_loader - INFO - Enhanced Dataset Info:
2025-10-02 18:11:05,787 - data_loader - INFO -  Training cases: 31
2025-10-02 18:11:05,787 - data_loader - INFO -  Test cases: 4
2025-10-02 18:11:05,787 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-02 18:11:05,787 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-02 18:11:05,787 - data_loader - INFO -  Normalization: robust
2025-10-02 18:11:05,787 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-02 18:11:11,953 - data_loader - INFO - Global statistics computed:
2025-10-02 18:11:11,953 - data_loader - INFO -   Mean: -55.44
2025-10-02 18:11:11,953 - data_loader - INFO -   Std: 100.41
2025-10-02 18:11:11,953 - data_loader - INFO -   Median: -125.00
2025-10-02 18:11:11,954 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-02 18:11:12,837 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-02 18:11:12,837 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:11:12,837 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:11:13,928 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-02 18:11:13,929 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:11:13,929 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:11:15,053 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-02 18:11:15,054 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:11:15,054 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:11:37,599 - data_loader - INFO - Successfully loaded 25 cases
2025-10-02 18:11:37,599 - data_loader - INFO - Loading 4 test cases...
2025-10-02 18:11:41,921 - data_loader - INFO - Final enhanced dataset:
2025-10-02 18:11:41,921 - data_loader - INFO -  Training: 25 cases
2025-10-02 18:11:41,921 - data_loader - INFO -  Validation: 4 cases
2025-10-02 18:11:41,921 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:11:41,924 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:11:41,925 - __main__ - INFO - Processing Sample 0:
2025-10-02 18:11:41,925 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-02 18:11:41,925 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-02 18:11:41,925 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-02 18:11:41,994 - __main__ - INFO - -------------------------
2025-10-02 18:11:41,994 - __main__ - INFO - Inference Results:
2025-10-02 18:11:41,994 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 2, 64, 64, 64])
2025-10-02 18:11:41,994 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-02 18:11:41,994 - __main__ - INFO -  - Dice Score: {'class_1': 0.0, 'class_2': 0.0}
2025-10-02 18:11:41,994 - __main__ - INFO - -------------------------
2025-10-02 18:11:41,994 - __main__ - INFO - ==================================================
2025-10-02 18:11:41,994 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-02 18:11:41,994 - __main__ - INFO - ==================================================
2025-10-02 18:11:41,996 - data_loader - INFO - Found 31 training cases
2025-10-02 18:11:41,996 - data_loader - INFO - Found 4 test cases
2025-10-02 18:11:41,996 - data_loader - INFO - Enhanced Dataset Info:
2025-10-02 18:11:41,996 - data_loader - INFO -  Training cases: 31
2025-10-02 18:11:41,996 - data_loader - INFO -  Test cases: 4
2025-10-02 18:11:41,996 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-02 18:11:41,996 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-02 18:11:41,996 - data_loader - INFO -  Normalization: robust
2025-10-02 18:11:41,996 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-02 18:11:48,340 - data_loader - INFO - Global statistics computed:
2025-10-02 18:11:48,340 - data_loader - INFO -   Mean: -55.44
2025-10-02 18:11:48,340 - data_loader - INFO -   Std: 100.41
2025-10-02 18:11:48,340 - data_loader - INFO -   Median: -125.00
2025-10-02 18:11:48,343 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-02 18:11:49,288 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-02 18:11:49,288 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:11:49,288 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:11:50,459 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-02 18:11:50,460 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:11:50,460 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:11:51,572 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-02 18:11:51,573 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:11:51,573 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:12:14,417 - data_loader - INFO - Successfully loaded 25 cases
2025-10-02 18:12:14,417 - data_loader - INFO - Loading 4 test cases...
2025-10-02 18:12:18,768 - data_loader - INFO - Final enhanced dataset:
2025-10-02 18:12:18,769 - data_loader - INFO -  Training: 25 cases
2025-10-02 18:12:18,769 - data_loader - INFO -  Validation: 4 cases
2025-10-02 18:12:18,769 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-02 18:12:18,772 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-02 18:12:18,772 - __main__ - INFO - Processing Sample 1/4
2025-10-02 18:12:18,838 - __main__ - INFO -  - Dice Score: 1.9546
2025-10-02 18:12:18,859 - __main__ - ERROR - Visualization failed for sample 0: Invalid shape (2, 64, 64) for image data
2025-10-02 18:12:18,859 - __main__ - INFO - Processing Sample 2/4
2025-10-02 18:12:18,925 - __main__ - INFO -  - Dice Score: 1.7239
2025-10-02 18:12:18,939 - __main__ - ERROR - Visualization failed for sample 1: Invalid shape (2, 64, 64) for image data
2025-10-02 18:12:18,939 - __main__ - INFO - Processing Sample 3/4
2025-10-02 18:12:19,005 - __main__ - INFO -  - Dice Score: 1.8254
2025-10-02 18:12:19,020 - __main__ - ERROR - Visualization failed for sample 2: Invalid shape (2, 64, 64) for image data
2025-10-02 18:12:19,020 - __main__ - INFO - Processing Sample 4/4
2025-10-02 18:12:19,086 - __main__ - INFO -  - Dice Score: 1.7659
2025-10-02 18:12:19,102 - __main__ - ERROR - Visualization failed for sample 3: Invalid shape (2, 64, 64) for image data
2025-10-02 18:12:19,102 - __main__ - INFO - ==================================================
2025-10-02 18:12:19,102 - __main__ - INFO - Average Dice score over 4 samples: 1.8175
2025-10-02 18:12:19,102 - __main__ - INFO - ==================================================
2025-10-02 18:12:19,102 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-03 01:03:13,077 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-03 01:03:13,078 - __main__ - INFO - ==================================================
2025-10-03 01:03:13,078 - __main__ - INFO - IRIS Framework Training
2025-10-03 01:03:13,078 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-03 01:03:13,078 - __main__ - INFO - ==================================================
2025-10-03 01:03:13,078 - __main__ - INFO - Configuration: train_config.yaml
2025-10-03 01:03:13,078 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-03 01:03:13,078 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-03 01:03:13,224 - __main__ - INFO - Using device: cuda
2025-10-03 01:03:13,224 - __main__ - INFO - Loading datasets...
2025-10-03 01:03:13,229 - data_loader - INFO - Found 31 training cases
2025-10-03 01:03:13,229 - data_loader - INFO - Found 4 test cases
2025-10-03 01:03:13,229 - data_loader - INFO - Enhanced Dataset Info:
2025-10-03 01:03:13,229 - data_loader - INFO -  Training cases: 31
2025-10-03 01:03:13,229 - data_loader - INFO -  Test cases: 4
2025-10-03 01:03:13,229 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-03 01:03:13,229 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-03 01:03:13,229 - data_loader - INFO -  Normalization: robust
2025-10-03 01:03:13,229 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-03 01:03:20,584 - data_loader - INFO - Global statistics computed:
2025-10-03 01:03:20,585 - data_loader - INFO -   Mean: -55.44
2025-10-03 01:03:20,585 - data_loader - INFO -   Std: 100.41
2025-10-03 01:03:20,585 - data_loader - INFO -   Median: -125.00
2025-10-03 01:03:20,587 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-03 01:03:21,553 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-03 01:03:21,554 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 01:03:21,554 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 01:03:22,714 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-03 01:03:22,714 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 01:03:22,714 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 01:03:23,885 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-03 01:03:23,886 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 01:03:23,886 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 01:03:47,479 - data_loader - INFO - Successfully loaded 25 cases
2025-10-03 01:03:47,480 - data_loader - INFO - Loading 4 test cases...
2025-10-03 01:03:52,048 - data_loader - INFO - Final enhanced dataset:
2025-10-03 01:03:52,049 - data_loader - INFO -  Training: 25 cases
2025-10-03 01:03:52,049 - data_loader - INFO -  Validation: 4 cases
2025-10-03 01:03:52,049 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 01:03:52,052 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 01:03:52,052 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-03 01:03:52,167 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-03 01:03:52,167 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-03 01:03:52,167 - __main__ - INFO - Creating Iris model...
2025-10-03 01:03:52,500 - __main__ - INFO - Model Information:
2025-10-03 01:03:52,500 - __main__ - INFO -   total_parameters: 38676900
2025-10-03 01:03:52,500 - __main__ - INFO -   trainable_parameters: 38676900
2025-10-03 01:03:52,500 - __main__ - INFO -   embed_dim: 192
2025-10-03 01:03:52,500 - __main__ - INFO -   num_classes: 2
2025-10-03 01:03:52,500 - __main__ - INFO -   deep_supervision: False
2025-10-03 01:03:52,500 - __main__ - INFO -   multi_scale: False
2025-10-03 01:03:52,500 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-10-03 01:03:53,439 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-03 01:03:53,440 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-10-03 01:03:53,440 - fixed_episodic_trainer - INFO - Save interval: 8000
2025-10-03 01:03:53,441 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-03 01:03:53,441 - __main__ - INFO - Starting training...
2025-10-03 01:03:53,441 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-03 01:03:56,169 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-03 01:04:47,743 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-03 01:04:47,743 - __main__ - INFO - ==================================================
2025-10-03 01:04:47,743 - __main__ - INFO - IRIS Framework Training
2025-10-03 01:04:47,743 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-03 01:04:47,743 - __main__ - INFO - ==================================================
2025-10-03 01:04:47,743 - __main__ - INFO - Configuration: train_config.yaml
2025-10-03 01:04:47,743 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-03 01:04:47,743 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-03 01:04:47,923 - __main__ - INFO - Using device: cuda
2025-10-03 01:04:47,923 - __main__ - INFO - Loading datasets...
2025-10-03 01:04:47,924 - data_loader - INFO - Found 31 training cases
2025-10-03 01:04:47,924 - data_loader - INFO - Found 4 test cases
2025-10-03 01:04:47,924 - data_loader - INFO - Enhanced Dataset Info:
2025-10-03 01:04:47,924 - data_loader - INFO -  Training cases: 31
2025-10-03 01:04:47,924 - data_loader - INFO -  Test cases: 4
2025-10-03 01:04:47,924 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-03 01:04:47,924 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-03 01:04:47,924 - data_loader - INFO -  Normalization: robust
2025-10-03 01:04:47,924 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-03 01:04:55,069 - data_loader - INFO - Global statistics computed:
2025-10-03 01:04:55,069 - data_loader - INFO -   Mean: -55.44
2025-10-03 01:04:55,069 - data_loader - INFO -   Std: 100.41
2025-10-03 01:04:55,069 - data_loader - INFO -   Median: -125.00
2025-10-03 01:04:55,071 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-03 01:04:56,088 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-03 01:04:56,088 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 01:04:56,088 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 01:04:57,304 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-03 01:04:57,305 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 01:04:57,305 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 01:04:58,507 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-03 01:04:58,508 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 01:04:58,508 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 01:05:22,718 - data_loader - INFO - Successfully loaded 25 cases
2025-10-03 01:05:22,718 - data_loader - INFO - Loading 4 test cases...
2025-10-03 01:05:27,239 - data_loader - INFO - Final enhanced dataset:
2025-10-03 01:05:27,239 - data_loader - INFO -  Training: 25 cases
2025-10-03 01:05:27,239 - data_loader - INFO -  Validation: 4 cases
2025-10-03 01:05:27,239 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 01:05:27,243 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 01:05:27,243 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-03 01:05:27,391 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-03 01:05:27,392 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-03 01:05:27,392 - __main__ - INFO - Creating Iris model...
2025-10-03 01:05:27,726 - __main__ - INFO - Model Information:
2025-10-03 01:05:27,726 - __main__ - INFO -   total_parameters: 38676900
2025-10-03 01:05:27,726 - __main__ - INFO -   trainable_parameters: 38676900
2025-10-03 01:05:27,726 - __main__ - INFO -   embed_dim: 192
2025-10-03 01:05:27,726 - __main__ - INFO -   num_classes: 2
2025-10-03 01:05:27,726 - __main__ - INFO -   deep_supervision: False
2025-10-03 01:05:27,726 - __main__ - INFO -   multi_scale: False
2025-10-03 01:05:27,726 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-10-03 01:05:28,575 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-03 01:05:28,576 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-10-03 01:05:28,576 - fixed_episodic_trainer - INFO - Save interval: 8000
2025-10-03 01:05:28,577 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-03 01:05:28,577 - __main__ - INFO - Starting training...
2025-10-03 01:05:28,577 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-03 01:05:31,245 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-03 01:35:44,333 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-03 02:06:10,980 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-03 03:06:36,416 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-03 03:36:56,369 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-03 05:02:07,049 - __main__ - INFO - Training completed! Final validation DICE: 0.3938
2025-10-03 05:02:07,069 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-03 05:02:07,071 - __main__ - ERROR - Failed to complete training: name 'run_real_inference_old' is not defined
2025-10-03 11:05:22,576 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-03 11:05:22,577 - __main__ - INFO - ==================================================
2025-10-03 11:05:22,577 - __main__ - INFO - IRIS Framework Training
2025-10-03 11:05:22,577 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-03 11:05:22,577 - __main__ - INFO - ==================================================
2025-10-03 11:05:22,577 - __main__ - INFO - Configuration: train_config.yaml
2025-10-03 11:05:22,577 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-03 11:05:22,577 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-03 11:05:22,704 - __main__ - INFO - Using device: cuda
2025-10-03 11:05:22,705 - __main__ - INFO - Loading datasets...
2025-10-03 11:05:22,717 - data_loader - INFO - Found 31 training cases
2025-10-03 11:05:22,717 - data_loader - INFO - Found 4 test cases
2025-10-03 11:05:22,717 - data_loader - INFO - Enhanced Dataset Info:
2025-10-03 11:05:22,717 - data_loader - INFO -  Training cases: 31
2025-10-03 11:05:22,717 - data_loader - INFO -  Test cases: 4
2025-10-03 11:05:22,717 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-03 11:05:22,717 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-03 11:05:22,717 - data_loader - INFO -  Normalization: robust
2025-10-03 11:05:22,717 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-03 11:05:40,142 - data_loader - INFO - Global statistics computed:
2025-10-03 11:05:40,142 - data_loader - INFO -   Mean: -55.44
2025-10-03 11:05:40,142 - data_loader - INFO -   Std: 100.41
2025-10-03 11:05:40,142 - data_loader - INFO -   Median: -125.00
2025-10-03 11:05:40,146 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-03 11:05:42,776 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-03 11:05:42,821 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 11:05:42,821 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 11:05:46,952 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-03 11:05:47,017 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 11:05:47,017 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 11:05:51,520 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-03 11:05:51,587 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 11:05:51,587 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 11:08:55,249 - data_loader - INFO - Successfully loaded 25 cases
2025-10-03 11:08:55,258 - data_loader - INFO - Loading 4 test cases...
2025-10-03 11:09:26,004 - data_loader - INFO - Final enhanced dataset:
2025-10-03 11:09:26,004 - data_loader - INFO -  Training: 25 cases
2025-10-03 11:09:26,004 - data_loader - INFO -  Validation: 4 cases
2025-10-03 11:09:26,211 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 11:09:28,254 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 11:09:28,254 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-03 11:11:16,379 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-03 11:11:16,379 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-03 11:11:16,379 - __main__ - INFO - Creating Iris model...
2025-10-03 11:11:36,581 - __main__ - INFO - Model Information:
2025-10-03 11:11:36,583 - __main__ - INFO -   total_parameters: 38676900
2025-10-03 11:11:36,583 - __main__ - INFO -   trainable_parameters: 38676900
2025-10-03 11:11:36,583 - __main__ - INFO -   embed_dim: 192
2025-10-03 11:11:36,583 - __main__ - INFO -   num_classes: 2
2025-10-03 11:11:36,583 - __main__ - INFO -   deep_supervision: False
2025-10-03 11:11:36,583 - __main__ - INFO -   multi_scale: False
2025-10-03 11:11:36,583 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-10-03 11:11:40,734 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-03 11:11:40,739 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-10-03 11:11:40,740 - fixed_episodic_trainer - INFO - Save interval: 8000
2025-10-03 11:11:40,743 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-03 11:11:40,746 - __main__ - INFO - Starting training...
2025-10-03 11:11:40,746 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-03 11:11:58,075 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-03 21:23:51,088 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-03 21:23:51,089 - __main__ - INFO - ==================================================
2025-10-03 21:23:51,089 - __main__ - INFO - IRIS Framework Training
2025-10-03 21:23:51,089 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-03 21:23:51,089 - __main__ - INFO - ==================================================
2025-10-03 21:23:51,089 - __main__ - INFO - Configuration: train_config.yaml
2025-10-03 21:23:51,089 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-03 21:23:51,089 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-03 21:23:51,200 - __main__ - INFO - Using device: cuda
2025-10-03 21:23:51,200 - __main__ - INFO - Loading datasets...
2025-10-03 21:23:51,200 - data_loader - INFO - Found 31 training cases
2025-10-03 21:23:51,200 - data_loader - INFO - Found 4 test cases
2025-10-03 21:23:51,200 - data_loader - INFO - Enhanced Dataset Info:
2025-10-03 21:23:51,200 - data_loader - INFO -  Training cases: 31
2025-10-03 21:23:51,200 - data_loader - INFO -  Test cases: 4
2025-10-03 21:23:51,200 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-03 21:23:51,200 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-03 21:23:51,200 - data_loader - INFO -  Normalization: robust
2025-10-03 21:23:51,200 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-03 21:23:58,012 - data_loader - INFO - Global statistics computed:
2025-10-03 21:23:58,013 - data_loader - INFO -   Mean: -55.44
2025-10-03 21:23:58,013 - data_loader - INFO -   Std: 100.41
2025-10-03 21:23:58,013 - data_loader - INFO -   Median: -125.00
2025-10-03 21:23:58,014 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-03 21:23:59,017 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-03 21:23:59,018 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 21:23:59,018 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 21:24:00,188 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-03 21:24:00,188 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 21:24:00,188 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 21:24:01,369 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-03 21:24:01,369 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 21:24:01,369 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 21:24:24,651 - data_loader - INFO - Successfully loaded 25 cases
2025-10-03 21:24:24,651 - data_loader - INFO - Loading 4 test cases...
2025-10-03 21:24:29,030 - data_loader - INFO - Final enhanced dataset:
2025-10-03 21:24:29,030 - data_loader - INFO -  Training: 25 cases
2025-10-03 21:24:29,030 - data_loader - INFO -  Validation: 4 cases
2025-10-03 21:24:29,031 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-03 21:24:29,035 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-03 21:24:29,035 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-03 21:24:29,166 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-03 21:24:29,166 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-03 21:24:29,166 - __main__ - INFO - Creating Iris model...
2025-10-03 21:24:29,497 - __main__ - INFO - Model Information:
2025-10-03 21:24:29,497 - __main__ - INFO -   total_parameters: 38676900
2025-10-03 21:24:29,497 - __main__ - INFO -   trainable_parameters: 38676900
2025-10-03 21:24:29,497 - __main__ - INFO -   embed_dim: 192
2025-10-03 21:24:29,497 - __main__ - INFO -   num_classes: 2
2025-10-03 21:24:29,497 - __main__ - INFO -   deep_supervision: False
2025-10-03 21:24:29,497 - __main__ - INFO -   multi_scale: False
2025-10-03 21:24:29,497 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-10-03 21:24:30,702 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-03 21:24:30,702 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-10-03 21:24:30,702 - fixed_episodic_trainer - INFO - Save interval: 8000
2025-10-03 21:24:30,703 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-03 21:24:30,703 - __main__ - INFO - Starting training...
2025-10-03 21:24:30,703 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-03 21:24:33,632 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-03 21:56:58,168 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-03 22:30:13,050 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-03 23:01:42,557 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-03 23:31:30,173 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 00:02:11,018 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 00:32:25,060 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 01:38:35,890 - __main__ - INFO - Training completed! Final validation DICE: 0.3989
2025-10-04 01:38:35,906 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-04 01:38:35,907 - __main__ - INFO - ==================================================
2025-10-04 01:38:35,907 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-04 01:38:35,907 - __main__ - INFO - ==================================================
2025-10-04 01:38:35,910 - data_loader - INFO - Found 31 training cases
2025-10-04 01:38:35,910 - data_loader - INFO - Found 4 test cases
2025-10-04 01:38:35,910 - data_loader - INFO - Enhanced Dataset Info:
2025-10-04 01:38:35,910 - data_loader - INFO -  Training cases: 31
2025-10-04 01:38:35,910 - data_loader - INFO -  Test cases: 4
2025-10-04 01:38:35,910 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-04 01:38:35,910 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-04 01:38:35,910 - data_loader - INFO -  Normalization: robust
2025-10-04 01:38:35,910 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-04 01:38:42,949 - data_loader - INFO - Global statistics computed:
2025-10-04 01:38:42,949 - data_loader - INFO -   Mean: -55.44
2025-10-04 01:38:42,949 - data_loader - INFO -   Std: 100.41
2025-10-04 01:38:42,949 - data_loader - INFO -   Median: -125.00
2025-10-04 01:38:42,955 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-04 01:38:44,045 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-04 01:38:44,045 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 01:38:44,045 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 01:38:45,243 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-04 01:38:45,244 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 01:38:45,244 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 01:38:46,500 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-04 01:38:46,501 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 01:38:46,501 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 01:39:12,501 - data_loader - INFO - Successfully loaded 25 cases
2025-10-04 01:39:12,501 - data_loader - INFO - Loading 4 test cases...
2025-10-04 01:39:17,834 - data_loader - INFO - Final enhanced dataset:
2025-10-04 01:39:17,834 - data_loader - INFO -  Training: 25 cases
2025-10-04 01:39:17,834 - data_loader - INFO -  Validation: 4 cases
2025-10-04 01:39:17,846 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 01:39:18,056 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 01:39:18,057 - __main__ - INFO - Processing Sample 0:
2025-10-04 01:39:18,057 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-04 01:39:18,057 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-04 01:39:18,058 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-04 01:39:18,248 - __main__ - INFO - -------------------------
2025-10-04 01:39:18,248 - __main__ - INFO - Inference Results:
2025-10-04 01:39:18,248 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 2, 64, 64, 64])
2025-10-04 01:39:18,249 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-04 01:39:18,249 - __main__ - INFO -  - Dice Score: {'class_1': 0.0, 'class_2': 0.0}
2025-10-04 01:39:18,249 - __main__ - INFO - -------------------------
2025-10-04 01:39:18,252 - __main__ - INFO - ==================================================
2025-10-04 01:39:18,252 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-04 01:39:18,252 - __main__ - INFO - ==================================================
2025-10-04 01:39:18,255 - data_loader - INFO - Found 31 training cases
2025-10-04 01:39:18,256 - data_loader - INFO - Found 4 test cases
2025-10-04 01:39:18,256 - data_loader - INFO - Enhanced Dataset Info:
2025-10-04 01:39:18,256 - data_loader - INFO -  Training cases: 31
2025-10-04 01:39:18,256 - data_loader - INFO -  Test cases: 4
2025-10-04 01:39:18,256 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-04 01:39:18,256 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-04 01:39:18,256 - data_loader - INFO -  Normalization: robust
2025-10-04 01:39:18,256 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-04 01:39:26,048 - data_loader - INFO - Global statistics computed:
2025-10-04 01:39:26,048 - data_loader - INFO -   Mean: -55.44
2025-10-04 01:39:26,048 - data_loader - INFO -   Std: 100.41
2025-10-04 01:39:26,048 - data_loader - INFO -   Median: -125.00
2025-10-04 01:39:26,051 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-04 01:39:27,586 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-04 01:39:27,603 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 01:39:27,603 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 01:39:29,253 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-04 01:39:29,269 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 01:39:29,270 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 01:39:31,144 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-04 01:39:31,159 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 01:39:31,159 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 01:39:58,454 - data_loader - INFO - Successfully loaded 25 cases
2025-10-04 01:39:58,454 - data_loader - INFO - Loading 4 test cases...
2025-10-04 01:40:03,855 - data_loader - INFO - Final enhanced dataset:
2025-10-04 01:40:03,855 - data_loader - INFO -  Training: 25 cases
2025-10-04 01:40:03,855 - data_loader - INFO -  Validation: 4 cases
2025-10-04 01:40:03,876 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 01:40:04,071 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 01:40:04,074 - __main__ - INFO - Processing Sample 1/4
2025-10-04 01:40:04,272 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': 0.0, 'class_2': 0.0}
2025-10-04 01:40:04,272 - __main__ - INFO -  - Average Dice Score for Sample 0: 0.0000
2025-10-04 01:40:04,273 - __main__ - ERROR - Visualization failed for sample 0: name 'plt' is not defined
2025-10-04 01:40:04,273 - __main__ - INFO - Processing Sample 2/4
2025-10-04 01:40:04,471 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': 0.0, 'class_2': 0.0}
2025-10-04 01:40:04,471 - __main__ - INFO -  - Average Dice Score for Sample 1: 0.0000
2025-10-04 01:40:04,472 - __main__ - ERROR - Visualization failed for sample 1: name 'plt' is not defined
2025-10-04 01:40:04,472 - __main__ - INFO - Processing Sample 3/4
2025-10-04 01:40:04,665 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': 0.0, 'class_2': 0.0}
2025-10-04 01:40:04,665 - __main__ - INFO -  - Average Dice Score for Sample 2: 0.0000
2025-10-04 01:40:04,665 - __main__ - ERROR - Visualization failed for sample 2: name 'plt' is not defined
2025-10-04 01:40:04,665 - __main__ - INFO - Processing Sample 4/4
2025-10-04 01:40:04,852 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': 0.0, 'class_2': 0.0}
2025-10-04 01:40:04,852 - __main__ - INFO -  - Average Dice Score for Sample 3: 0.0000
2025-10-04 01:40:04,853 - __main__ - ERROR - Visualization failed for sample 3: name 'plt' is not defined
2025-10-04 01:40:04,853 - __main__ - INFO - ==================================================
2025-10-04 01:40:04,853 - __main__ - INFO - Average Dice score over 4 samples: 0.0000
2025-10-04 01:40:04,853 - __main__ - INFO - ==================================================
2025-10-04 01:40:04,854 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-04 02:57:44,429 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-04 02:57:44,430 - __main__ - INFO - ==================================================
2025-10-04 02:57:44,430 - __main__ - INFO - IRIS Framework Training
2025-10-04 02:57:44,430 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-04 02:57:44,430 - __main__ - INFO - ==================================================
2025-10-04 02:57:44,430 - __main__ - INFO - Configuration: train_config.yaml
2025-10-04 02:57:44,430 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-04 02:57:44,430 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-04 02:57:44,551 - __main__ - INFO - Using device: cuda
2025-10-04 02:57:44,552 - __main__ - INFO - Loading datasets...
2025-10-04 02:57:44,552 - data_loader - INFO - Found 31 training cases
2025-10-04 02:57:44,552 - data_loader - INFO - Found 4 test cases
2025-10-04 02:57:44,552 - data_loader - INFO - Enhanced Dataset Info:
2025-10-04 02:57:44,552 - data_loader - INFO -  Training cases: 31
2025-10-04 02:57:44,552 - data_loader - INFO -  Test cases: 4
2025-10-04 02:57:44,552 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-04 02:57:44,552 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-04 02:57:44,552 - data_loader - INFO -  Normalization: robust
2025-10-04 02:57:44,552 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-04 02:57:51,531 - data_loader - INFO - Global statistics computed:
2025-10-04 02:57:51,532 - data_loader - INFO -   Mean: -55.44
2025-10-04 02:57:51,532 - data_loader - INFO -   Std: 100.41
2025-10-04 02:57:51,532 - data_loader - INFO -   Median: -125.00
2025-10-04 02:57:51,533 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-04 02:57:52,474 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-04 02:57:52,474 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 02:57:52,474 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 02:57:53,591 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-04 02:57:53,591 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 02:57:53,591 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 02:57:54,727 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-04 02:57:54,728 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 02:57:54,728 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 02:58:17,917 - data_loader - INFO - Successfully loaded 25 cases
2025-10-04 02:58:17,918 - data_loader - INFO - Loading 4 test cases...
2025-10-04 02:58:22,408 - data_loader - INFO - Final enhanced dataset:
2025-10-04 02:58:22,408 - data_loader - INFO -  Training: 25 cases
2025-10-04 02:58:22,408 - data_loader - INFO -  Validation: 4 cases
2025-10-04 02:58:22,408 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 02:58:22,411 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 02:58:22,411 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-04 02:58:22,554 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-04 02:58:22,554 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-04 02:58:22,554 - __main__ - INFO - Creating Iris model...
2025-10-04 02:58:22,881 - __main__ - INFO - Model Information:
2025-10-04 02:58:22,881 - __main__ - INFO -   total_parameters: 38676900
2025-10-04 02:58:22,881 - __main__ - INFO -   trainable_parameters: 38676900
2025-10-04 02:58:22,881 - __main__ - INFO -   embed_dim: 192
2025-10-04 02:58:22,881 - __main__ - INFO -   num_classes: 2
2025-10-04 02:58:22,881 - __main__ - INFO -   deep_supervision: False
2025-10-04 02:58:22,881 - __main__ - INFO -   multi_scale: False
2025-10-04 02:58:22,881 - __main__ - INFO -   model_size_mb: 147.54066467285156
2025-10-04 02:58:23,677 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-04 02:58:23,677 - fixed_episodic_trainer - INFO - Warmup iterations: 800
2025-10-04 02:58:23,677 - fixed_episodic_trainer - INFO - Save interval: 8000
2025-10-04 02:58:23,679 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-04 02:58:23,679 - __main__ - INFO - Starting training...
2025-10-04 02:58:23,679 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-04 02:58:26,192 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-04 02:59:16,407 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-04 02:59:16,408 - __main__ - INFO - ==================================================
2025-10-04 02:59:16,408 - __main__ - INFO - IRIS Framework Training
2025-10-04 02:59:16,408 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-04 02:59:16,408 - __main__ - INFO - ==================================================
2025-10-04 02:59:16,408 - __main__ - INFO - Configuration: train_config.yaml
2025-10-04 02:59:16,408 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-04 02:59:16,408 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-04 02:59:16,541 - __main__ - INFO - Using device: cuda
2025-10-04 02:59:16,542 - __main__ - INFO - Loading datasets...
2025-10-04 02:59:16,542 - data_loader - INFO - Found 31 training cases
2025-10-04 02:59:16,542 - data_loader - INFO - Found 4 test cases
2025-10-04 02:59:16,542 - data_loader - INFO - Enhanced Dataset Info:
2025-10-04 02:59:16,542 - data_loader - INFO -  Training cases: 31
2025-10-04 02:59:16,542 - data_loader - INFO -  Test cases: 4
2025-10-04 02:59:16,542 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-04 02:59:16,542 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-04 02:59:16,542 - data_loader - INFO -  Normalization: robust
2025-10-04 02:59:16,542 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-04 02:59:23,420 - data_loader - INFO - Global statistics computed:
2025-10-04 02:59:23,420 - data_loader - INFO -   Mean: -55.44
2025-10-04 02:59:23,420 - data_loader - INFO -   Std: 100.41
2025-10-04 02:59:23,420 - data_loader - INFO -   Median: -125.00
2025-10-04 02:59:23,422 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-04 02:59:24,373 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-04 02:59:24,374 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 02:59:24,374 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 02:59:25,560 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-04 02:59:25,560 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 02:59:25,560 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 02:59:26,712 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-04 02:59:26,712 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 02:59:26,712 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 02:59:52,015 - data_loader - INFO - Successfully loaded 25 cases
2025-10-04 02:59:52,015 - data_loader - INFO - Loading 4 test cases...
2025-10-04 02:59:56,452 - data_loader - INFO - Final enhanced dataset:
2025-10-04 02:59:56,452 - data_loader - INFO -  Training: 25 cases
2025-10-04 02:59:56,452 - data_loader - INFO -  Validation: 4 cases
2025-10-04 02:59:56,452 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 02:59:56,456 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 02:59:56,456 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-04 02:59:56,587 - __main__ - INFO - Training dataset: 8000 episodes
2025-10-04 02:59:56,587 - __main__ - INFO - Validation dataset: 2000 episodes
2025-10-04 02:59:56,587 - __main__ - INFO - Creating Iris model...
2025-10-04 02:59:56,920 - __main__ - INFO - Model Information:
2025-10-04 02:59:56,920 - __main__ - INFO -   total_parameters: 38687322
2025-10-04 02:59:56,920 - __main__ - INFO -   trainable_parameters: 38687322
2025-10-04 02:59:56,920 - __main__ - INFO -   embed_dim: 192
2025-10-04 02:59:56,920 - __main__ - INFO -   num_classes: 11
2025-10-04 02:59:56,920 - __main__ - INFO -   deep_supervision: False
2025-10-04 02:59:56,920 - __main__ - INFO -   multi_scale: False
2025-10-04 02:59:56,920 - __main__ - INFO -   model_size_mb: 147.5804214477539
2025-10-04 02:59:57,719 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-04 02:59:57,719 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-04 02:59:57,719 - fixed_episodic_trainer - INFO - Save interval: 8000
2025-10-04 02:59:57,720 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-04 02:59:57,720 - __main__ - INFO - Starting training...
2025-10-04 02:59:57,720 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-04 03:00:00,219 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-04 03:29:42,737 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 03:59:12,863 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 04:29:00,634 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 04:58:30,827 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 05:27:46,538 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 05:57:00,494 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-04 06:50:57,800 - __main__ - INFO - Training completed! Final validation DICE: 0.4842
2025-10-04 06:50:57,815 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-04 06:50:57,816 - __main__ - INFO - ==================================================
2025-10-04 06:50:57,816 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-04 06:50:57,816 - __main__ - INFO - ==================================================
2025-10-04 06:50:57,819 - data_loader - INFO - Found 31 training cases
2025-10-04 06:50:57,819 - data_loader - INFO - Found 4 test cases
2025-10-04 06:50:57,819 - data_loader - INFO - Enhanced Dataset Info:
2025-10-04 06:50:57,819 - data_loader - INFO -  Training cases: 31
2025-10-04 06:50:57,819 - data_loader - INFO -  Test cases: 4
2025-10-04 06:50:57,819 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-04 06:50:57,819 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-04 06:50:57,819 - data_loader - INFO -  Normalization: robust
2025-10-04 06:50:57,819 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-04 06:51:03,894 - data_loader - INFO - Global statistics computed:
2025-10-04 06:51:03,895 - data_loader - INFO -   Mean: -55.44
2025-10-04 06:51:03,895 - data_loader - INFO -   Std: 100.41
2025-10-04 06:51:03,895 - data_loader - INFO -   Median: -125.00
2025-10-04 06:51:03,899 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-04 06:51:04,796 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-04 06:51:04,796 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 06:51:04,796 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 06:51:05,897 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-04 06:51:05,897 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 06:51:05,898 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 06:51:07,012 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-04 06:51:07,012 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 06:51:07,012 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 06:51:29,439 - data_loader - INFO - Successfully loaded 25 cases
2025-10-04 06:51:29,439 - data_loader - INFO - Loading 4 test cases...
2025-10-04 06:51:33,804 - data_loader - INFO - Final enhanced dataset:
2025-10-04 06:51:33,804 - data_loader - INFO -  Training: 25 cases
2025-10-04 06:51:33,804 - data_loader - INFO -  Validation: 4 cases
2025-10-04 06:51:33,804 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 06:51:33,807 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 06:51:33,808 - __main__ - INFO - Processing Sample 0:
2025-10-04 06:51:33,808 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-04 06:51:33,808 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-04 06:51:33,808 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-04 06:51:33,899 - __main__ - ERROR - Failed to complete training: 'float' object has no attribute 'item'
2025-10-04 13:45:18,323 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-04 13:45:18,323 - __main__ - INFO - ==================================================
2025-10-04 13:45:18,323 - __main__ - INFO - IRIS Framework Training
2025-10-04 13:45:18,323 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-04 13:45:18,323 - __main__ - INFO - ==================================================
2025-10-04 13:45:18,323 - __main__ - INFO - Configuration: train_config.yaml
2025-10-04 13:45:18,323 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-04 13:45:18,323 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-04 13:45:18,419 - __main__ - INFO - Using device: cuda
2025-10-04 13:45:18,419 - __main__ - INFO - Loading datasets...
2025-10-04 13:45:18,419 - data_loader - INFO - Found 31 training cases
2025-10-04 13:45:18,419 - data_loader - INFO - Found 4 test cases
2025-10-04 13:45:18,419 - data_loader - INFO - Enhanced Dataset Info:
2025-10-04 13:45:18,419 - data_loader - INFO -  Training cases: 31
2025-10-04 13:45:18,419 - data_loader - INFO -  Test cases: 4
2025-10-04 13:45:18,420 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-04 13:45:18,420 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-04 13:45:18,420 - data_loader - INFO -  Normalization: robust
2025-10-04 13:45:18,420 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-04 13:45:25,388 - data_loader - INFO - Global statistics computed:
2025-10-04 13:45:25,388 - data_loader - INFO -   Mean: -55.44
2025-10-04 13:45:25,388 - data_loader - INFO -   Std: 100.41
2025-10-04 13:45:25,388 - data_loader - INFO -   Median: -125.00
2025-10-04 13:45:25,391 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-04 13:45:26,359 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-04 13:45:26,360 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 13:45:26,360 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 13:45:27,498 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-04 13:45:27,499 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 13:45:27,499 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 13:45:28,649 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-04 13:45:28,649 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 13:45:28,649 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 13:45:52,837 - data_loader - INFO - Successfully loaded 25 cases
2025-10-04 13:45:52,837 - data_loader - INFO - Loading 4 test cases...
2025-10-04 13:45:57,675 - data_loader - INFO - Final enhanced dataset:
2025-10-04 13:45:57,675 - data_loader - INFO -  Training: 25 cases
2025-10-04 13:45:57,675 - data_loader - INFO -  Validation: 4 cases
2025-10-04 13:45:57,684 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-04 13:45:57,687 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-04 13:45:57,687 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-04 13:45:57,806 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-04 13:45:57,806 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-04 13:45:57,806 - __main__ - INFO - Creating Iris model...
2025-10-04 13:45:58,164 - __main__ - INFO - Model Information:
2025-10-04 13:45:58,164 - __main__ - INFO -   total_parameters: 38687322
2025-10-04 13:45:58,164 - __main__ - INFO -   trainable_parameters: 38687322
2025-10-04 13:45:58,164 - __main__ - INFO -   embed_dim: 192
2025-10-04 13:45:58,164 - __main__ - INFO -   num_classes: 11
2025-10-04 13:45:58,164 - __main__ - INFO -   deep_supervision: False
2025-10-04 13:45:58,164 - __main__ - INFO -   multi_scale: False
2025-10-04 13:45:58,164 - __main__ - INFO -   model_size_mb: 147.5804214477539
2025-10-04 13:45:59,357 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-04 13:45:59,358 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-04 13:45:59,358 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-04 13:45:59,359 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-04 13:45:59,359 - __main__ - INFO - Starting training...
2025-10-04 13:45:59,359 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-04 13:46:00,173 - __main__ - ERROR - Training failed with error: CUDA out of memory. Tried to allocate 192.00 MiB. GPU 0 has a total capacity of 44.42 GiB of which 103.44 MiB is free. Process 2862912 has 31.11 GiB memory in use. Process 2863573 has 552.00 MiB memory in use. Process 2865114 has 548.00 MiB memory in use. Including non-PyTorch memory, this process has 12.11 GiB memory in use. Of the allocated memory 11.53 GiB is allocated by PyTorch, and 89.95 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2025-10-04 13:46:00,173 - __main__ - ERROR - Failed to complete training: CUDA out of memory. Tried to allocate 192.00 MiB. GPU 0 has a total capacity of 44.42 GiB of which 103.44 MiB is free. Process 2862912 has 31.11 GiB memory in use. Process 2863573 has 552.00 MiB memory in use. Process 2865114 has 548.00 MiB memory in use. Including non-PyTorch memory, this process has 12.11 GiB memory in use. Of the allocated memory 11.53 GiB is allocated by PyTorch, and 89.95 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
2025-10-05 19:09:48,382 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-05 19:09:48,382 - __main__ - INFO - ==================================================
2025-10-05 19:09:48,383 - __main__ - INFO - IRIS Framework Training
2025-10-05 19:09:48,383 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-05 19:09:48,383 - __main__ - INFO - ==================================================
2025-10-05 19:09:48,383 - __main__ - INFO - Configuration: train_config.yaml
2025-10-05 19:09:48,383 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-05 19:09:48,383 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-05 19:09:48,531 - __main__ - INFO - Using device: cuda
2025-10-05 19:09:48,532 - __main__ - INFO - Loading datasets...
2025-10-05 19:09:48,532 - data_loader - INFO - Found 31 training cases
2025-10-05 19:09:48,532 - data_loader - INFO - Found 4 test cases
2025-10-05 19:09:48,532 - data_loader - INFO - Enhanced Dataset Info:
2025-10-05 19:09:48,532 - data_loader - INFO -  Training cases: 31
2025-10-05 19:09:48,532 - data_loader - INFO -  Test cases: 4
2025-10-05 19:09:48,532 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-05 19:09:48,532 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-05 19:09:48,532 - data_loader - INFO -  Normalization: robust
2025-10-05 19:09:48,532 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-05 19:09:55,039 - data_loader - INFO - Global statistics computed:
2025-10-05 19:09:55,039 - data_loader - INFO -   Mean: -55.44
2025-10-05 19:09:55,039 - data_loader - INFO -   Std: 100.41
2025-10-05 19:09:55,039 - data_loader - INFO -   Median: -125.00
2025-10-05 19:09:55,042 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-05 19:09:55,987 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-05 19:09:55,987 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-05 19:09:55,987 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-05 19:09:57,094 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-05 19:09:57,095 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-05 19:09:57,095 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-05 19:09:58,211 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-05 19:09:58,211 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-05 19:09:58,211 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-05 19:10:20,846 - data_loader - INFO - Successfully loaded 25 cases
2025-10-05 19:10:20,846 - data_loader - INFO - Loading 4 test cases...
2025-10-05 19:10:25,113 - data_loader - INFO - Final enhanced dataset:
2025-10-05 19:10:25,113 - data_loader - INFO -  Training: 25 cases
2025-10-05 19:10:25,113 - data_loader - INFO -  Validation: 4 cases
2025-10-05 19:10:25,114 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-05 19:10:25,117 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-05 19:10:25,117 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-05 19:10:25,245 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-05 19:10:25,246 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-05 19:10:25,246 - __main__ - INFO - Creating Iris model...
2025-10-05 19:10:25,561 - __main__ - INFO - Model Information:
2025-10-05 19:10:25,562 - __main__ - INFO -   total_parameters: 38687322
2025-10-05 19:10:25,562 - __main__ - INFO -   trainable_parameters: 38687322
2025-10-05 19:10:25,562 - __main__ - INFO -   embed_dim: 192
2025-10-05 19:10:25,562 - __main__ - INFO -   num_classes: 11
2025-10-05 19:10:25,562 - __main__ - INFO -   deep_supervision: False
2025-10-05 19:10:25,562 - __main__ - INFO -   multi_scale: False
2025-10-05 19:10:25,562 - __main__ - INFO -   model_size_mb: 147.5804214477539
2025-10-05 19:10:26,294 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-05 19:10:26,294 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-05 19:10:26,294 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-05 19:10:26,295 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-05 19:10:26,295 - __main__ - INFO - Starting training...
2025-10-05 19:10:26,295 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-05 19:10:28,739 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-05 19:51:10,162 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-05 20:27:10,892 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-05 21:02:55,322 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-05 21:38:40,022 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-05 22:53:30,720 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-05 23:29:19,910 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 00:46:05,192 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 01:21:52,450 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-06 03:49:13,913 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 05:01:33,406 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 06:13:05,481 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 06:48:48,799 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 07:14:45,513 - __main__ - INFO - Training completed! Final validation DICE: 0.5728
2025-10-06 07:14:45,557 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-06 07:14:45,559 - __main__ - INFO - ==================================================
2025-10-06 07:14:45,559 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-06 07:14:45,559 - __main__ - INFO - ==================================================
2025-10-06 07:14:45,561 - data_loader - INFO - Found 31 training cases
2025-10-06 07:14:45,561 - data_loader - INFO - Found 4 test cases
2025-10-06 07:14:45,561 - data_loader - INFO - Enhanced Dataset Info:
2025-10-06 07:14:45,561 - data_loader - INFO -  Training cases: 31
2025-10-06 07:14:45,561 - data_loader - INFO -  Test cases: 4
2025-10-06 07:14:45,561 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-06 07:14:45,561 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-06 07:14:45,561 - data_loader - INFO -  Normalization: robust
2025-10-06 07:14:45,562 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-06 07:15:00,410 - data_loader - INFO - Global statistics computed:
2025-10-06 07:15:00,410 - data_loader - INFO -   Mean: -55.44
2025-10-06 07:15:00,410 - data_loader - INFO -   Std: 100.41
2025-10-06 07:15:00,410 - data_loader - INFO -   Median: -125.00
2025-10-06 07:15:00,411 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-06 07:15:01,303 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-06 07:15:01,303 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 07:15:01,303 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 07:15:02,409 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-06 07:15:02,410 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 07:15:02,410 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 07:15:03,589 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-06 07:15:03,589 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 07:15:03,589 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 07:15:30,487 - data_loader - INFO - Successfully loaded 25 cases
2025-10-06 07:15:30,487 - data_loader - INFO - Loading 4 test cases...
2025-10-06 07:15:35,818 - data_loader - INFO - Final enhanced dataset:
2025-10-06 07:15:35,818 - data_loader - INFO -  Training: 25 cases
2025-10-06 07:15:35,818 - data_loader - INFO -  Validation: 4 cases
2025-10-06 07:15:35,819 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 07:15:35,822 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 07:15:35,823 - __main__ - INFO - Processing Sample 0:
2025-10-06 07:15:35,823 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-06 07:15:35,823 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-06 07:15:35,823 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-06 07:15:35,915 - __main__ - INFO - -------------------------
2025-10-06 07:15:35,915 - __main__ - INFO - Inference Results:
2025-10-06 07:15:35,915 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-06 07:15:35,915 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-06 07:15:35,918 - __main__ - INFO -  - Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 07:15:35,918 - __main__ - INFO - -------------------------
2025-10-06 07:15:35,918 - __main__ - INFO - ==================================================
2025-10-06 07:15:35,918 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-06 07:15:35,918 - __main__ - INFO - ==================================================
2025-10-06 07:15:35,921 - data_loader - INFO - Found 31 training cases
2025-10-06 07:15:35,921 - data_loader - INFO - Found 4 test cases
2025-10-06 07:15:35,921 - data_loader - INFO - Enhanced Dataset Info:
2025-10-06 07:15:35,921 - data_loader - INFO -  Training cases: 31
2025-10-06 07:15:35,921 - data_loader - INFO -  Test cases: 4
2025-10-06 07:15:35,921 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-06 07:15:35,921 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-06 07:15:35,921 - data_loader - INFO -  Normalization: robust
2025-10-06 07:15:35,921 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-06 07:15:50,420 - data_loader - INFO - Global statistics computed:
2025-10-06 07:15:50,420 - data_loader - INFO -   Mean: -55.44
2025-10-06 07:15:50,420 - data_loader - INFO -   Std: 100.41
2025-10-06 07:15:50,420 - data_loader - INFO -   Median: -125.00
2025-10-06 07:15:50,421 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-06 07:15:51,841 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-06 07:15:51,856 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 07:15:51,856 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 07:15:54,675 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-06 07:15:54,675 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 07:15:54,675 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 07:15:55,893 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-06 07:15:55,893 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 07:15:55,893 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 07:16:27,787 - data_loader - INFO - Successfully loaded 25 cases
2025-10-06 07:16:27,787 - data_loader - INFO - Loading 4 test cases...
2025-10-06 07:16:36,145 - data_loader - INFO - Final enhanced dataset:
2025-10-06 07:16:36,145 - data_loader - INFO -  Training: 25 cases
2025-10-06 07:16:36,145 - data_loader - INFO -  Validation: 4 cases
2025-10-06 07:16:36,159 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 07:16:36,357 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 07:16:36,357 - __main__ - INFO - Processing Sample 1/4
2025-10-06 07:16:37,113 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 07:16:37,113 - __main__ - INFO -  - Average Dice Score for Sample 0: 0.0909
2025-10-06 07:16:37,151 - __main__ - ERROR - Visualization failed for sample 0: Invalid shape (11, 64, 64) for image data
2025-10-06 07:16:37,151 - __main__ - INFO - Processing Sample 2/4
2025-10-06 07:16:37,554 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 07:16:37,555 - __main__ - INFO -  - Average Dice Score for Sample 1: 0.0909
2025-10-06 07:16:37,582 - __main__ - ERROR - Visualization failed for sample 1: Invalid shape (11, 64, 64) for image data
2025-10-06 07:16:37,582 - __main__ - INFO - Processing Sample 3/4
2025-10-06 07:16:38,331 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 07:16:38,332 - __main__ - INFO -  - Average Dice Score for Sample 2: 0.0909
2025-10-06 07:16:38,361 - __main__ - ERROR - Visualization failed for sample 2: Invalid shape (11, 64, 64) for image data
2025-10-06 07:16:38,361 - __main__ - INFO - Processing Sample 4/4
2025-10-06 07:16:39,093 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 07:16:39,093 - __main__ - INFO -  - Average Dice Score for Sample 3: 0.0909
2025-10-06 07:16:39,116 - __main__ - ERROR - Visualization failed for sample 3: Invalid shape (11, 64, 64) for image data
2025-10-06 07:16:39,116 - __main__ - INFO - ==================================================
2025-10-06 07:16:39,116 - __main__ - INFO - Average Dice score over 4 samples: 0.0909
2025-10-06 07:16:39,116 - __main__ - INFO - ==================================================
2025-10-06 07:16:39,116 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-06 09:52:41,466 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-06 09:52:41,466 - __main__ - INFO - ==================================================
2025-10-06 09:52:41,466 - __main__ - INFO - IRIS Framework Training
2025-10-06 09:52:41,466 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-06 09:52:41,466 - __main__ - INFO - ==================================================
2025-10-06 09:52:41,466 - __main__ - INFO - Configuration: train_config.yaml
2025-10-06 09:52:41,466 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-06 09:52:41,466 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-06 09:52:41,562 - __main__ - INFO - Using device: cuda
2025-10-06 09:52:41,562 - __main__ - INFO - Loading datasets...
2025-10-06 09:52:41,563 - data_loader - INFO - Found 31 training cases
2025-10-06 09:52:41,563 - data_loader - INFO - Found 4 test cases
2025-10-06 09:52:41,563 - data_loader - INFO - Enhanced Dataset Info:
2025-10-06 09:52:41,563 - data_loader - INFO -  Training cases: 31
2025-10-06 09:52:41,563 - data_loader - INFO -  Test cases: 4
2025-10-06 09:52:41,563 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-06 09:52:41,563 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-06 09:52:41,563 - data_loader - INFO -  Normalization: robust
2025-10-06 09:52:41,563 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-06 09:52:47,915 - data_loader - INFO - Global statistics computed:
2025-10-06 09:52:47,915 - data_loader - INFO -   Mean: -55.44
2025-10-06 09:52:47,915 - data_loader - INFO -   Std: 100.41
2025-10-06 09:52:47,915 - data_loader - INFO -   Median: -125.00
2025-10-06 09:52:47,917 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-06 09:52:48,833 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-06 09:52:48,834 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 09:52:48,834 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 09:52:49,943 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-06 09:52:49,944 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 09:52:49,944 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 09:52:51,061 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-06 09:52:51,061 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 09:52:51,061 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 09:53:13,588 - data_loader - INFO - Successfully loaded 25 cases
2025-10-06 09:53:13,589 - data_loader - INFO - Loading 4 test cases...
2025-10-06 09:53:17,904 - data_loader - INFO - Final enhanced dataset:
2025-10-06 09:53:17,905 - data_loader - INFO -  Training: 25 cases
2025-10-06 09:53:17,905 - data_loader - INFO -  Validation: 4 cases
2025-10-06 09:53:17,905 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 09:53:17,908 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 09:53:17,908 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-06 09:53:18,040 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-06 09:53:18,040 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-06 09:53:18,040 - __main__ - INFO - Creating Iris model...
2025-10-06 09:53:18,368 - __main__ - INFO - Model Information:
2025-10-06 09:53:18,368 - __main__ - INFO -   total_parameters: 38885850
2025-10-06 09:53:18,368 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-06 09:53:18,368 - __main__ - INFO -   embed_dim: 192
2025-10-06 09:53:18,368 - __main__ - INFO -   num_classes: 11
2025-10-06 09:53:18,368 - __main__ - INFO -   deep_supervision: False
2025-10-06 09:53:18,368 - __main__ - INFO -   multi_scale: True
2025-10-06 09:53:18,368 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-06 09:53:19,099 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-06 09:53:19,099 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-06 09:53:19,099 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-06 09:53:19,100 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-06 09:53:19,100 - __main__ - INFO - Starting training...
2025-10-06 09:53:19,100 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-06 09:53:21,632 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-06 10:29:33,337 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 11:05:50,594 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 11:42:06,559 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 12:18:23,030 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 14:19:40,198 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 15:32:49,626 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 16:09:50,976 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 16:09:51,641 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-06 16:46:39,343 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 18:00:23,634 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 18:36:44,734 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 19:13:10,529 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 19:49:55,953 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 20:26:17,009 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 21:02:36,842 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 21:38:58,588 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-06 22:03:56,431 - __main__ - INFO - Training completed! Final validation DICE: 0.7451
2025-10-06 22:03:56,474 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-06 22:03:56,476 - __main__ - INFO - ==================================================
2025-10-06 22:03:56,476 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-06 22:03:56,476 - __main__ - INFO - ==================================================
2025-10-06 22:03:56,488 - data_loader - INFO - Found 31 training cases
2025-10-06 22:03:56,488 - data_loader - INFO - Found 4 test cases
2025-10-06 22:03:56,488 - data_loader - INFO - Enhanced Dataset Info:
2025-10-06 22:03:56,488 - data_loader - INFO -  Training cases: 31
2025-10-06 22:03:56,488 - data_loader - INFO -  Test cases: 4
2025-10-06 22:03:56,488 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-06 22:03:56,488 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-06 22:03:56,488 - data_loader - INFO -  Normalization: robust
2025-10-06 22:03:56,488 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-06 22:04:03,286 - data_loader - INFO - Global statistics computed:
2025-10-06 22:04:03,286 - data_loader - INFO -   Mean: -55.44
2025-10-06 22:04:03,287 - data_loader - INFO -   Std: 100.41
2025-10-06 22:04:03,287 - data_loader - INFO -   Median: -125.00
2025-10-06 22:04:03,291 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-06 22:04:04,220 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-06 22:04:04,221 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 22:04:04,221 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 22:04:05,330 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-06 22:04:05,331 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 22:04:05,331 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 22:04:06,452 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-06 22:04:06,452 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 22:04:06,452 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 22:04:29,186 - data_loader - INFO - Successfully loaded 25 cases
2025-10-06 22:04:29,186 - data_loader - INFO - Loading 4 test cases...
2025-10-06 22:04:33,585 - data_loader - INFO - Final enhanced dataset:
2025-10-06 22:04:33,585 - data_loader - INFO -  Training: 25 cases
2025-10-06 22:04:33,585 - data_loader - INFO -  Validation: 4 cases
2025-10-06 22:04:33,585 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 22:04:33,588 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 22:04:33,589 - __main__ - INFO - Processing Sample 0:
2025-10-06 22:04:33,589 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-06 22:04:33,589 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-06 22:04:33,589 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-06 22:04:33,684 - __main__ - INFO - -------------------------
2025-10-06 22:04:33,684 - __main__ - INFO - Inference Results:
2025-10-06 22:04:33,684 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-06 22:04:33,684 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-06 22:04:33,688 - __main__ - INFO -  - Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 22:04:33,688 - __main__ - INFO - -------------------------
2025-10-06 22:04:33,688 - __main__ - INFO - ==================================================
2025-10-06 22:04:33,688 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-06 22:04:33,688 - __main__ - INFO - ==================================================
2025-10-06 22:04:33,691 - data_loader - INFO - Found 31 training cases
2025-10-06 22:04:33,691 - data_loader - INFO - Found 4 test cases
2025-10-06 22:04:33,691 - data_loader - INFO - Enhanced Dataset Info:
2025-10-06 22:04:33,691 - data_loader - INFO -  Training cases: 31
2025-10-06 22:04:33,691 - data_loader - INFO -  Test cases: 4
2025-10-06 22:04:33,691 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-06 22:04:33,691 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-06 22:04:33,691 - data_loader - INFO -  Normalization: robust
2025-10-06 22:04:33,691 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-06 22:04:39,930 - data_loader - INFO - Global statistics computed:
2025-10-06 22:04:39,931 - data_loader - INFO -   Mean: -55.44
2025-10-06 22:04:39,931 - data_loader - INFO -   Std: 100.41
2025-10-06 22:04:39,931 - data_loader - INFO -   Median: -125.00
2025-10-06 22:04:39,932 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-06 22:04:40,793 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-06 22:04:40,794 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 22:04:40,794 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 22:04:41,916 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-06 22:04:41,916 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 22:04:41,916 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 22:04:43,039 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-06 22:04:43,040 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 22:04:43,040 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 22:05:06,240 - data_loader - INFO - Successfully loaded 25 cases
2025-10-06 22:05:06,241 - data_loader - INFO - Loading 4 test cases...
2025-10-06 22:05:10,694 - data_loader - INFO - Final enhanced dataset:
2025-10-06 22:05:10,694 - data_loader - INFO -  Training: 25 cases
2025-10-06 22:05:10,694 - data_loader - INFO -  Validation: 4 cases
2025-10-06 22:05:10,706 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 22:05:10,737 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 22:05:10,738 - __main__ - INFO - Processing Sample 1/4
2025-10-06 22:05:10,822 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 22:05:10,822 - __main__ - INFO -  - Average Dice Score for Sample 0: 0.0909
2025-10-06 22:05:10,844 - __main__ - ERROR - Visualization failed for sample 0: Invalid shape (11, 64, 64) for image data
2025-10-06 22:05:10,844 - __main__ - INFO - Processing Sample 2/4
2025-10-06 22:05:10,927 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 22:05:10,928 - __main__ - INFO -  - Average Dice Score for Sample 1: 0.0909
2025-10-06 22:05:10,943 - __main__ - ERROR - Visualization failed for sample 1: Invalid shape (11, 64, 64) for image data
2025-10-06 22:05:10,943 - __main__ - INFO - Processing Sample 3/4
2025-10-06 22:05:11,026 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 22:05:11,026 - __main__ - INFO -  - Average Dice Score for Sample 2: 0.0909
2025-10-06 22:05:11,042 - __main__ - ERROR - Visualization failed for sample 2: Invalid shape (11, 64, 64) for image data
2025-10-06 22:05:11,042 - __main__ - INFO - Processing Sample 4/4
2025-10-06 22:05:11,124 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': tensor(0.), 'class_2': tensor(0.), 'class_3': tensor(0.), 'class_4': tensor(0.), 'class_5': tensor(0.), 'class_6': tensor(0.), 'class_7': tensor(0.), 'class_8': tensor(0.), 'class_9': tensor(0.), 'class_10': tensor(0.), 'class_11': 1.0}
2025-10-06 22:05:11,124 - __main__ - INFO -  - Average Dice Score for Sample 3: 0.0909
2025-10-06 22:05:11,140 - __main__ - ERROR - Visualization failed for sample 3: Invalid shape (11, 64, 64) for image data
2025-10-06 22:05:11,140 - __main__ - INFO - ==================================================
2025-10-06 22:05:11,140 - __main__ - INFO - Average Dice score over 4 samples: 0.0909
2025-10-06 22:05:11,140 - __main__ - INFO - ==================================================
2025-10-06 22:05:11,140 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-06 23:09:02,189 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-06 23:09:02,189 - __main__ - INFO - ==================================================
2025-10-06 23:09:02,189 - __main__ - INFO - IRIS Framework Training
2025-10-06 23:09:02,189 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-06 23:09:02,189 - __main__ - INFO - ==================================================
2025-10-06 23:09:02,189 - __main__ - INFO - Configuration: train_config.yaml
2025-10-06 23:09:02,189 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-06 23:09:02,189 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-06 23:09:02,368 - __main__ - INFO - Using device: cuda
2025-10-06 23:09:02,368 - __main__ - INFO - Loading datasets...
2025-10-06 23:09:02,368 - data_loader - INFO - Found 31 training cases
2025-10-06 23:09:02,368 - data_loader - INFO - Found 4 test cases
2025-10-06 23:09:02,368 - data_loader - INFO - Enhanced Dataset Info:
2025-10-06 23:09:02,368 - data_loader - INFO -  Training cases: 31
2025-10-06 23:09:02,368 - data_loader - INFO -  Test cases: 4
2025-10-06 23:09:02,369 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-06 23:09:02,369 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-06 23:09:02,369 - data_loader - INFO -  Normalization: robust
2025-10-06 23:09:02,369 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-06 23:09:08,724 - data_loader - INFO - Global statistics computed:
2025-10-06 23:09:08,725 - data_loader - INFO -   Mean: -55.44
2025-10-06 23:09:08,725 - data_loader - INFO -   Std: 100.41
2025-10-06 23:09:08,725 - data_loader - INFO -   Median: -125.00
2025-10-06 23:09:08,727 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-06 23:09:09,661 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-06 23:09:09,661 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:09:09,662 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:09:10,763 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-06 23:09:10,763 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:09:10,763 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:09:11,889 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-06 23:09:11,890 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:09:11,890 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:09:34,681 - data_loader - INFO - Successfully loaded 25 cases
2025-10-06 23:09:34,681 - data_loader - INFO - Loading 4 test cases...
2025-10-06 23:09:39,056 - data_loader - INFO - Final enhanced dataset:
2025-10-06 23:09:39,056 - data_loader - INFO -  Training: 25 cases
2025-10-06 23:09:39,056 - data_loader - INFO -  Validation: 4 cases
2025-10-06 23:09:39,057 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:09:39,060 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:09:39,060 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-06 23:09:39,188 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-06 23:09:39,188 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-06 23:09:39,188 - __main__ - INFO - Creating Iris model...
2025-10-06 23:09:39,508 - __main__ - INFO - Model Information:
2025-10-06 23:09:39,508 - __main__ - INFO -   total_parameters: 38885850
2025-10-06 23:09:39,508 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-06 23:09:39,508 - __main__ - INFO -   embed_dim: 192
2025-10-06 23:09:39,508 - __main__ - INFO -   num_classes: 11
2025-10-06 23:09:39,508 - __main__ - INFO -   deep_supervision: False
2025-10-06 23:09:39,508 - __main__ - INFO -   multi_scale: True
2025-10-06 23:09:39,508 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-06 23:09:40,555 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-06 23:09:40,555 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-06 23:09:40,555 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-06 23:09:40,556 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-06 23:09:40,556 - __main__ - INFO - Starting training...
2025-10-06 23:09:40,556 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-06 23:09:40,928 - __main__ - ERROR - Training failed with error: name 'final_prediction' is not defined
2025-10-06 23:09:40,928 - __main__ - ERROR - Failed to complete training: name 'final_prediction' is not defined
2025-10-06 23:20:51,628 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-06 23:20:51,628 - __main__ - INFO - ==================================================
2025-10-06 23:20:51,628 - __main__ - INFO - IRIS Framework Training
2025-10-06 23:20:51,628 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-06 23:20:51,628 - __main__ - INFO - ==================================================
2025-10-06 23:20:51,628 - __main__ - INFO - Configuration: train_config.yaml
2025-10-06 23:20:51,628 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-06 23:20:51,628 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-06 23:20:51,757 - __main__ - INFO - Using device: cuda
2025-10-06 23:20:51,757 - __main__ - INFO - Loading datasets...
2025-10-06 23:20:51,758 - data_loader - INFO - Found 31 training cases
2025-10-06 23:20:51,758 - data_loader - INFO - Found 4 test cases
2025-10-06 23:20:51,758 - data_loader - INFO - Enhanced Dataset Info:
2025-10-06 23:20:51,758 - data_loader - INFO -  Training cases: 31
2025-10-06 23:20:51,758 - data_loader - INFO -  Test cases: 4
2025-10-06 23:20:51,758 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-06 23:20:51,758 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-06 23:20:51,758 - data_loader - INFO -  Normalization: robust
2025-10-06 23:20:51,758 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-06 23:20:58,170 - data_loader - INFO - Global statistics computed:
2025-10-06 23:20:58,170 - data_loader - INFO -   Mean: -55.44
2025-10-06 23:20:58,171 - data_loader - INFO -   Std: 100.41
2025-10-06 23:20:58,171 - data_loader - INFO -   Median: -125.00
2025-10-06 23:20:58,173 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-06 23:20:59,100 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-06 23:20:59,100 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:20:59,100 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:21:00,211 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-06 23:21:00,212 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:21:00,212 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:21:01,338 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-06 23:21:01,338 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:21:01,338 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:21:24,222 - data_loader - INFO - Successfully loaded 25 cases
2025-10-06 23:21:24,222 - data_loader - INFO - Loading 4 test cases...
2025-10-06 23:21:28,621 - data_loader - INFO - Final enhanced dataset:
2025-10-06 23:21:28,621 - data_loader - INFO -  Training: 25 cases
2025-10-06 23:21:28,621 - data_loader - INFO -  Validation: 4 cases
2025-10-06 23:21:28,622 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:21:28,625 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:21:28,625 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-06 23:21:28,771 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-06 23:21:28,771 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-06 23:21:28,771 - __main__ - INFO - Creating Iris model...
2025-10-06 23:21:29,100 - __main__ - INFO - Model Information:
2025-10-06 23:21:29,101 - __main__ - INFO -   total_parameters: 38885850
2025-10-06 23:21:29,101 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-06 23:21:29,101 - __main__ - INFO -   embed_dim: 192
2025-10-06 23:21:29,101 - __main__ - INFO -   num_classes: 11
2025-10-06 23:21:29,101 - __main__ - INFO -   deep_supervision: False
2025-10-06 23:21:29,101 - __main__ - INFO -   multi_scale: True
2025-10-06 23:21:29,101 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-06 23:21:29,850 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-06 23:21:29,850 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-06 23:21:29,850 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-06 23:21:29,851 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-06 23:21:29,851 - __main__ - INFO - Starting training...
2025-10-06 23:21:29,851 - __main__ - ERROR - Training failed with error: 'FixedEpisodicTrainer' object has no attribute 'train'
2025-10-06 23:21:29,851 - __main__ - ERROR - Failed to complete training: 'FixedEpisodicTrainer' object has no attribute 'train'
2025-10-06 23:27:53,035 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-06 23:27:53,035 - __main__ - INFO - ==================================================
2025-10-06 23:27:53,035 - __main__ - INFO - IRIS Framework Training
2025-10-06 23:27:53,035 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-06 23:27:53,035 - __main__ - INFO - ==================================================
2025-10-06 23:27:53,035 - __main__ - INFO - Configuration: train_config.yaml
2025-10-06 23:27:53,035 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-06 23:27:53,035 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-06 23:27:53,166 - __main__ - INFO - Using device: cuda
2025-10-06 23:27:53,166 - __main__ - INFO - Loading datasets...
2025-10-06 23:27:53,167 - data_loader - INFO - Found 31 training cases
2025-10-06 23:27:53,167 - data_loader - INFO - Found 4 test cases
2025-10-06 23:27:53,167 - data_loader - INFO - Enhanced Dataset Info:
2025-10-06 23:27:53,167 - data_loader - INFO -  Training cases: 31
2025-10-06 23:27:53,167 - data_loader - INFO -  Test cases: 4
2025-10-06 23:27:53,167 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-06 23:27:53,167 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-06 23:27:53,167 - data_loader - INFO -  Normalization: robust
2025-10-06 23:27:53,167 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-06 23:27:59,548 - data_loader - INFO - Global statistics computed:
2025-10-06 23:27:59,549 - data_loader - INFO -   Mean: -55.44
2025-10-06 23:27:59,549 - data_loader - INFO -   Std: 100.41
2025-10-06 23:27:59,549 - data_loader - INFO -   Median: -125.00
2025-10-06 23:27:59,550 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-06 23:28:00,467 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-06 23:28:00,467 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:28:00,467 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:28:01,575 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-06 23:28:01,575 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:28:01,575 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:28:02,702 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-06 23:28:02,703 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:28:02,703 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:28:25,358 - data_loader - INFO - Successfully loaded 25 cases
2025-10-06 23:28:25,359 - data_loader - INFO - Loading 4 test cases...
2025-10-06 23:28:29,800 - data_loader - INFO - Final enhanced dataset:
2025-10-06 23:28:29,800 - data_loader - INFO -  Training: 25 cases
2025-10-06 23:28:29,800 - data_loader - INFO -  Validation: 4 cases
2025-10-06 23:28:29,801 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-06 23:28:29,804 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-06 23:28:29,804 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-06 23:28:29,935 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-06 23:28:29,935 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-06 23:28:29,935 - __main__ - INFO - Creating Iris model...
2025-10-06 23:28:30,260 - __main__ - INFO - Model Information:
2025-10-06 23:28:30,260 - __main__ - INFO -   total_parameters: 38885850
2025-10-06 23:28:30,260 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-06 23:28:30,260 - __main__ - INFO -   embed_dim: 192
2025-10-06 23:28:30,260 - __main__ - INFO -   num_classes: 11
2025-10-06 23:28:30,260 - __main__ - INFO -   deep_supervision: False
2025-10-06 23:28:30,260 - __main__ - INFO -   multi_scale: True
2025-10-06 23:28:30,260 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-06 23:28:31,118 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-06 23:28:31,118 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-06 23:28:31,118 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-06 23:28:31,120 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-06 23:28:31,120 - __main__ - INFO - Starting training...
2025-10-06 23:28:31,120 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-06 23:28:33,737 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-07 00:04:53,312 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 00:41:24,449 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 01:17:51,120 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 01:54:18,075 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 03:07:11,879 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 03:43:45,024 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 04:56:44,229 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 05:33:07,232 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-07 07:22:19,812 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 09:11:26,610 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 09:47:51,902 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 11:13:46,269 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 11:44:29,986 - __main__ - INFO - Training completed! Final validation DICE: 0.5795
2025-10-07 11:44:30,024 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-07 11:44:30,026 - __main__ - INFO - ==================================================
2025-10-07 11:44:30,026 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-07 11:44:30,026 - __main__ - INFO - ==================================================
2025-10-07 11:44:30,029 - data_loader - INFO - Found 31 training cases
2025-10-07 11:44:30,029 - data_loader - INFO - Found 4 test cases
2025-10-07 11:44:30,029 - data_loader - INFO - Enhanced Dataset Info:
2025-10-07 11:44:30,029 - data_loader - INFO -  Training cases: 31
2025-10-07 11:44:30,029 - data_loader - INFO -  Test cases: 4
2025-10-07 11:44:30,029 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-07 11:44:30,029 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-07 11:44:30,029 - data_loader - INFO -  Normalization: robust
2025-10-07 11:44:30,029 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-07 11:44:36,207 - data_loader - INFO - Global statistics computed:
2025-10-07 11:44:36,207 - data_loader - INFO -   Mean: -55.44
2025-10-07 11:44:36,207 - data_loader - INFO -   Std: 100.41
2025-10-07 11:44:36,207 - data_loader - INFO -   Median: -125.00
2025-10-07 11:44:36,212 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-07 11:44:37,120 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-07 11:44:37,120 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 11:44:37,120 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 11:44:38,268 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-07 11:44:38,269 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 11:44:38,269 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 11:44:39,392 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-07 11:44:39,392 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 11:44:39,392 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 11:45:02,100 - data_loader - INFO - Successfully loaded 25 cases
2025-10-07 11:45:02,100 - data_loader - INFO - Loading 4 test cases...
2025-10-07 11:45:06,445 - data_loader - INFO - Final enhanced dataset:
2025-10-07 11:45:06,445 - data_loader - INFO -  Training: 25 cases
2025-10-07 11:45:06,445 - data_loader - INFO -  Validation: 4 cases
2025-10-07 11:45:06,446 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 11:45:06,449 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 11:45:06,450 - __main__ - INFO - Processing Sample 0:
2025-10-07 11:45:06,450 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-07 11:45:06,450 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-07 11:45:06,450 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-07 11:45:06,571 - __main__ - INFO - -------------------------
2025-10-07 11:45:06,571 - __main__ - INFO - Inference Results:
2025-10-07 11:45:06,571 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-07 11:45:06,571 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-07 11:45:06,571 - __main__ - INFO -  - Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-07 11:45:06,571 - __main__ - INFO - -------------------------
2025-10-07 11:45:06,577 - __main__ - INFO - ==================================================
2025-10-07 11:45:06,577 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-07 11:45:06,577 - __main__ - INFO - ==================================================
2025-10-07 11:45:06,580 - data_loader - INFO - Found 31 training cases
2025-10-07 11:45:06,580 - data_loader - INFO - Found 4 test cases
2025-10-07 11:45:06,580 - data_loader - INFO - Enhanced Dataset Info:
2025-10-07 11:45:06,580 - data_loader - INFO -  Training cases: 31
2025-10-07 11:45:06,580 - data_loader - INFO -  Test cases: 4
2025-10-07 11:45:06,580 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-07 11:45:06,580 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-07 11:45:06,580 - data_loader - INFO -  Normalization: robust
2025-10-07 11:45:06,580 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-07 11:45:12,871 - data_loader - INFO - Global statistics computed:
2025-10-07 11:45:12,871 - data_loader - INFO -   Mean: -55.44
2025-10-07 11:45:12,871 - data_loader - INFO -   Std: 100.41
2025-10-07 11:45:12,871 - data_loader - INFO -   Median: -125.00
2025-10-07 11:45:12,873 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-07 11:45:13,771 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-07 11:45:13,771 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 11:45:13,773 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 11:45:14,889 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-07 11:45:14,889 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 11:45:14,889 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 11:45:16,020 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-07 11:45:16,021 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 11:45:16,021 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 11:45:38,649 - data_loader - INFO - Successfully loaded 25 cases
2025-10-07 11:45:38,650 - data_loader - INFO - Loading 4 test cases...
2025-10-07 11:45:42,976 - data_loader - INFO - Final enhanced dataset:
2025-10-07 11:45:42,977 - data_loader - INFO -  Training: 25 cases
2025-10-07 11:45:42,977 - data_loader - INFO -  Validation: 4 cases
2025-10-07 11:45:42,977 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 11:45:42,980 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 11:45:42,980 - __main__ - INFO - Processing Sample 1/4
2025-10-07 11:45:43,051 - __main__ - ERROR - Failed to complete training: calculate_class_dice() got an unexpected keyword argument 'num_classes'
2025-10-07 14:12:05,684 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-07 14:12:05,684 - __main__ - INFO - ==================================================
2025-10-07 14:12:05,684 - __main__ - INFO - IRIS Framework Training
2025-10-07 14:12:05,684 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-07 14:12:05,684 - __main__ - INFO - ==================================================
2025-10-07 14:12:05,684 - __main__ - INFO - Configuration: train_config.yaml
2025-10-07 14:12:05,684 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-07 14:12:05,684 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-07 14:12:05,775 - __main__ - INFO - Using device: cuda
2025-10-07 14:12:05,775 - __main__ - INFO - Loading datasets...
2025-10-07 14:12:05,776 - data_loader - INFO - Found 31 training cases
2025-10-07 14:12:05,776 - data_loader - INFO - Found 4 test cases
2025-10-07 14:12:05,776 - data_loader - INFO - Enhanced Dataset Info:
2025-10-07 14:12:05,776 - data_loader - INFO -  Training cases: 31
2025-10-07 14:12:05,776 - data_loader - INFO -  Test cases: 4
2025-10-07 14:12:05,776 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-07 14:12:05,776 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-07 14:12:05,776 - data_loader - INFO -  Normalization: robust
2025-10-07 14:12:05,776 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-07 14:12:12,579 - data_loader - INFO - Global statistics computed:
2025-10-07 14:12:12,579 - data_loader - INFO -   Mean: -55.44
2025-10-07 14:12:12,579 - data_loader - INFO -   Std: 100.41
2025-10-07 14:12:12,579 - data_loader - INFO -   Median: -125.00
2025-10-07 14:12:12,581 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-07 14:12:13,570 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-07 14:12:13,570 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 14:12:13,570 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 14:12:14,714 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-07 14:12:14,714 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 14:12:14,714 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 14:12:15,890 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-07 14:12:15,890 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 14:12:15,890 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 14:12:41,689 - data_loader - INFO - Successfully loaded 25 cases
2025-10-07 14:12:41,689 - data_loader - INFO - Loading 4 test cases...
2025-10-07 14:12:46,434 - data_loader - INFO - Final enhanced dataset:
2025-10-07 14:12:46,434 - data_loader - INFO -  Training: 25 cases
2025-10-07 14:12:46,434 - data_loader - INFO -  Validation: 4 cases
2025-10-07 14:12:46,435 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-07 14:12:46,438 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-07 14:12:46,438 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-07 14:12:46,683 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-07 14:12:46,683 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-07 14:12:46,683 - __main__ - INFO - Creating Iris model...
2025-10-07 14:12:47,127 - __main__ - INFO - Model Information:
2025-10-07 14:12:47,127 - __main__ - INFO -   total_parameters: 38885850
2025-10-07 14:12:47,127 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-07 14:12:47,127 - __main__ - INFO -   embed_dim: 192
2025-10-07 14:12:47,127 - __main__ - INFO -   num_classes: 11
2025-10-07 14:12:47,127 - __main__ - INFO -   deep_supervision: False
2025-10-07 14:12:47,127 - __main__ - INFO -   multi_scale: True
2025-10-07 14:12:47,127 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-07 14:12:48,089 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-07 14:12:48,089 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-07 14:12:48,089 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-07 14:12:48,090 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-07 14:12:48,090 - __main__ - INFO - Starting training...
2025-10-07 14:12:48,091 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-07 14:12:51,039 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-07 15:17:19,423 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 16:21:09,733 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 17:24:48,002 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 18:20:43,161 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 21:47:01,094 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-07 23:30:34,424 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-08 00:22:35,689 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 02:06:38,984 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 03:49:02,108 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 07:44:21,020 - __main__ - INFO - Training completed! Final validation DICE: 0.5341
2025-10-08 07:44:21,060 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-08 07:44:21,062 - __main__ - INFO - ==================================================
2025-10-08 07:44:21,062 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-08 07:44:21,062 - __main__ - INFO - ==================================================
2025-10-08 07:44:21,065 - data_loader - INFO - Found 31 training cases
2025-10-08 07:44:21,065 - data_loader - INFO - Found 4 test cases
2025-10-08 07:44:21,065 - data_loader - INFO - Enhanced Dataset Info:
2025-10-08 07:44:21,065 - data_loader - INFO -  Training cases: 31
2025-10-08 07:44:21,065 - data_loader - INFO -  Test cases: 4
2025-10-08 07:44:21,065 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-08 07:44:21,065 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-08 07:44:21,065 - data_loader - INFO -  Normalization: robust
2025-10-08 07:44:21,065 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-08 07:44:27,275 - data_loader - INFO - Global statistics computed:
2025-10-08 07:44:27,275 - data_loader - INFO -   Mean: -55.44
2025-10-08 07:44:27,275 - data_loader - INFO -   Std: 100.41
2025-10-08 07:44:27,275 - data_loader - INFO -   Median: -125.00
2025-10-08 07:44:27,280 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-08 07:44:28,182 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-08 07:44:28,182 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 07:44:28,182 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 07:44:29,293 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-08 07:44:29,294 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 07:44:29,294 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 07:44:30,415 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-08 07:44:30,415 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 07:44:30,415 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 07:44:53,000 - data_loader - INFO - Successfully loaded 25 cases
2025-10-08 07:44:53,000 - data_loader - INFO - Loading 4 test cases...
2025-10-08 07:44:57,352 - data_loader - INFO - Final enhanced dataset:
2025-10-08 07:44:57,352 - data_loader - INFO -  Training: 25 cases
2025-10-08 07:44:57,352 - data_loader - INFO -  Validation: 4 cases
2025-10-08 07:44:57,352 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 07:44:57,356 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 07:44:57,357 - __main__ - INFO - Processing Sample 0:
2025-10-08 07:44:57,357 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-08 07:44:57,357 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-08 07:44:57,357 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-08 07:44:57,541 - __main__ - INFO - -------------------------
2025-10-08 07:44:57,541 - __main__ - INFO - Inference Results:
2025-10-08 07:44:57,541 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-08 07:44:57,541 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-08 07:44:57,541 - __main__ - INFO -  - Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-08 07:44:57,541 - __main__ - INFO - -------------------------
2025-10-08 07:44:57,544 - __main__ - INFO - ==================================================
2025-10-08 07:44:57,544 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-08 07:44:57,544 - __main__ - INFO - ==================================================
2025-10-08 07:44:57,546 - data_loader - INFO - Found 31 training cases
2025-10-08 07:44:57,546 - data_loader - INFO - Found 4 test cases
2025-10-08 07:44:57,547 - data_loader - INFO - Enhanced Dataset Info:
2025-10-08 07:44:57,547 - data_loader - INFO -  Training cases: 31
2025-10-08 07:44:57,547 - data_loader - INFO -  Test cases: 4
2025-10-08 07:44:57,547 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-08 07:44:57,547 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-08 07:44:57,547 - data_loader - INFO -  Normalization: robust
2025-10-08 07:44:57,547 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-08 07:45:03,731 - data_loader - INFO - Global statistics computed:
2025-10-08 07:45:03,731 - data_loader - INFO -   Mean: -55.44
2025-10-08 07:45:03,731 - data_loader - INFO -   Std: 100.41
2025-10-08 07:45:03,731 - data_loader - INFO -   Median: -125.00
2025-10-08 07:45:03,732 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-08 07:45:04,645 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-08 07:45:04,645 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 07:45:04,645 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 07:45:05,765 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-08 07:45:05,766 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 07:45:05,766 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 07:45:06,886 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-08 07:45:06,886 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 07:45:06,886 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 07:45:29,530 - data_loader - INFO - Successfully loaded 25 cases
2025-10-08 07:45:29,530 - data_loader - INFO - Loading 4 test cases...
2025-10-08 07:45:33,871 - data_loader - INFO - Final enhanced dataset:
2025-10-08 07:45:33,871 - data_loader - INFO -  Training: 25 cases
2025-10-08 07:45:33,871 - data_loader - INFO -  Validation: 4 cases
2025-10-08 07:45:33,872 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 07:45:33,875 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 07:45:33,875 - __main__ - INFO - Processing Sample 1/4
2025-10-08 07:45:34,024 - __main__ - INFO -  - Class-wise Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-08 07:45:34,024 - __main__ - INFO -  - Average Dice Score for Sample 0: 0.0000
2025-10-08 07:45:34,243 - __main__ - INFO - Processing Sample 2/4
2025-10-08 07:45:34,379 - __main__ - INFO -  - Class-wise Dice Score: {'class_1': 0.0, 'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-08 07:45:34,379 - __main__ - INFO -  - Average Dice Score for Sample 1: 0.0000
2025-10-08 07:45:34,566 - __main__ - INFO - Processing Sample 3/4
2025-10-08 07:45:34,701 - __main__ - INFO -  - Class-wise Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-08 07:45:34,701 - __main__ - INFO -  - Average Dice Score for Sample 2: 0.0000
2025-10-08 07:45:34,883 - __main__ - INFO - Processing Sample 4/4
2025-10-08 07:45:35,016 - __main__ - INFO -  - Class-wise Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-08 07:45:35,016 - __main__ - INFO -  - Average Dice Score for Sample 3: 0.0000
2025-10-08 07:45:35,198 - __main__ - INFO - ==================================================
2025-10-08 07:45:35,198 - __main__ - INFO - Average Dice score over 4 samples: 0.0000
2025-10-08 07:45:35,198 - __main__ - INFO - ==================================================
2025-10-08 07:45:35,202 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-08 09:35:58,800 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-08 09:35:58,800 - __main__ - INFO - ==================================================
2025-10-08 09:35:58,800 - __main__ - INFO - IRIS Framework Training
2025-10-08 09:35:58,800 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-08 09:35:58,800 - __main__ - INFO - ==================================================
2025-10-08 09:35:58,800 - __main__ - INFO - Configuration: train_config.yaml
2025-10-08 09:35:58,800 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-08 09:35:58,800 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-08 09:35:58,872 - __main__ - INFO - Using device: cuda
2025-10-08 09:35:58,872 - __main__ - INFO - Loading datasets...
2025-10-08 09:35:58,872 - data_loader - INFO - Found 31 training cases
2025-10-08 09:35:58,872 - data_loader - INFO - Found 4 test cases
2025-10-08 09:35:58,872 - data_loader - INFO - Enhanced Dataset Info:
2025-10-08 09:35:58,872 - data_loader - INFO -  Training cases: 31
2025-10-08 09:35:58,872 - data_loader - INFO -  Test cases: 4
2025-10-08 09:35:58,872 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-08 09:35:58,872 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-08 09:35:58,872 - data_loader - INFO -  Normalization: robust
2025-10-08 09:35:58,873 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-08 09:36:05,395 - data_loader - INFO - Global statistics computed:
2025-10-08 09:36:05,396 - data_loader - INFO -   Mean: -55.44
2025-10-08 09:36:05,396 - data_loader - INFO -   Std: 100.41
2025-10-08 09:36:05,396 - data_loader - INFO -   Median: -125.00
2025-10-08 09:36:05,398 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-08 09:36:06,444 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-08 09:36:06,445 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 09:36:06,445 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 09:36:07,614 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-08 09:36:07,615 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 09:36:07,615 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 09:36:08,808 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-08 09:36:08,808 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 09:36:08,808 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 09:36:31,715 - data_loader - INFO - Successfully loaded 25 cases
2025-10-08 09:36:31,715 - data_loader - INFO - Loading 4 test cases...
2025-10-08 09:36:36,052 - data_loader - INFO - Final enhanced dataset:
2025-10-08 09:36:36,052 - data_loader - INFO -  Training: 25 cases
2025-10-08 09:36:36,052 - data_loader - INFO -  Validation: 4 cases
2025-10-08 09:36:36,052 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 09:36:36,055 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 09:36:36,055 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-08 09:36:36,180 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-08 09:36:36,180 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-08 09:36:36,180 - __main__ - INFO - Creating Iris model...
2025-10-08 09:36:36,503 - __main__ - INFO - Model Information:
2025-10-08 09:36:36,503 - __main__ - INFO -   total_parameters: 38885850
2025-10-08 09:36:36,503 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-08 09:36:36,503 - __main__ - INFO -   embed_dim: 192
2025-10-08 09:36:36,503 - __main__ - INFO -   num_classes: 11
2025-10-08 09:36:36,503 - __main__ - INFO -   deep_supervision: False
2025-10-08 09:36:36,503 - __main__ - INFO -   multi_scale: True
2025-10-08 09:36:36,503 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-08 09:36:37,260 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-08 09:36:37,260 - fixed_episodic_trainer - INFO - Warmup iterations: 2000
2025-10-08 09:36:37,260 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-08 09:36:37,262 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-08 09:36:37,262 - __main__ - INFO - Starting training...
2025-10-08 09:36:37,262 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-08 09:36:39,877 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-08 10:13:10,873 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 10:49:50,607 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 11:26:20,776 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 12:04:41,459 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 13:20:52,664 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 14:12:43,525 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 14:50:50,914 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 15:28:04,808 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 16:05:30,862 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 16:05:31,566 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-08 20:31:45,779 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 21:08:41,334 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 21:45:26,576 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-08 22:10:39,570 - __main__ - INFO - Training completed! Final validation DICE: 0.5620
2025-10-08 22:10:39,615 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-08 22:10:39,617 - __main__ - INFO - ==================================================
2025-10-08 22:10:39,617 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-08 22:10:39,617 - __main__ - INFO - ==================================================
2025-10-08 22:10:39,620 - data_loader - INFO - Found 31 training cases
2025-10-08 22:10:39,620 - data_loader - INFO - Found 4 test cases
2025-10-08 22:10:39,620 - data_loader - INFO - Enhanced Dataset Info:
2025-10-08 22:10:39,620 - data_loader - INFO -  Training cases: 31
2025-10-08 22:10:39,620 - data_loader - INFO -  Test cases: 4
2025-10-08 22:10:39,621 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-08 22:10:39,621 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-08 22:10:39,621 - data_loader - INFO -  Normalization: robust
2025-10-08 22:10:39,621 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-08 22:10:45,988 - data_loader - INFO - Global statistics computed:
2025-10-08 22:10:45,988 - data_loader - INFO -   Mean: -55.44
2025-10-08 22:10:45,988 - data_loader - INFO -   Std: 100.41
2025-10-08 22:10:45,988 - data_loader - INFO -   Median: -125.00
2025-10-08 22:10:45,992 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-08 22:10:46,901 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-08 22:10:46,901 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 22:10:46,902 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 22:10:48,093 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-08 22:10:48,094 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 22:10:48,094 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 22:10:49,307 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-08 22:10:49,308 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 22:10:49,308 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 22:11:12,463 - data_loader - INFO - Successfully loaded 25 cases
2025-10-08 22:11:12,464 - data_loader - INFO - Loading 4 test cases...
2025-10-08 22:11:16,863 - data_loader - INFO - Final enhanced dataset:
2025-10-08 22:11:16,863 - data_loader - INFO -  Training: 25 cases
2025-10-08 22:11:16,863 - data_loader - INFO -  Validation: 4 cases
2025-10-08 22:11:16,863 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 22:11:16,866 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 22:11:16,867 - __main__ - INFO - Processing Sample 0:
2025-10-08 22:11:16,867 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-08 22:11:16,867 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-08 22:11:16,867 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-08 22:11:16,993 - __main__ - INFO - -------------------------
2025-10-08 22:11:16,993 - __main__ - INFO - Inference Results:
2025-10-08 22:11:16,993 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-08 22:11:16,993 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-08 22:11:16,993 - __main__ - INFO -  - Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-08 22:11:16,993 - __main__ - INFO - -------------------------
2025-10-08 22:11:16,999 - __main__ - INFO - ==================================================
2025-10-08 22:11:16,999 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-08 22:11:16,999 - __main__ - INFO - ==================================================
2025-10-08 22:11:17,002 - data_loader - INFO - Found 31 training cases
2025-10-08 22:11:17,002 - data_loader - INFO - Found 4 test cases
2025-10-08 22:11:17,002 - data_loader - INFO - Enhanced Dataset Info:
2025-10-08 22:11:17,002 - data_loader - INFO -  Training cases: 31
2025-10-08 22:11:17,002 - data_loader - INFO -  Test cases: 4
2025-10-08 22:11:17,002 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-08 22:11:17,002 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-08 22:11:17,002 - data_loader - INFO -  Normalization: robust
2025-10-08 22:11:17,002 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-08 22:11:23,457 - data_loader - INFO - Global statistics computed:
2025-10-08 22:11:23,457 - data_loader - INFO -   Mean: -55.44
2025-10-08 22:11:23,457 - data_loader - INFO -   Std: 100.41
2025-10-08 22:11:23,457 - data_loader - INFO -   Median: -125.00
2025-10-08 22:11:23,458 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-08 22:11:24,384 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-08 22:11:24,384 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 22:11:24,384 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 22:11:25,508 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-08 22:11:25,508 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 22:11:25,508 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 22:11:26,649 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-08 22:11:26,649 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 22:11:26,649 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 22:11:50,154 - data_loader - INFO - Successfully loaded 25 cases
2025-10-08 22:11:50,154 - data_loader - INFO - Loading 4 test cases...
2025-10-08 22:11:54,549 - data_loader - INFO - Final enhanced dataset:
2025-10-08 22:11:54,549 - data_loader - INFO -  Training: 25 cases
2025-10-08 22:11:54,549 - data_loader - INFO -  Validation: 4 cases
2025-10-08 22:11:54,550 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-08 22:11:54,553 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-08 22:11:54,557 - __main__ - INFO - [DEBUG] Task Defined by Reference Class ID: 2
2025-10-08 22:11:54,557 - __main__ - INFO - [DEBUG] Reference Mask Shape (Binary): torch.Size([1, 1, 64, 64, 64])
2025-10-08 22:11:54,557 - __main__ - INFO - --------------------------------------------------
2025-10-08 22:11:54,557 - __main__ - INFO - Processing Sample 1/4
2025-10-08 22:11:54,679 - __main__ - INFO -  - Dice Score (Task 2 overlap): 0.0000
2025-10-08 22:11:54,872 - __main__ - INFO - Processing Sample 2/4
2025-10-08 22:11:54,984 - __main__ - INFO -  - Dice Score (Task 2 overlap): 0.0000
2025-10-08 22:11:55,163 - __main__ - INFO - Processing Sample 3/4
2025-10-08 22:11:55,274 - __main__ - INFO -  - Dice Score (Task 2 overlap): 0.0000
2025-10-08 22:11:55,453 - __main__ - INFO - Processing Sample 4/4
2025-10-08 22:11:55,567 - __main__ - INFO -  - Dice Score (Task 2 overlap): 0.0000
2025-10-08 22:11:55,745 - __main__ - INFO - ==================================================
2025-10-08 22:11:55,745 - __main__ - INFO - Average Dice score over 4 samples: 0.0000
2025-10-08 22:11:55,745 - __main__ - INFO - ==================================================
2025-10-08 22:11:55,745 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-09 03:17:01,300 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-09 03:17:01,300 - __main__ - INFO - ==================================================
2025-10-09 03:17:01,300 - __main__ - INFO - IRIS Framework Training
2025-10-09 03:17:01,300 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-09 03:17:01,300 - __main__ - INFO - ==================================================
2025-10-09 03:17:01,300 - __main__ - INFO - Configuration: train_config.yaml
2025-10-09 03:17:01,300 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-09 03:17:01,300 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-09 03:17:01,428 - __main__ - INFO - Using device: cuda
2025-10-09 03:17:01,428 - __main__ - INFO - Loading datasets...
2025-10-09 03:17:01,429 - data_loader - INFO - Found 31 training cases
2025-10-09 03:17:01,429 - data_loader - INFO - Found 4 test cases
2025-10-09 03:17:01,429 - data_loader - INFO - Enhanced Dataset Info:
2025-10-09 03:17:01,429 - data_loader - INFO -  Training cases: 31
2025-10-09 03:17:01,429 - data_loader - INFO -  Test cases: 4
2025-10-09 03:17:01,429 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-09 03:17:01,429 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-09 03:17:01,429 - data_loader - INFO -  Normalization: robust
2025-10-09 03:17:01,429 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-09 03:17:08,673 - data_loader - INFO - Global statistics computed:
2025-10-09 03:17:08,673 - data_loader - INFO -   Mean: -55.44
2025-10-09 03:17:08,674 - data_loader - INFO -   Std: 100.41
2025-10-09 03:17:08,674 - data_loader - INFO -   Median: -125.00
2025-10-09 03:17:08,676 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-09 03:17:09,765 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-09 03:17:09,765 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-09 03:17:09,765 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-09 03:17:11,060 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-09 03:17:11,061 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-09 03:17:11,061 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-09 03:17:12,407 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-09 03:17:12,408 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-09 03:17:12,408 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-09 03:17:37,170 - data_loader - INFO - Successfully loaded 25 cases
2025-10-09 03:17:37,170 - data_loader - INFO - Loading 4 test cases...
2025-10-09 03:17:41,986 - data_loader - INFO - Final enhanced dataset:
2025-10-09 03:17:41,986 - data_loader - INFO -  Training: 25 cases
2025-10-09 03:17:41,986 - data_loader - INFO -  Validation: 4 cases
2025-10-09 03:17:41,990 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-09 03:17:41,993 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-09 03:17:41,993 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-09 03:17:42,137 - __main__ - INFO - Training dataset: 40000 episodes
2025-10-09 03:17:42,137 - __main__ - INFO - Validation dataset: 10000 episodes
2025-10-09 03:17:42,137 - __main__ - INFO - Creating Iris model...
2025-10-09 03:17:42,470 - __main__ - INFO - Model Information:
2025-10-09 03:17:42,471 - __main__ - INFO -   total_parameters: 38885850
2025-10-09 03:17:42,471 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-09 03:17:42,471 - __main__ - INFO -   embed_dim: 192
2025-10-09 03:17:42,471 - __main__ - INFO -   num_classes: 11
2025-10-09 03:17:42,471 - __main__ - INFO -   deep_supervision: False
2025-10-09 03:17:42,471 - __main__ - INFO -   multi_scale: True
2025-10-09 03:17:42,471 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-09 03:17:43,414 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-09 03:17:43,414 - fixed_episodic_trainer - INFO - Warmup iterations: 4000
2025-10-09 03:17:43,414 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-09 03:17:43,415 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-09 03:17:43,415 - __main__ - INFO - Starting training...
2025-10-09 03:17:43,415 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-09 03:17:46,132 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-09 04:08:32,106 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 04:59:05,656 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 05:47:24,690 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 07:22:50,000 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 08:58:15,562 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 10:33:46,204 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 11:21:29,057 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-09 12:09:17,277 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 13:29:23,508 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 23:04:01,561 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-09 23:04:02,002 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_20000.pth
2025-10-10 00:03:17,491 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-10 00:55:11,074 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-10 02:30:24,560 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-10 07:15:33,204 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_30000.pth
2025-10-10 11:13:15,641 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-10 13:36:19,706 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-10 14:49:01,277 - __main__ - INFO - Training completed! Final validation DICE: 0.7423
2025-10-10 14:49:01,364 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-10 14:49:01,369 - __main__ - INFO - ==================================================
2025-10-10 14:49:01,369 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-10 14:49:01,369 - __main__ - INFO - ==================================================
2025-10-10 14:49:01,378 - data_loader - INFO - Found 31 training cases
2025-10-10 14:49:01,378 - data_loader - INFO - Found 4 test cases
2025-10-10 14:49:01,378 - data_loader - INFO - Enhanced Dataset Info:
2025-10-10 14:49:01,378 - data_loader - INFO -  Training cases: 31
2025-10-10 14:49:01,378 - data_loader - INFO -  Test cases: 4
2025-10-10 14:49:01,378 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-10 14:49:01,378 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-10 14:49:01,378 - data_loader - INFO -  Normalization: robust
2025-10-10 14:49:01,378 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-10 14:49:10,675 - data_loader - INFO - Global statistics computed:
2025-10-10 14:49:10,675 - data_loader - INFO -   Mean: -55.44
2025-10-10 14:49:10,675 - data_loader - INFO -   Std: 100.41
2025-10-10 14:49:10,675 - data_loader - INFO -   Median: -125.00
2025-10-10 14:49:10,680 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-10 14:49:11,621 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-10 14:49:11,621 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 14:49:11,621 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 14:49:12,822 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-10 14:49:12,823 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 14:49:12,823 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 14:49:13,995 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-10 14:49:13,995 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 14:49:13,995 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 14:49:38,808 - data_loader - INFO - Successfully loaded 25 cases
2025-10-10 14:49:38,809 - data_loader - INFO - Loading 4 test cases...
2025-10-10 14:49:43,843 - data_loader - INFO - Final enhanced dataset:
2025-10-10 14:49:43,843 - data_loader - INFO -  Training: 25 cases
2025-10-10 14:49:43,843 - data_loader - INFO -  Validation: 4 cases
2025-10-10 14:49:43,844 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 14:49:43,848 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 14:49:43,851 - __main__ - INFO - Processing Sample 0:
2025-10-10 14:49:43,851 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-10 14:49:43,851 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-10 14:49:43,851 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-10 14:49:43,986 - __main__ - INFO - -------------------------
2025-10-10 14:49:43,986 - __main__ - INFO - Inference Results:
2025-10-10 14:49:43,986 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-10 14:49:43,986 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-10 14:49:43,986 - __main__ - INFO -  - Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-10 14:49:43,986 - __main__ - INFO - -------------------------
2025-10-10 14:49:43,990 - __main__ - INFO - ==================================================
2025-10-10 14:49:43,990 - __main__ - INFO - Running Real Inference (Multiple Samples - Top 5)
2025-10-10 14:49:43,990 - __main__ - INFO - ==================================================
2025-10-10 14:49:43,994 - data_loader - INFO - Found 31 training cases
2025-10-10 14:49:43,994 - data_loader - INFO - Found 4 test cases
2025-10-10 14:49:43,994 - data_loader - INFO - Enhanced Dataset Info:
2025-10-10 14:49:43,994 - data_loader - INFO -  Training cases: 31
2025-10-10 14:49:43,994 - data_loader - INFO -  Test cases: 4
2025-10-10 14:49:43,994 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-10 14:49:43,994 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-10 14:49:43,994 - data_loader - INFO -  Normalization: robust
2025-10-10 14:49:43,994 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-10 14:49:53,858 - data_loader - INFO - Global statistics computed:
2025-10-10 14:49:53,858 - data_loader - INFO -   Mean: -55.44
2025-10-10 14:49:53,858 - data_loader - INFO -   Std: 100.41
2025-10-10 14:49:53,858 - data_loader - INFO -   Median: -125.00
2025-10-10 14:49:53,860 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-10 14:49:54,956 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-10 14:49:54,956 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 14:49:54,956 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 14:49:56,369 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-10 14:49:56,370 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 14:49:56,370 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 14:49:57,776 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-10 14:49:57,777 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 14:49:57,777 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 14:50:24,607 - data_loader - INFO - Successfully loaded 25 cases
2025-10-10 14:50:24,608 - data_loader - INFO - Loading 4 test cases...
2025-10-10 14:50:30,087 - data_loader - INFO - Final enhanced dataset:
2025-10-10 14:50:30,087 - data_loader - INFO -  Training: 25 cases
2025-10-10 14:50:30,087 - data_loader - INFO -  Validation: 4 cases
2025-10-10 14:50:30,088 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 14:50:30,091 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 14:50:30,097 - __main__ - INFO - [DEBUG] Task Defined by Reference Class ID: 2
2025-10-10 14:50:30,097 - __main__ - INFO - [DEBUG] Reference Mask Shape (Binary): torch.Size([1, 1, 64, 64, 64])
2025-10-10 14:50:30,097 - __main__ - INFO - --------------------------------------------------
2025-10-10 14:50:30,097 - __main__ - INFO - Processing Sample 1/4
2025-10-10 14:50:30,226 - __main__ - INFO -  - Dice Score (Task 2 overlap): 0.0000
2025-10-10 14:50:30,422 - __main__ - INFO - Processing Sample 2/4
2025-10-10 14:50:30,545 - __main__ - INFO -  - Dice Score (Task 2 overlap): 0.0000
2025-10-10 14:50:30,715 - __main__ - INFO - Processing Sample 3/4
2025-10-10 14:50:30,830 - __main__ - INFO -  - Dice Score (Task 2 overlap): 0.0000
2025-10-10 14:50:31,157 - __main__ - INFO - Processing Sample 4/4
2025-10-10 14:50:31,277 - __main__ - INFO -  - Dice Score (Task 2 overlap): 0.0000
2025-10-10 14:50:31,447 - __main__ - INFO - ==================================================
2025-10-10 14:50:31,447 - __main__ - INFO - Average Dice score over 4 samples: 0.0000
2025-10-10 14:50:31,447 - __main__ - INFO - ==================================================
2025-10-10 14:50:31,447 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-10 18:32:03,943 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-10 18:32:03,943 - __main__ - INFO - ==================================================
2025-10-10 18:32:03,943 - __main__ - INFO - IRIS Framework Training
2025-10-10 18:32:03,943 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-10 18:32:03,943 - __main__ - INFO - ==================================================
2025-10-10 18:32:03,943 - __main__ - INFO - Configuration: train_config.yaml
2025-10-10 18:32:03,943 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-10 18:32:03,943 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-10 18:32:04,021 - __main__ - INFO - Using device: cuda
2025-10-10 18:32:04,021 - __main__ - INFO - Loading datasets...
2025-10-10 18:32:04,023 - data_loader - INFO - Found 31 training cases
2025-10-10 18:32:04,023 - data_loader - INFO - Found 4 test cases
2025-10-10 18:32:04,024 - data_loader - INFO - Enhanced Dataset Info:
2025-10-10 18:32:04,024 - data_loader - INFO -  Training cases: 31
2025-10-10 18:32:04,024 - data_loader - INFO -  Test cases: 4
2025-10-10 18:32:04,024 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-10 18:32:04,024 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-10 18:32:04,024 - data_loader - INFO -  Normalization: robust
2025-10-10 18:32:04,024 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-10 18:32:13,650 - data_loader - INFO - Global statistics computed:
2025-10-10 18:32:13,650 - data_loader - INFO -   Mean: -55.44
2025-10-10 18:32:13,650 - data_loader - INFO -   Std: 100.41
2025-10-10 18:32:13,650 - data_loader - INFO -   Median: -125.00
2025-10-10 18:32:13,652 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-10 18:32:14,623 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-10 18:32:14,623 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 18:32:14,623 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 18:32:15,747 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-10 18:32:15,747 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 18:32:15,747 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 18:32:16,938 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-10 18:32:16,939 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 18:32:16,939 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 18:32:40,608 - data_loader - INFO - Successfully loaded 25 cases
2025-10-10 18:32:40,608 - data_loader - INFO - Loading 4 test cases...
2025-10-10 18:32:44,962 - data_loader - INFO - Final enhanced dataset:
2025-10-10 18:32:44,963 - data_loader - INFO -  Training: 25 cases
2025-10-10 18:32:44,963 - data_loader - INFO -  Validation: 4 cases
2025-10-10 18:32:44,963 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 18:32:44,966 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 18:32:44,966 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-10 18:32:45,125 - __main__ - INFO - Training dataset: 40000 episodes
2025-10-10 18:32:45,125 - __main__ - INFO - Validation dataset: 10000 episodes
2025-10-10 18:32:45,125 - __main__ - INFO - Creating Iris model...
2025-10-10 18:32:45,454 - __main__ - INFO - Model Information:
2025-10-10 18:32:45,454 - __main__ - INFO -   total_parameters: 38885850
2025-10-10 18:32:45,454 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-10 18:32:45,454 - __main__ - INFO -   embed_dim: 192
2025-10-10 18:32:45,454 - __main__ - INFO -   num_classes: 11
2025-10-10 18:32:45,454 - __main__ - INFO -   deep_supervision: False
2025-10-10 18:32:45,454 - __main__ - INFO -   multi_scale: True
2025-10-10 18:32:45,454 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-10 18:32:46,315 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-10 18:32:46,315 - fixed_episodic_trainer - INFO - Warmup iterations: 4000
2025-10-10 18:32:46,315 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-10 18:32:46,316 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-10 18:32:46,316 - __main__ - INFO - Starting training...
2025-10-10 18:32:46,316 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-10 19:10:27,362 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-10 19:10:27,362 - __main__ - INFO - ==================================================
2025-10-10 19:10:27,362 - __main__ - INFO - IRIS Framework Training
2025-10-10 19:10:27,362 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-10 19:10:27,362 - __main__ - INFO - ==================================================
2025-10-10 19:10:27,362 - __main__ - INFO - Configuration: train_config.yaml
2025-10-10 19:10:27,362 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-10 19:10:27,362 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-10 19:10:27,442 - __main__ - INFO - Using device: cuda
2025-10-10 19:10:27,442 - __main__ - INFO - Loading datasets...
2025-10-10 19:10:27,442 - data_loader - INFO - Found 31 training cases
2025-10-10 19:10:27,442 - data_loader - INFO - Found 4 test cases
2025-10-10 19:10:27,442 - data_loader - INFO - Enhanced Dataset Info:
2025-10-10 19:10:27,442 - data_loader - INFO -  Training cases: 31
2025-10-10 19:10:27,442 - data_loader - INFO -  Test cases: 4
2025-10-10 19:10:27,442 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-10 19:10:27,442 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-10 19:10:27,442 - data_loader - INFO -  Normalization: robust
2025-10-10 19:10:27,442 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-10 19:10:35,879 - data_loader - INFO - Global statistics computed:
2025-10-10 19:10:35,880 - data_loader - INFO -   Mean: -55.44
2025-10-10 19:10:35,880 - data_loader - INFO -   Std: 100.41
2025-10-10 19:10:35,880 - data_loader - INFO -   Median: -125.00
2025-10-10 19:10:35,882 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-10 19:10:36,848 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-10 19:10:36,848 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 19:10:36,848 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 19:10:38,007 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-10 19:10:38,007 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 19:10:38,007 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 19:10:39,177 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-10 19:10:39,177 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 19:10:39,177 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 19:11:05,646 - data_loader - INFO - Successfully loaded 25 cases
2025-10-10 19:11:05,646 - data_loader - INFO - Loading 4 test cases...
2025-10-10 19:11:11,225 - data_loader - INFO - Final enhanced dataset:
2025-10-10 19:11:11,226 - data_loader - INFO -  Training: 25 cases
2025-10-10 19:11:11,226 - data_loader - INFO -  Validation: 4 cases
2025-10-10 19:11:11,226 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-10 19:11:11,230 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-10 19:11:11,230 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-10 19:11:11,379 - __main__ - INFO - Training dataset: 40000 episodes
2025-10-10 19:11:11,379 - __main__ - INFO - Validation dataset: 10000 episodes
2025-10-10 19:11:11,379 - __main__ - INFO - Creating Iris model...
2025-10-10 19:11:11,779 - __main__ - INFO - Model Information:
2025-10-10 19:11:11,780 - __main__ - INFO -   total_parameters: 38885850
2025-10-10 19:11:11,780 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-10 19:11:11,780 - __main__ - INFO -   embed_dim: 192
2025-10-10 19:11:11,780 - __main__ - INFO -   num_classes: 11
2025-10-10 19:11:11,780 - __main__ - INFO -   deep_supervision: False
2025-10-10 19:11:11,780 - __main__ - INFO -   multi_scale: True
2025-10-10 19:11:11,780 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-10 19:11:12,801 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-10 19:11:12,801 - fixed_episodic_trainer - INFO - Warmup iterations: 4000
2025-10-10 19:11:12,801 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-10 19:11:12,802 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-10 19:11:12,802 - __main__ - INFO - Starting training...
2025-10-10 19:11:12,802 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-10 19:11:16,613 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-10 20:35:54,334 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-10 21:23:37,469 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-10 22:11:19,888 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 00:34:43,447 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 01:22:30,035 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 02:10:17,052 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 03:45:58,249 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-11 05:21:46,024 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 06:57:10,850 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 15:32:52,232 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-11 15:32:52,232 - __main__ - INFO - ==================================================
2025-10-11 15:32:52,232 - __main__ - INFO - IRIS Framework Training
2025-10-11 15:32:52,232 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-11 15:32:52,232 - __main__ - INFO - ==================================================
2025-10-11 15:32:52,232 - __main__ - INFO - Configuration: train_config.yaml
2025-10-11 15:32:52,232 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-11 15:32:52,232 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-11 15:32:52,311 - __main__ - INFO - Using device: cuda
2025-10-11 15:32:52,311 - __main__ - INFO - Loading datasets...
2025-10-11 15:32:52,320 - data_loader - INFO - Found 31 training cases
2025-10-11 15:32:52,320 - data_loader - INFO - Found 4 test cases
2025-10-11 15:32:52,320 - data_loader - INFO - Enhanced Dataset Info:
2025-10-11 15:32:52,320 - data_loader - INFO -  Training cases: 31
2025-10-11 15:32:52,320 - data_loader - INFO -  Test cases: 4
2025-10-11 15:32:52,320 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-11 15:32:52,320 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-11 15:32:52,320 - data_loader - INFO -  Normalization: robust
2025-10-11 15:32:52,320 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-11 15:32:59,503 - data_loader - INFO - Global statistics computed:
2025-10-11 15:32:59,503 - data_loader - INFO -   Mean: -55.44
2025-10-11 15:32:59,503 - data_loader - INFO -   Std: 100.41
2025-10-11 15:32:59,503 - data_loader - INFO -   Median: -125.00
2025-10-11 15:32:59,505 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-11 15:33:00,449 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-11 15:33:00,449 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-11 15:33:00,449 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-11 15:33:01,546 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-11 15:33:01,546 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-11 15:33:01,546 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-11 15:33:02,660 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-11 15:33:02,660 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-11 15:33:02,660 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-11 15:33:25,514 - data_loader - INFO - Successfully loaded 25 cases
2025-10-11 15:33:25,514 - data_loader - INFO - Loading 4 test cases...
2025-10-11 15:33:29,901 - data_loader - INFO - Final enhanced dataset:
2025-10-11 15:33:29,901 - data_loader - INFO -  Training: 25 cases
2025-10-11 15:33:29,901 - data_loader - INFO -  Validation: 4 cases
2025-10-11 15:33:29,901 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-11 15:33:29,904 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-11 15:33:29,904 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-11 15:33:30,035 - __main__ - INFO - Training dataset: 20000 episodes
2025-10-11 15:33:30,036 - __main__ - INFO - Validation dataset: 5000 episodes
2025-10-11 15:33:30,036 - __main__ - INFO - Creating Iris model...
2025-10-11 15:33:30,365 - __main__ - INFO - Model Information:
2025-10-11 15:33:30,365 - __main__ - INFO -   total_parameters: 38885850
2025-10-11 15:33:30,365 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-11 15:33:30,366 - __main__ - INFO -   embed_dim: 192
2025-10-11 15:33:30,366 - __main__ - INFO -   num_classes: 11
2025-10-11 15:33:30,366 - __main__ - INFO -   deep_supervision: False
2025-10-11 15:33:30,366 - __main__ - INFO -   multi_scale: True
2025-10-11 15:33:30,366 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-11 15:33:31,537 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-11 15:33:31,538 - fixed_episodic_trainer - INFO - Warmup iterations: 4000
2025-10-11 15:33:31,538 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-11 15:33:31,539 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-11 15:33:31,539 - __main__ - INFO - Starting training...
2025-10-11 15:33:31,539 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-11 15:33:34,926 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-11 16:09:58,018 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 16:46:22,492 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 17:59:18,836 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 18:35:46,360 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 20:25:35,158 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 21:02:06,805 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 21:38:47,886 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-11 21:38:48,635 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-12 00:53:59,999 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-12 01:30:40,929 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-12 02:07:10,904 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-12 02:43:43,017 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-12 03:20:20,138 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-12 03:45:24,689 - __main__ - INFO - Training completed! Final validation DICE: 0.5889
2025-10-12 03:45:24,773 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-12 03:45:24,776 - __main__ - INFO - ==================================================
2025-10-12 03:45:24,776 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-12 03:45:24,776 - __main__ - INFO - ==================================================
2025-10-12 03:45:24,792 - data_loader - INFO - Found 31 training cases
2025-10-12 03:45:24,792 - data_loader - INFO - Found 4 test cases
2025-10-12 03:45:24,792 - data_loader - INFO - Enhanced Dataset Info:
2025-10-12 03:45:24,792 - data_loader - INFO -  Training cases: 31
2025-10-12 03:45:24,792 - data_loader - INFO -  Test cases: 4
2025-10-12 03:45:24,792 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-12 03:45:24,792 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-12 03:45:24,792 - data_loader - INFO -  Normalization: robust
2025-10-12 03:45:24,792 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-12 03:45:31,255 - data_loader - INFO - Global statistics computed:
2025-10-12 03:45:31,255 - data_loader - INFO -   Mean: -55.44
2025-10-12 03:45:31,255 - data_loader - INFO -   Std: 100.41
2025-10-12 03:45:31,255 - data_loader - INFO -   Median: -125.00
2025-10-12 03:45:31,259 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-12 03:45:32,185 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-12 03:45:32,186 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-12 03:45:32,186 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-12 03:45:33,358 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-12 03:45:33,358 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-12 03:45:33,358 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-12 03:45:34,477 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-12 03:45:34,477 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-12 03:45:34,477 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-12 03:45:57,197 - data_loader - INFO - Successfully loaded 25 cases
2025-10-12 03:45:57,197 - data_loader - INFO - Loading 4 test cases...
2025-10-12 03:46:01,559 - data_loader - INFO - Final enhanced dataset:
2025-10-12 03:46:01,559 - data_loader - INFO -  Training: 25 cases
2025-10-12 03:46:01,559 - data_loader - INFO -  Validation: 4 cases
2025-10-12 03:46:01,560 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-12 03:46:01,578 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-12 03:46:01,579 - __main__ - INFO - Processing Sample 0:
2025-10-12 03:46:01,579 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-12 03:46:01,579 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-12 03:46:01,579 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-12 03:46:01,716 - __main__ - INFO - -------------------------
2025-10-12 03:46:01,716 - __main__ - INFO - Inference Results:
2025-10-12 03:46:01,716 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-12 03:46:01,716 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-12 03:46:01,716 - __main__ - INFO -  - Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-12 03:46:01,716 - __main__ - INFO - -------------------------
2025-10-12 03:46:01,722 - data_loader - INFO - Found 31 training cases
2025-10-12 03:46:01,723 - data_loader - INFO - Found 4 test cases
2025-10-12 03:46:01,723 - data_loader - INFO - Enhanced Dataset Info:
2025-10-12 03:46:01,723 - data_loader - INFO -  Training cases: 31
2025-10-12 03:46:01,723 - data_loader - INFO -  Test cases: 4
2025-10-12 03:46:01,723 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-12 03:46:01,723 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-12 03:46:01,723 - data_loader - INFO -  Normalization: robust
2025-10-12 03:46:01,723 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-12 03:46:07,884 - data_loader - INFO - Global statistics computed:
2025-10-12 03:46:07,885 - data_loader - INFO -   Mean: -55.44
2025-10-12 03:46:07,885 - data_loader - INFO -   Std: 100.41
2025-10-12 03:46:07,885 - data_loader - INFO -   Median: -125.00
2025-10-12 03:46:07,886 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-12 03:46:08,776 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-12 03:46:08,777 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-12 03:46:08,777 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-12 03:46:09,905 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-12 03:46:09,905 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-12 03:46:09,905 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-12 03:46:11,028 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-12 03:46:11,028 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-12 03:46:11,029 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-12 03:46:34,198 - data_loader - INFO - Successfully loaded 25 cases
2025-10-12 03:46:34,199 - data_loader - INFO - Loading 4 test cases...
2025-10-12 03:46:38,524 - data_loader - INFO - Final enhanced dataset:
2025-10-12 03:46:38,524 - data_loader - INFO -  Training: 25 cases
2025-10-12 03:46:38,524 - data_loader - INFO -  Validation: 4 cases
2025-10-12 03:46:38,525 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-12 03:46:38,528 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-12 03:46:38,555 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-14 01:14:24,385 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-14 01:14:24,385 - __main__ - INFO - ==================================================
2025-10-14 01:14:24,386 - __main__ - INFO - IRIS Framework Training
2025-10-14 01:14:24,386 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-14 01:14:24,386 - __main__ - INFO - ==================================================
2025-10-14 01:14:24,386 - __main__ - INFO - Configuration: train_config.yaml
2025-10-14 01:14:24,386 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-14 01:14:24,386 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-14 01:14:24,539 - __main__ - INFO - Using device: cuda
2025-10-14 01:14:24,539 - __main__ - INFO - Loading datasets...
2025-10-14 01:14:24,543 - data_loader - INFO - Found 31 training cases
2025-10-14 01:14:24,543 - data_loader - INFO - Found 4 test cases
2025-10-14 01:14:24,544 - data_loader - INFO - Enhanced Dataset Info:
2025-10-14 01:14:24,544 - data_loader - INFO -  Training cases: 31
2025-10-14 01:14:24,544 - data_loader - INFO -  Test cases: 4
2025-10-14 01:14:24,544 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-14 01:14:24,544 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-14 01:14:24,544 - data_loader - INFO -  Normalization: robust
2025-10-14 01:14:24,544 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-14 01:14:31,929 - data_loader - INFO - Global statistics computed:
2025-10-14 01:14:31,929 - data_loader - INFO -   Mean: -55.44
2025-10-14 01:14:31,929 - data_loader - INFO -   Std: 100.41
2025-10-14 01:14:31,929 - data_loader - INFO -   Median: -125.00
2025-10-14 01:14:31,931 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-14 01:14:32,894 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-14 01:14:32,895 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:14:32,895 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:14:33,992 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-14 01:14:33,992 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:14:33,992 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:14:35,102 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-14 01:14:35,102 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:14:35,102 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:14:58,088 - data_loader - INFO - Successfully loaded 25 cases
2025-10-14 01:14:58,088 - data_loader - INFO - Loading 4 test cases...
2025-10-14 01:15:02,611 - data_loader - INFO - Final enhanced dataset:
2025-10-14 01:15:02,611 - data_loader - INFO -  Training: 25 cases
2025-10-14 01:15:02,611 - data_loader - INFO -  Validation: 4 cases
2025-10-14 01:15:02,612 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:15:02,615 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:15:02,615 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-14 01:15:02,752 - __main__ - INFO - Training dataset: 2 episodes
2025-10-14 01:15:02,752 - __main__ - INFO - Validation dataset: 0 episodes
2025-10-14 01:15:02,752 - __main__ - INFO - Creating Iris model...
2025-10-14 01:15:03,080 - __main__ - INFO - Model Information:
2025-10-14 01:15:03,080 - __main__ - INFO -   total_parameters: 38885850
2025-10-14 01:15:03,080 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-14 01:15:03,080 - __main__ - INFO -   embed_dim: 192
2025-10-14 01:15:03,080 - __main__ - INFO -   num_classes: 11
2025-10-14 01:15:03,080 - __main__ - INFO -   deep_supervision: False
2025-10-14 01:15:03,080 - __main__ - INFO -   multi_scale: True
2025-10-14 01:15:03,080 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-14 01:15:04,299 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-14 01:15:04,299 - fixed_episodic_trainer - INFO - Warmup iterations: 4000
2025-10-14 01:15:04,299 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-14 01:15:04,300 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-14 01:15:04,300 - __main__ - INFO - Starting training...
2025-10-14 01:15:04,300 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-14 01:15:07,526 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-14 01:15:09,054 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-14 01:15:09,055 - __main__ - INFO - ==================================================
2025-10-14 01:15:09,055 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-14 01:15:09,055 - __main__ - INFO - ==================================================
2025-10-14 01:15:09,057 - data_loader - INFO - Found 31 training cases
2025-10-14 01:15:09,057 - data_loader - INFO - Found 4 test cases
2025-10-14 01:15:09,057 - data_loader - INFO - Enhanced Dataset Info:
2025-10-14 01:15:09,057 - data_loader - INFO -  Training cases: 31
2025-10-14 01:15:09,057 - data_loader - INFO -  Test cases: 4
2025-10-14 01:15:09,057 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-14 01:15:09,057 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-14 01:15:09,057 - data_loader - INFO -  Normalization: robust
2025-10-14 01:15:09,057 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-14 01:15:15,597 - data_loader - INFO - Global statistics computed:
2025-10-14 01:15:15,597 - data_loader - INFO -   Mean: -55.44
2025-10-14 01:15:15,597 - data_loader - INFO -   Std: 100.41
2025-10-14 01:15:15,597 - data_loader - INFO -   Median: -125.00
2025-10-14 01:15:15,599 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-14 01:15:16,531 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-14 01:15:16,531 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:15:16,531 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:15:17,688 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-14 01:15:17,688 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:15:17,688 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:15:18,816 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-14 01:15:18,817 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:15:18,817 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:15:41,192 - data_loader - INFO - Successfully loaded 25 cases
2025-10-14 01:15:41,193 - data_loader - INFO - Loading 4 test cases...
2025-10-14 01:15:45,442 - data_loader - INFO - Final enhanced dataset:
2025-10-14 01:15:45,442 - data_loader - INFO -  Training: 25 cases
2025-10-14 01:15:45,442 - data_loader - INFO -  Validation: 4 cases
2025-10-14 01:15:45,443 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:15:45,446 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:15:45,447 - __main__ - INFO - Processing Sample 0:
2025-10-14 01:15:45,447 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-14 01:15:45,447 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-14 01:15:45,447 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-14 01:15:45,576 - __main__ - INFO - -------------------------
2025-10-14 01:15:45,576 - __main__ - INFO - Inference Results:
2025-10-14 01:15:45,576 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-14 01:15:45,576 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-14 01:15:45,576 - __main__ - INFO -  - Dice Score: {'class_2': 0.015927940607070923, 'class_3': 0.006695439573377371, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 6.430040957638994e-05, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-14 01:15:45,576 - __main__ - INFO - -------------------------
2025-10-14 01:15:45,576 - __main__ - INFO - ================================================================================
2025-10-14 01:15:45,577 - __main__ - INFO - STARTING DEEP DEBUG INFERENCE (5 samples)
2025-10-14 01:15:45,577 - __main__ - INFO - ================================================================================
2025-10-14 01:15:45,580 - data_loader - INFO - Found 31 training cases
2025-10-14 01:15:45,580 - data_loader - INFO - Found 4 test cases
2025-10-14 01:15:45,580 - data_loader - INFO - Enhanced Dataset Info:
2025-10-14 01:15:45,580 - data_loader - INFO -  Training cases: 31
2025-10-14 01:15:45,580 - data_loader - INFO -  Test cases: 4
2025-10-14 01:15:45,580 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-14 01:15:45,580 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-14 01:15:45,580 - data_loader - INFO -  Normalization: robust
2025-10-14 01:15:45,580 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-14 01:15:51,418 - data_loader - INFO - Global statistics computed:
2025-10-14 01:15:51,419 - data_loader - INFO -   Mean: -55.44
2025-10-14 01:15:51,419 - data_loader - INFO -   Std: 100.41
2025-10-14 01:15:51,419 - data_loader - INFO -   Median: -125.00
2025-10-14 01:15:51,420 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-14 01:15:52,294 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-14 01:15:52,295 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:15:52,295 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:15:53,361 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-14 01:15:53,361 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:15:53,361 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:15:54,444 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-14 01:15:54,444 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:15:54,444 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:16:16,610 - data_loader - INFO - Successfully loaded 25 cases
2025-10-14 01:16:16,610 - data_loader - INFO - Loading 4 test cases...
2025-10-14 01:16:20,905 - data_loader - INFO - Final enhanced dataset:
2025-10-14 01:16:20,905 - data_loader - INFO -  Training: 25 cases
2025-10-14 01:16:20,906 - data_loader - INFO -  Validation: 4 cases
2025-10-14 01:16:20,906 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:16:20,910 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:16:20,914 - __main__ - INFO - [TASK] Reference Class ID: 2
2025-10-14 01:16:20,914 - __main__ - INFO - [TASK] Ref Mask Shape (Binary): torch.Size([1, 1, 64, 64, 64])
2025-10-14 01:16:20,915 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-14 01:16:20,915 - __main__ - INFO - Processing Sample 1/4
2025-10-14 01:16:21,042 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0119
2025-10-14 01:16:21,673 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_0
2025-10-14 01:16:21,877 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-14 01:16:21,877 - __main__ - INFO - Processing Sample 2/4
2025-10-14 01:16:22,015 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0127
2025-10-14 01:16:22,783 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_1
2025-10-14 01:16:23,154 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-14 01:16:23,154 - __main__ - INFO - Processing Sample 3/4
2025-10-14 01:16:23,283 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0279
2025-10-14 01:16:24,053 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_2
2025-10-14 01:16:24,259 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-14 01:16:24,259 - __main__ - INFO - Processing Sample 4/4
2025-10-14 01:16:24,389 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0141
2025-10-14 01:16:25,095 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_3
2025-10-14 01:16:25,264 - __main__ - INFO - ================================================================================
2025-10-14 01:16:25,264 - __main__ - INFO - FINAL AVG DICE over 4 samples: 0.0166
2025-10-14 01:16:25,264 - __main__ - INFO - ================================================================================
2025-10-14 01:16:25,264 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-14 01:21:29,290 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-14 01:21:29,290 - __main__ - INFO - ==================================================
2025-10-14 01:21:29,290 - __main__ - INFO - IRIS Framework Training
2025-10-14 01:21:29,290 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-14 01:21:29,290 - __main__ - INFO - ==================================================
2025-10-14 01:21:29,290 - __main__ - INFO - Configuration: train_config.yaml
2025-10-14 01:21:29,290 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-14 01:21:29,290 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-14 01:21:29,437 - __main__ - INFO - Using device: cuda
2025-10-14 01:21:29,437 - __main__ - INFO - Loading datasets...
2025-10-14 01:21:29,437 - data_loader - INFO - Found 31 training cases
2025-10-14 01:21:29,437 - data_loader - INFO - Found 4 test cases
2025-10-14 01:21:29,437 - data_loader - INFO - Enhanced Dataset Info:
2025-10-14 01:21:29,437 - data_loader - INFO -  Training cases: 31
2025-10-14 01:21:29,437 - data_loader - INFO -  Test cases: 4
2025-10-14 01:21:29,437 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-14 01:21:29,437 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-14 01:21:29,437 - data_loader - INFO -  Normalization: robust
2025-10-14 01:21:29,437 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-14 01:21:36,339 - data_loader - INFO - Global statistics computed:
2025-10-14 01:21:36,339 - data_loader - INFO -   Mean: -55.44
2025-10-14 01:21:36,339 - data_loader - INFO -   Std: 100.41
2025-10-14 01:21:36,339 - data_loader - INFO -   Median: -125.00
2025-10-14 01:21:36,341 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-14 01:21:37,253 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-14 01:21:37,253 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:21:37,253 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:21:38,361 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-14 01:21:38,361 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:21:38,361 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:21:39,476 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-14 01:21:39,476 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:21:39,476 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:22:01,824 - data_loader - INFO - Successfully loaded 25 cases
2025-10-14 01:22:01,825 - data_loader - INFO - Loading 4 test cases...
2025-10-14 01:22:06,122 - data_loader - INFO - Final enhanced dataset:
2025-10-14 01:22:06,123 - data_loader - INFO -  Training: 25 cases
2025-10-14 01:22:06,123 - data_loader - INFO -  Validation: 4 cases
2025-10-14 01:22:06,123 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 01:22:06,126 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 01:22:06,126 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-14 01:22:06,253 - __main__ - INFO - Training dataset: 40000 episodes
2025-10-14 01:22:06,253 - __main__ - INFO - Validation dataset: 10000 episodes
2025-10-14 01:22:06,253 - __main__ - INFO - Creating Iris model...
2025-10-14 01:22:06,578 - __main__ - INFO - Model Information:
2025-10-14 01:22:06,578 - __main__ - INFO -   total_parameters: 38885850
2025-10-14 01:22:06,578 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-14 01:22:06,578 - __main__ - INFO -   embed_dim: 192
2025-10-14 01:22:06,578 - __main__ - INFO -   num_classes: 11
2025-10-14 01:22:06,578 - __main__ - INFO -   deep_supervision: False
2025-10-14 01:22:06,578 - __main__ - INFO -   multi_scale: True
2025-10-14 01:22:06,578 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-14 01:22:07,312 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-14 01:22:07,312 - fixed_episodic_trainer - INFO - Warmup iterations: 4000
2025-10-14 01:22:07,312 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-14 01:22:07,313 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-14 01:22:07,314 - __main__ - INFO - Starting training...
2025-10-14 01:22:07,314 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-14 01:22:09,838 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-14 02:09:53,316 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 02:57:40,118 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 05:21:24,185 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 06:09:09,883 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 06:56:52,464 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 07:44:33,204 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 08:32:17,824 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 09:20:01,528 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-14 10:07:57,245 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 10:56:20,524 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 14:46:51,045 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-14 14:46:51,046 - __main__ - INFO - ==================================================
2025-10-14 14:46:51,046 - __main__ - INFO - IRIS Framework Training
2025-10-14 14:46:51,046 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-14 14:46:51,046 - __main__ - INFO - ==================================================
2025-10-14 14:46:51,046 - __main__ - INFO - Configuration: train_config.yaml
2025-10-14 14:46:51,046 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-14 14:46:51,046 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-14 14:46:52,657 - __main__ - INFO - Using device: cuda
2025-10-14 14:46:52,657 - __main__ - INFO - Loading datasets...
2025-10-14 14:46:52,658 - data_loader - INFO - Found 31 training cases
2025-10-14 14:46:52,658 - data_loader - INFO - Found 4 test cases
2025-10-14 14:46:52,658 - data_loader - INFO - Enhanced Dataset Info:
2025-10-14 14:46:52,658 - data_loader - INFO -  Training cases: 31
2025-10-14 14:46:52,658 - data_loader - INFO -  Test cases: 4
2025-10-14 14:46:52,658 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-14 14:46:52,658 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-14 14:46:52,658 - data_loader - INFO -  Normalization: robust
2025-10-14 14:46:52,658 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-14 14:47:00,010 - data_loader - INFO - Global statistics computed:
2025-10-14 14:47:00,010 - data_loader - INFO -   Mean: -55.44
2025-10-14 14:47:00,010 - data_loader - INFO -   Std: 100.41
2025-10-14 14:47:00,010 - data_loader - INFO -   Median: -125.00
2025-10-14 14:47:00,012 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-14 14:47:01,222 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-14 14:47:01,223 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 14:47:01,223 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 14:47:02,504 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-14 14:47:02,504 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 14:47:02,504 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 14:47:03,872 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-14 14:47:03,872 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 14:47:03,872 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 14:47:31,086 - data_loader - INFO - Successfully loaded 25 cases
2025-10-14 14:47:31,086 - data_loader - INFO - Loading 4 test cases...
2025-10-14 14:47:35,709 - data_loader - INFO - Final enhanced dataset:
2025-10-14 14:47:35,710 - data_loader - INFO -  Training: 25 cases
2025-10-14 14:47:35,710 - data_loader - INFO -  Validation: 4 cases
2025-10-14 14:47:35,710 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-14 14:47:35,713 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-14 14:47:35,713 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-14 14:47:35,866 - __main__ - INFO - Training dataset: 40000 episodes
2025-10-14 14:47:35,867 - __main__ - INFO - Validation dataset: 10000 episodes
2025-10-14 14:47:35,867 - __main__ - INFO - Creating Iris model...
2025-10-14 14:47:36,313 - __main__ - INFO - Model Information:
2025-10-14 14:47:36,313 - __main__ - INFO -   total_parameters: 38885850
2025-10-14 14:47:36,313 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-14 14:47:36,313 - __main__ - INFO -   embed_dim: 192
2025-10-14 14:47:36,313 - __main__ - INFO -   num_classes: 11
2025-10-14 14:47:36,313 - __main__ - INFO -   deep_supervision: False
2025-10-14 14:47:36,313 - __main__ - INFO -   multi_scale: True
2025-10-14 14:47:36,313 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-14 14:47:37,152 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-14 14:47:37,153 - fixed_episodic_trainer - INFO - Warmup iterations: 4000
2025-10-14 14:47:37,153 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-14 14:47:37,153 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-14 14:47:37,154 - __main__ - INFO - Starting training...
2025-10-14 14:47:37,154 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-14 14:47:39,498 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-14 19:26:34,429 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-14 19:26:34,913 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_10000.pth
2025-10-15 00:07:00,266 - fixed_episodic_trainer - INFO - Saved checkpoint: best_model.pth
2025-10-15 00:07:00,715 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_20000.pth
2025-10-15 14:29:53,719 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-15 14:29:53,719 - __main__ - INFO - ==================================================
2025-10-15 14:29:53,719 - __main__ - INFO - IRIS Framework Training
2025-10-15 14:29:53,719 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-15 14:29:53,719 - __main__ - INFO - ==================================================
2025-10-15 14:29:53,719 - __main__ - INFO - Configuration: train_config.yaml
2025-10-15 14:29:53,719 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-15 14:29:53,719 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-15 14:29:53,962 - __main__ - INFO - Using device: cuda
2025-10-15 14:29:53,963 - __main__ - INFO - Loading datasets...
2025-10-15 14:29:53,971 - data_loader - INFO - Found 31 training cases
2025-10-15 14:29:53,971 - data_loader - INFO - Found 4 test cases
2025-10-15 14:29:53,971 - data_loader - INFO - Enhanced Dataset Info:
2025-10-15 14:29:53,971 - data_loader - INFO -  Training cases: 31
2025-10-15 14:29:53,971 - data_loader - INFO -  Test cases: 4
2025-10-15 14:29:53,971 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-15 14:29:53,971 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-15 14:29:53,971 - data_loader - INFO -  Normalization: robust
2025-10-15 14:29:53,971 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-15 14:30:11,932 - data_loader - INFO - Global statistics computed:
2025-10-15 14:30:11,933 - data_loader - INFO -   Mean: -55.44
2025-10-15 14:30:11,933 - data_loader - INFO -   Std: 100.41
2025-10-15 14:30:11,933 - data_loader - INFO -   Median: -125.00
2025-10-15 14:30:11,939 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-15 14:30:16,787 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-15 14:30:16,861 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 14:30:16,861 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 14:30:21,285 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-15 14:30:21,369 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 14:30:21,369 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 14:30:25,435 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-15 14:30:25,496 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 14:30:25,496 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 14:31:38,062 - data_loader - INFO - Successfully loaded 25 cases
2025-10-15 14:31:38,062 - data_loader - INFO - Loading 4 test cases...
2025-10-15 14:31:54,614 - data_loader - INFO - Final enhanced dataset:
2025-10-15 14:31:54,615 - data_loader - INFO -  Training: 25 cases
2025-10-15 14:31:54,615 - data_loader - INFO -  Validation: 4 cases
2025-10-15 14:31:54,718 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 14:31:55,637 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 14:31:55,638 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-15 14:32:46,191 - __main__ - INFO - Training dataset: 10000 episodes
2025-10-15 14:32:46,196 - __main__ - INFO - Validation dataset: 2500 episodes
2025-10-15 14:32:46,196 - __main__ - INFO - Creating Iris model...
2025-10-15 14:32:54,071 - __main__ - INFO - Model Information:
2025-10-15 14:32:54,074 - __main__ - INFO -   total_parameters: 38885850
2025-10-15 14:32:54,074 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-15 14:32:54,075 - __main__ - INFO -   embed_dim: 192
2025-10-15 14:32:54,075 - __main__ - INFO -   num_classes: 11
2025-10-15 14:32:54,075 - __main__ - INFO -   deep_supervision: False
2025-10-15 14:32:54,075 - __main__ - INFO -   multi_scale: True
2025-10-15 14:32:54,075 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-15 14:32:56,299 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-15 14:32:56,299 - fixed_episodic_trainer - INFO - Warmup iterations: 1000
2025-10-15 14:32:56,300 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-15 14:32:56,316 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-15 14:32:56,316 - __main__ - INFO - Starting training...
2025-10-15 14:32:56,316 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-15 14:33:04,686 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-15 14:47:34,777 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-15 14:47:34,777 - __main__ - INFO - ==================================================
2025-10-15 14:47:34,777 - __main__ - INFO - IRIS Framework Training
2025-10-15 14:47:34,777 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-15 14:47:34,777 - __main__ - INFO - ==================================================
2025-10-15 14:47:34,777 - __main__ - INFO - Configuration: train_config.yaml
2025-10-15 14:47:34,777 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-15 14:47:34,777 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-15 14:47:34,898 - __main__ - INFO - Using device: cuda
2025-10-15 14:47:34,899 - __main__ - INFO - Loading datasets...
2025-10-15 14:47:34,899 - AMOS_data_loader - INFO -  Downloading AMOS dataset (this may take a while)...
2025-10-15 14:47:34,899 - __main__ - ERROR - Failed to complete training: download_and_extract() got an unexpected keyword argument 'filename'
2025-10-15 14:48:31,191 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-15 14:48:31,191 - __main__ - INFO - ==================================================
2025-10-15 14:48:31,191 - __main__ - INFO - IRIS Framework Training
2025-10-15 14:48:31,192 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-15 14:48:31,192 - __main__ - INFO - ==================================================
2025-10-15 14:48:31,192 - __main__ - INFO - Configuration: train_config.yaml
2025-10-15 14:48:31,192 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-15 14:48:31,192 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-15 14:48:31,293 - __main__ - INFO - Using device: cuda
2025-10-15 14:48:31,293 - __main__ - INFO - Loading datasets...
2025-10-15 14:48:31,293 - AMOS_data_loader - INFO -  Downloading AMOS dataset (this may take a while)...
2025-10-15 15:30:47,304 - __main__ - ERROR - Failed to complete training: <urlopen error retrieval incomplete: got only 1489335208 out of 24234336519 bytes>
2025-10-15 22:41:42,545 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-15 22:41:42,547 - __main__ - INFO - ==================================================
2025-10-15 22:41:42,547 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-15 22:41:42,547 - __main__ - INFO - ==================================================
2025-10-15 22:41:42,549 - data_loader - INFO - Found 31 training cases
2025-10-15 22:41:42,549 - data_loader - INFO - Found 4 test cases
2025-10-15 22:41:42,549 - data_loader - INFO - Enhanced Dataset Info:
2025-10-15 22:41:42,549 - data_loader - INFO -  Training cases: 31
2025-10-15 22:41:42,549 - data_loader - INFO -  Test cases: 4
2025-10-15 22:41:42,550 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-15 22:41:42,550 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-15 22:41:42,550 - data_loader - INFO -  Normalization: robust
2025-10-15 22:41:42,550 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-15 22:41:48,898 - data_loader - INFO - Global statistics computed:
2025-10-15 22:41:48,898 - data_loader - INFO -   Mean: -55.44
2025-10-15 22:41:48,898 - data_loader - INFO -   Std: 100.41
2025-10-15 22:41:48,898 - data_loader - INFO -   Median: -125.00
2025-10-15 22:41:48,900 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-15 22:41:49,810 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-15 22:41:49,811 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 22:41:49,811 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 22:41:50,922 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-15 22:41:50,922 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 22:41:50,922 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 22:41:52,045 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-15 22:41:52,045 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 22:41:52,045 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 22:42:14,741 - data_loader - INFO - Successfully loaded 25 cases
2025-10-15 22:42:14,741 - data_loader - INFO - Loading 4 test cases...
2025-10-15 22:42:19,096 - data_loader - INFO - Final enhanced dataset:
2025-10-15 22:42:19,096 - data_loader - INFO -  Training: 25 cases
2025-10-15 22:42:19,096 - data_loader - INFO -  Validation: 4 cases
2025-10-15 22:42:19,097 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 22:42:19,100 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 22:42:19,103 - __main__ - INFO - Processing Sample 0:
2025-10-15 22:42:19,103 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-15 22:42:19,103 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-15 22:42:19,103 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-15 22:42:19,230 - __main__ - INFO - -------------------------
2025-10-15 22:42:19,230 - __main__ - INFO - Inference Results:
2025-10-15 22:42:19,230 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-15 22:42:19,230 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-15 22:42:19,230 - __main__ - INFO -  - Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-15 22:42:19,230 - __main__ - INFO - -------------------------
2025-10-15 22:42:19,230 - __main__ - INFO - ================================================================================
2025-10-15 22:42:19,230 - __main__ - INFO - STARTING DEEP DEBUG INFERENCE (5 samples)
2025-10-15 22:42:19,230 - __main__ - INFO - ================================================================================
2025-10-15 22:42:19,234 - data_loader - INFO - Found 31 training cases
2025-10-15 22:42:19,234 - data_loader - INFO - Found 4 test cases
2025-10-15 22:42:19,234 - data_loader - INFO - Enhanced Dataset Info:
2025-10-15 22:42:19,234 - data_loader - INFO -  Training cases: 31
2025-10-15 22:42:19,234 - data_loader - INFO -  Test cases: 4
2025-10-15 22:42:19,234 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-15 22:42:19,234 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-15 22:42:19,234 - data_loader - INFO -  Normalization: robust
2025-10-15 22:42:19,234 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-15 22:42:25,683 - data_loader - INFO - Global statistics computed:
2025-10-15 22:42:25,683 - data_loader - INFO -   Mean: -55.44
2025-10-15 22:42:25,683 - data_loader - INFO -   Std: 100.41
2025-10-15 22:42:25,683 - data_loader - INFO -   Median: -125.00
2025-10-15 22:42:25,685 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-15 22:42:26,584 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-15 22:42:26,584 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 22:42:26,584 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 22:42:27,682 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-15 22:42:27,683 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 22:42:27,683 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 22:42:28,791 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-15 22:42:28,791 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 22:42:28,791 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 22:42:51,590 - data_loader - INFO - Successfully loaded 25 cases
2025-10-15 22:42:51,590 - data_loader - INFO - Loading 4 test cases...
2025-10-15 22:42:55,968 - data_loader - INFO - Final enhanced dataset:
2025-10-15 22:42:55,968 - data_loader - INFO -  Training: 25 cases
2025-10-15 22:42:55,968 - data_loader - INFO -  Validation: 4 cases
2025-10-15 22:42:55,968 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-15 22:42:55,971 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-15 22:42:55,976 - __main__ - INFO - [TASK] Reference Class ID: 2
2025-10-15 22:42:55,976 - __main__ - INFO - [TASK] Ref Mask Shape (Binary): torch.Size([1, 1, 64, 64, 64])
2025-10-15 22:42:55,976 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-15 22:42:55,976 - __main__ - INFO - Processing Sample 1/4
2025-10-15 22:42:56,094 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0000
2025-10-15 22:42:56,526 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_0
2025-10-15 22:42:56,706 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-15 22:42:56,706 - __main__ - INFO - Processing Sample 2/4
2025-10-15 22:42:56,818 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0000
2025-10-15 22:42:57,239 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_1
2025-10-15 22:42:57,410 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-15 22:42:57,410 - __main__ - INFO - Processing Sample 3/4
2025-10-15 22:42:57,521 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0000
2025-10-15 22:42:57,955 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_2
2025-10-15 22:42:58,129 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-15 22:42:58,129 - __main__ - INFO - Processing Sample 4/4
2025-10-15 22:42:58,242 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0000
2025-10-15 22:42:58,668 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_3
2025-10-15 22:42:58,840 - __main__ - INFO - ================================================================================
2025-10-15 22:42:58,840 - __main__ - INFO - FINAL AVG DICE over 4 samples: 0.0000
2025-10-15 22:42:58,841 - __main__ - INFO - ================================================================================
2025-10-15 22:42:58,841 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-16 03:54:52,516 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 03:54:52,517 - __main__ - INFO - ==================================================
2025-10-16 03:54:52,517 - __main__ - INFO - IRIS Framework Training
2025-10-16 03:54:52,517 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 03:54:52,517 - __main__ - INFO - ==================================================
2025-10-16 03:54:52,517 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 03:54:52,517 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 03:54:52,517 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 03:54:52,675 - __main__ - INFO - Using device: cuda
2025-10-16 03:54:52,676 - __main__ - INFO - Loading datasets...
2025-10-16 03:54:52,676 - data_loader - INFO - Found 31 training cases
2025-10-16 03:54:52,676 - data_loader - INFO - Found 4 test cases
2025-10-16 03:54:52,676 - data_loader - INFO - Enhanced Dataset Info:
2025-10-16 03:54:52,676 - data_loader - INFO -  Training cases: 31
2025-10-16 03:54:52,676 - data_loader - INFO -  Test cases: 4
2025-10-16 03:54:52,676 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-16 03:54:52,676 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-16 03:54:52,677 - data_loader - INFO -  Normalization: robust
2025-10-16 03:54:52,677 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-16 03:54:59,410 - data_loader - INFO - Global statistics computed:
2025-10-16 03:54:59,410 - data_loader - INFO -   Mean: -55.44
2025-10-16 03:54:59,410 - data_loader - INFO -   Std: 100.41
2025-10-16 03:54:59,410 - data_loader - INFO -   Median: -125.00
2025-10-16 03:54:59,412 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-16 03:55:00,328 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-16 03:55:00,329 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:55:00,329 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:55:01,442 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-16 03:55:01,442 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:55:01,442 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:55:02,562 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-16 03:55:02,562 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:55:02,563 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:56:23,052 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 03:56:23,052 - __main__ - INFO - ==================================================
2025-10-16 03:56:23,052 - __main__ - INFO - IRIS Framework Training
2025-10-16 03:56:23,052 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 03:56:23,052 - __main__ - INFO - ==================================================
2025-10-16 03:56:23,052 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 03:56:23,052 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 03:56:23,052 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 03:56:23,191 - __main__ - INFO - Using device: cuda
2025-10-16 03:56:23,191 - __main__ - INFO - Loading datasets...
2025-10-16 03:56:23,193 - AMOS_data_loader - INFO -  Downloading AMOS dataset (this may take a while)...
2025-10-16 03:56:57,074 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 03:56:57,074 - __main__ - INFO - ==================================================
2025-10-16 03:56:57,074 - __main__ - INFO - IRIS Framework Training
2025-10-16 03:56:57,074 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 03:56:57,074 - __main__ - INFO - ==================================================
2025-10-16 03:56:57,074 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 03:56:57,074 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 03:56:57,074 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 03:56:57,199 - __main__ - INFO - Using device: cuda
2025-10-16 03:56:57,200 - __main__ - INFO - Loading datasets...
2025-10-16 03:56:57,200 - data_loader - INFO - Found 31 training cases
2025-10-16 03:56:57,200 - data_loader - INFO - Found 4 test cases
2025-10-16 03:56:57,200 - data_loader - INFO - Enhanced Dataset Info:
2025-10-16 03:56:57,200 - data_loader - INFO -  Training cases: 31
2025-10-16 03:56:57,200 - data_loader - INFO -  Test cases: 4
2025-10-16 03:56:57,200 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-16 03:56:57,200 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-16 03:56:57,200 - data_loader - INFO -  Normalization: robust
2025-10-16 03:56:57,200 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-16 03:57:04,200 - data_loader - INFO - Global statistics computed:
2025-10-16 03:57:04,200 - data_loader - INFO -   Mean: -55.44
2025-10-16 03:57:04,201 - data_loader - INFO -   Std: 100.41
2025-10-16 03:57:04,201 - data_loader - INFO -   Median: -125.00
2025-10-16 03:57:04,202 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-16 03:57:05,115 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-16 03:57:05,115 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:57:05,115 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:57:06,220 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-16 03:57:06,220 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:57:06,220 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:57:07,346 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-16 03:57:07,347 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:57:07,347 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:57:30,309 - data_loader - INFO - Successfully loaded 25 cases
2025-10-16 03:57:30,309 - data_loader - INFO - Loading 4 test cases...
2025-10-16 03:57:34,614 - data_loader - INFO - Final enhanced dataset:
2025-10-16 03:57:34,614 - data_loader - INFO -  Training: 25 cases
2025-10-16 03:57:34,614 - data_loader - INFO -  Validation: 4 cases
2025-10-16 03:57:34,615 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:57:34,618 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:57:34,618 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-16 03:57:34,750 - __main__ - INFO - Training dataset: 10000 episodes
2025-10-16 03:57:34,750 - __main__ - INFO - Validation dataset: 2500 episodes
2025-10-16 03:57:34,750 - __main__ - INFO - Creating Iris model...
2025-10-16 03:57:35,076 - __main__ - INFO - Model Information:
2025-10-16 03:57:35,076 - __main__ - INFO -   total_parameters: 38885850
2025-10-16 03:57:35,076 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-16 03:57:35,076 - __main__ - INFO -   embed_dim: 192
2025-10-16 03:57:35,076 - __main__ - INFO -   num_classes: 11
2025-10-16 03:57:35,076 - __main__ - INFO -   deep_supervision: False
2025-10-16 03:57:35,076 - __main__ - INFO -   multi_scale: True
2025-10-16 03:57:35,076 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-16 03:57:35,852 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-16 03:57:35,852 - fixed_episodic_trainer - INFO - Warmup iterations: 1000
2025-10-16 03:57:35,852 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-16 03:57:35,854 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-16 03:57:35,854 - __main__ - INFO - Starting training...
2025-10-16 03:57:35,854 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-16 03:57:38,444 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-16 03:57:38,500 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-16 03:57:38,500 - __main__ - INFO - ==================================================
2025-10-16 03:57:38,500 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-16 03:57:38,500 - __main__ - INFO - ==================================================
2025-10-16 03:57:38,503 - data_loader - INFO - Found 31 training cases
2025-10-16 03:57:38,503 - data_loader - INFO - Found 4 test cases
2025-10-16 03:57:38,503 - data_loader - INFO - Enhanced Dataset Info:
2025-10-16 03:57:38,503 - data_loader - INFO -  Training cases: 31
2025-10-16 03:57:38,503 - data_loader - INFO -  Test cases: 4
2025-10-16 03:57:38,503 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-16 03:57:38,503 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-16 03:57:38,503 - data_loader - INFO -  Normalization: robust
2025-10-16 03:57:38,503 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-16 03:57:44,874 - data_loader - INFO - Global statistics computed:
2025-10-16 03:57:44,874 - data_loader - INFO -   Mean: -55.44
2025-10-16 03:57:44,874 - data_loader - INFO -   Std: 100.41
2025-10-16 03:57:44,874 - data_loader - INFO -   Median: -125.00
2025-10-16 03:57:44,876 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-16 03:57:45,772 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-16 03:57:45,772 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:57:45,772 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:57:46,873 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-16 03:57:46,873 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:57:46,873 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:57:47,981 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-16 03:57:47,981 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:57:47,981 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:58:10,950 - data_loader - INFO - Successfully loaded 25 cases
2025-10-16 03:58:10,950 - data_loader - INFO - Loading 4 test cases...
2025-10-16 03:58:15,312 - data_loader - INFO - Final enhanced dataset:
2025-10-16 03:58:15,312 - data_loader - INFO -  Training: 25 cases
2025-10-16 03:58:15,312 - data_loader - INFO -  Validation: 4 cases
2025-10-16 03:58:15,313 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:58:15,316 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:58:15,316 - __main__ - INFO - Processing Sample 0:
2025-10-16 03:58:15,317 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-16 03:58:15,317 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-16 03:58:15,317 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-16 03:58:15,444 - __main__ - INFO - -------------------------
2025-10-16 03:58:15,445 - __main__ - INFO - Inference Results:
2025-10-16 03:58:15,445 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-16 03:58:15,445 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-16 03:58:15,445 - __main__ - INFO -  - Dice Score: {'class_2': 0.01592385768890381, 'class_3': 0.006696648430079222, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 6.429627683246508e-05, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-16 03:58:15,445 - __main__ - INFO - -------------------------
2025-10-16 03:58:15,445 - __main__ - INFO - ================================================================================
2025-10-16 03:58:15,445 - __main__ - INFO - STARTING DEEP DEBUG INFERENCE (5 samples)
2025-10-16 03:58:15,445 - __main__ - INFO - ================================================================================
2025-10-16 03:58:15,448 - data_loader - INFO - Found 31 training cases
2025-10-16 03:58:15,448 - data_loader - INFO - Found 4 test cases
2025-10-16 03:58:15,448 - data_loader - INFO - Enhanced Dataset Info:
2025-10-16 03:58:15,448 - data_loader - INFO -  Training cases: 31
2025-10-16 03:58:15,449 - data_loader - INFO -  Test cases: 4
2025-10-16 03:58:15,449 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-16 03:58:15,449 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-16 03:58:15,449 - data_loader - INFO -  Normalization: robust
2025-10-16 03:58:15,449 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-16 03:58:21,901 - data_loader - INFO - Global statistics computed:
2025-10-16 03:58:21,901 - data_loader - INFO -   Mean: -55.44
2025-10-16 03:58:21,901 - data_loader - INFO -   Std: 100.41
2025-10-16 03:58:21,901 - data_loader - INFO -   Median: -125.00
2025-10-16 03:58:21,903 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-16 03:58:22,788 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-16 03:58:22,788 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:58:22,788 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:58:23,884 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-16 03:58:23,884 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:58:23,884 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:58:24,990 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-16 03:58:24,990 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:58:24,990 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:58:47,556 - data_loader - INFO - Successfully loaded 25 cases
2025-10-16 03:58:47,556 - data_loader - INFO - Loading 4 test cases...
2025-10-16 03:58:51,954 - data_loader - INFO - Final enhanced dataset:
2025-10-16 03:58:51,954 - data_loader - INFO -  Training: 25 cases
2025-10-16 03:58:51,954 - data_loader - INFO -  Validation: 4 cases
2025-10-16 03:58:51,955 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 03:58:51,957 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 03:58:51,961 - __main__ - INFO - [TASK] Reference Class ID: 2
2025-10-16 03:58:51,961 - __main__ - INFO - [TASK] Ref Mask Shape (Binary): torch.Size([1, 1, 64, 64, 64])
2025-10-16 03:58:51,961 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-16 03:58:51,961 - __main__ - INFO - Processing Sample 1/4
2025-10-16 03:58:52,033 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0158
2025-10-16 03:58:52,684 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_0
2025-10-16 03:58:52,871 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-16 03:58:52,871 - __main__ - INFO - Processing Sample 2/4
2025-10-16 03:58:52,957 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0155
2025-10-16 03:58:53,780 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_1
2025-10-16 03:58:54,120 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-16 03:58:54,120 - __main__ - INFO - Processing Sample 3/4
2025-10-16 03:58:54,350 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0217
2025-10-16 03:58:55,269 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_2
2025-10-16 03:58:55,468 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-16 03:58:55,468 - __main__ - INFO - Processing Sample 4/4
2025-10-16 03:58:55,545 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.0174
2025-10-16 03:58:56,261 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_3
2025-10-16 03:58:56,456 - __main__ - INFO - ================================================================================
2025-10-16 03:58:56,456 - __main__ - INFO - FINAL AVG DICE over 4 samples: 0.0176
2025-10-16 03:58:56,456 - __main__ - INFO - ================================================================================
2025-10-16 03:58:56,456 - __main__ - INFO - Training and demonstration completed successfully!
2025-10-16 04:02:39,955 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:02:39,955 - __main__ - INFO - ==================================================
2025-10-16 04:02:39,955 - __main__ - INFO - IRIS Framework Training
2025-10-16 04:02:39,955 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 04:02:39,955 - __main__ - INFO - ==================================================
2025-10-16 04:02:39,955 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 04:02:39,956 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 04:02:39,956 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:02:40,112 - __main__ - INFO - Using device: cuda
2025-10-16 04:02:40,112 - __main__ - INFO - Loading datasets...
2025-10-16 04:02:40,113 - data_loader - INFO - Found 31 training cases
2025-10-16 04:02:40,113 - data_loader - INFO - Found 4 test cases
2025-10-16 04:02:40,113 - data_loader - INFO - Enhanced Dataset Info:
2025-10-16 04:02:40,113 - data_loader - INFO -  Training cases: 31
2025-10-16 04:02:40,113 - data_loader - INFO -  Test cases: 4
2025-10-16 04:02:40,113 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-16 04:02:40,113 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-16 04:02:40,113 - data_loader - INFO -  Normalization: robust
2025-10-16 04:02:40,113 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-16 04:02:47,596 - data_loader - INFO - Global statistics computed:
2025-10-16 04:02:47,596 - data_loader - INFO -   Mean: -55.44
2025-10-16 04:02:47,596 - data_loader - INFO -   Std: 100.41
2025-10-16 04:02:47,596 - data_loader - INFO -   Median: -125.00
2025-10-16 04:02:47,598 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-16 04:02:48,719 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-16 04:02:48,720 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 04:02:48,720 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 04:02:49,834 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-16 04:02:49,835 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 04:02:49,835 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 04:02:50,949 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-16 04:02:50,949 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 04:02:50,949 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 04:03:16,233 - data_loader - INFO - Successfully loaded 25 cases
2025-10-16 04:03:16,234 - data_loader - INFO - Loading 4 test cases...
2025-10-16 04:03:20,644 - data_loader - INFO - Final enhanced dataset:
2025-10-16 04:03:20,644 - data_loader - INFO -  Training: 25 cases
2025-10-16 04:03:20,644 - data_loader - INFO -  Validation: 4 cases
2025-10-16 04:03:20,645 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 04:03:20,649 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 04:03:20,649 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-16 04:03:20,792 - __main__ - INFO - Training dataset: 10000 episodes
2025-10-16 04:03:20,792 - __main__ - INFO - Validation dataset: 2500 episodes
2025-10-16 04:03:20,792 - __main__ - INFO - Creating Iris model...
2025-10-16 04:03:21,138 - __main__ - INFO - Model Information:
2025-10-16 04:03:21,139 - __main__ - INFO -   total_parameters: 38885850
2025-10-16 04:03:21,139 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-16 04:03:21,139 - __main__ - INFO -   embed_dim: 192
2025-10-16 04:03:21,139 - __main__ - INFO -   num_classes: 11
2025-10-16 04:03:21,139 - __main__ - INFO -   deep_supervision: False
2025-10-16 04:03:21,139 - __main__ - INFO -   multi_scale: True
2025-10-16 04:03:21,139 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-16 04:03:21,993 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-16 04:03:21,993 - fixed_episodic_trainer - INFO - Warmup iterations: 1000
2025-10-16 04:03:21,993 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-16 04:03:21,995 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-16 04:03:21,995 - __main__ - INFO - Starting training...
2025-10-16 04:03:21,995 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-16 04:03:24,670 - fixed_episodic_trainer - INFO - Saved checkpoint: checkpoint_iter_0.pth
2025-10-16 04:09:14,563 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:09:14,563 - __main__ - INFO - ==================================================
2025-10-16 04:09:14,563 - __main__ - INFO - IRIS Framework Training
2025-10-16 04:09:14,563 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 04:09:14,563 - __main__ - INFO - ==================================================
2025-10-16 04:09:14,563 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 04:09:14,563 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 04:09:14,563 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:09:14,670 - __main__ - INFO - Using device: cuda
2025-10-16 04:09:14,671 - __main__ - INFO - Loading datasets...
2025-10-16 04:09:14,671 - AMOS_data_loader - INFO -  Downloading AMOS dataset (this may take a while)...
2025-10-16 04:09:14,671 - __main__ - ERROR - Failed to complete training: download_and_extract() got an unexpected keyword argument 'filename'
2025-10-16 04:10:35,765 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:10:35,765 - __main__ - INFO - ==================================================
2025-10-16 04:10:35,766 - __main__ - INFO - IRIS Framework Training
2025-10-16 04:10:35,766 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 04:10:35,766 - __main__ - INFO - ==================================================
2025-10-16 04:10:35,766 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 04:10:35,766 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 04:10:35,766 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:10:35,858 - __main__ - INFO - Using device: cuda
2025-10-16 04:10:35,858 - __main__ - INFO - Loading datasets...
2025-10-16 04:10:35,858 - AMOS_data_loader - INFO -  Downloading AMOS dataset (this may take a while)...
2025-10-16 04:16:17,151 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:16:17,151 - __main__ - INFO - ==================================================
2025-10-16 04:16:17,151 - __main__ - INFO - IRIS Framework Training
2025-10-16 04:16:17,151 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 04:16:17,151 - __main__ - INFO - ==================================================
2025-10-16 04:16:17,151 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 04:16:17,151 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 04:16:17,151 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:16:17,276 - __main__ - INFO - Using device: cuda
2025-10-16 04:16:17,276 - __main__ - INFO - Loading datasets...
2025-10-16 04:16:17,285 - AMOS_data_loader - INFO -  AMOS Dataset initialized successfully:
2025-10-16 04:16:17,285 - AMOS_data_loader - INFO -   Training cases: 192
2025-10-16 04:16:17,285 - AMOS_data_loader - INFO -   Validation cases: 48
2025-10-16 04:16:17,285 - AMOS_data_loader - INFO - Loaded AMOS dataset with 192 training cases
2025-10-16 04:16:25,707 - AMOS_data_loader - INFO - Train case 0: Image torch.Size([1, 64, 64, 64]), Mask torch.Size([1, 64, 64, 64])
2025-10-16 04:16:31,388 - AMOS_data_loader - INFO - Train case 1: Image torch.Size([1, 64, 64, 64]), Mask torch.Size([1, 64, 64, 64])
2025-10-16 04:16:39,186 - AMOS_data_loader - INFO - Train case 2: Image torch.Size([1, 64, 64, 64]), Mask torch.Size([1, 64, 64, 64])
2025-10-16 04:19:54,942 - AMOS_data_loader - INFO - Training: 25 | Validation: 4
2025-10-16 04:19:54,943 - __main__ - INFO - Loaded 25 training samples, 4 validation samples
2025-10-16 04:19:55,136 - __main__ - INFO - Training dataset: 10000 episodes
2025-10-16 04:19:55,136 - __main__ - INFO - Validation dataset: 2500 episodes
2025-10-16 04:19:55,136 - __main__ - INFO - Creating Iris model...
2025-10-16 04:19:55,462 - __main__ - INFO - Model Information:
2025-10-16 04:19:55,462 - __main__ - INFO -   total_parameters: 38885850
2025-10-16 04:19:55,462 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-16 04:19:55,462 - __main__ - INFO -   embed_dim: 192
2025-10-16 04:19:55,462 - __main__ - INFO -   num_classes: 11
2025-10-16 04:19:55,462 - __main__ - INFO -   deep_supervision: False
2025-10-16 04:19:55,462 - __main__ - INFO -   multi_scale: True
2025-10-16 04:19:55,462 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-16 04:19:55,687 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-16 04:19:55,687 - fixed_episodic_trainer - INFO - Warmup iterations: 1000
2025-10-16 04:19:55,687 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-16 04:19:55,688 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-16 04:19:55,689 - __main__ - INFO - Starting training...
2025-10-16 04:19:55,689 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-16 04:19:55,694 - __main__ - ERROR - Training failed with error: Input and output must have the same number of spatial dimensions, but got input with spatial dimensions of [0, 57, 57, 64] and output size of (64, 64, 64). Please provide input tensor in (N, C, d1, d2, ...,dK) format and output size in (o1, o2, ...,oK) format.
2025-10-16 04:19:55,695 - __main__ - ERROR - Failed to complete training: Input and output must have the same number of spatial dimensions, but got input with spatial dimensions of [0, 57, 57, 64] and output size of (64, 64, 64). Please provide input tensor in (N, C, d1, d2, ...,dK) format and output size in (o1, o2, ...,oK) format.
2025-10-16 04:23:01,988 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:23:01,988 - __main__ - INFO - ==================================================
2025-10-16 04:23:01,988 - __main__ - INFO - IRIS Framework Training
2025-10-16 04:23:01,988 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 04:23:01,988 - __main__ - INFO - ==================================================
2025-10-16 04:23:01,988 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 04:23:01,988 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 04:23:01,988 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:23:02,106 - __main__ - INFO - Using device: cuda
2025-10-16 04:23:02,106 - __main__ - INFO - Loading datasets...
2025-10-16 04:23:02,113 - AMOS_data_loader - INFO -  AMOS Dataset initialized successfully:
2025-10-16 04:23:02,114 - AMOS_data_loader - INFO -   Training cases: 192
2025-10-16 04:23:02,114 - AMOS_data_loader - INFO -   Validation cases: 48
2025-10-16 04:23:02,114 - AMOS_data_loader - INFO - Loaded AMOS dataset with 192 training cases
2025-10-16 04:23:10,609 - AMOS_data_loader - INFO - Train case 0: Image torch.Size([1, 57, 57, 64]), Mask torch.Size([1, 57, 57, 64])
2025-10-16 04:23:15,853 - AMOS_data_loader - INFO - Train case 1: Image torch.Size([1, 57, 57, 64]), Mask torch.Size([1, 57, 57, 64])
2025-10-16 04:23:23,051 - AMOS_data_loader - INFO - Train case 2: Image torch.Size([1, 57, 57, 64]), Mask torch.Size([1, 57, 57, 64])
2025-10-16 04:25:06,284 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:25:06,284 - __main__ - INFO - ==================================================
2025-10-16 04:25:06,284 - __main__ - INFO - IRIS Framework Training
2025-10-16 04:25:06,284 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 04:25:06,284 - __main__ - INFO - ==================================================
2025-10-16 04:25:06,284 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 04:25:06,284 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 04:25:06,284 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:25:06,452 - __main__ - INFO - Using device: cuda
2025-10-16 04:25:06,452 - __main__ - INFO - Loading datasets...
2025-10-16 04:25:06,459 - AMOS_data_loader - INFO -  AMOS Dataset initialized successfully:
2025-10-16 04:25:06,459 - AMOS_data_loader - INFO -   Training cases: 192
2025-10-16 04:25:06,459 - AMOS_data_loader - INFO -   Validation cases: 48
2025-10-16 04:25:06,459 - AMOS_data_loader - INFO - Loaded AMOS dataset with 192 training cases
2025-10-16 04:25:15,415 - AMOS_data_loader - INFO - Train case 0: Image torch.Size([1, 64, 64, 64]), Mask torch.Size([1, 64, 64, 64])
2025-10-16 04:25:21,216 - AMOS_data_loader - INFO - Train case 1: Image torch.Size([1, 64, 64, 64]), Mask torch.Size([1, 64, 64, 64])
2025-10-16 04:25:28,789 - AMOS_data_loader - INFO - Train case 2: Image torch.Size([1, 64, 64, 64]), Mask torch.Size([1, 64, 64, 64])
2025-10-16 04:25:56,992 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:25:56,992 - __main__ - INFO - ==================================================
2025-10-16 04:25:56,992 - __main__ - INFO - IRIS Framework Training
2025-10-16 04:25:56,992 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 04:25:56,992 - __main__ - INFO - ==================================================
2025-10-16 04:25:56,992 - __main__ - INFO - Configuration: train_config.yaml
2025-10-16 04:25:56,992 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 04:25:56,992 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:25:57,110 - __main__ - INFO - Using device: cuda
2025-10-16 04:25:57,110 - __main__ - INFO - Loading datasets...
2025-10-16 04:25:57,116 - AMOS_data_loader - INFO -  AMOS Dataset initialized successfully:
2025-10-16 04:25:57,117 - AMOS_data_loader - INFO -   Training cases: 192
2025-10-16 04:25:57,117 - AMOS_data_loader - INFO -   Validation cases: 48
2025-10-16 04:25:57,117 - AMOS_data_loader - INFO - Loaded AMOS dataset with 192 training cases
2025-10-16 04:26:27,152 - __main__ - INFO - Logging initialized. Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:26:27,152 - __main__ - INFO - ==================================================
2025-10-16 04:26:27,152 - __main__ - INFO - IRIS Framework Training
2025-10-16 04:26:27,152 - __main__ - INFO - Universal Medical Image Segmentation via In-Context Learning
2025-10-16 04:26:27,152 - __main__ - INFO - ==================================================
2025-10-16 04:26:27,152 - __main__ - INFO - Configuration: train_config_2.yaml
2025-10-16 04:26:27,152 - __main__ - INFO - Experiment: iris_universal_segmentation
2025-10-16 04:26:27,152 - __main__ - INFO - Output directory: outputs/training/iris_universal_segmentation
2025-10-16 04:26:27,254 - __main__ - INFO - Using device: cuda
2025-10-16 04:26:27,255 - __main__ - INFO - Loading datasets...
2025-10-16 04:26:27,261 - AMOS_data_loader - INFO -  AMOS Dataset initialized successfully:
2025-10-16 04:26:27,261 - AMOS_data_loader - INFO -   Training cases: 192
2025-10-16 04:26:27,261 - AMOS_data_loader - INFO -   Validation cases: 48
2025-10-16 04:26:27,261 - AMOS_data_loader - INFO - Loaded AMOS dataset with 192 training cases
2025-10-16 04:26:36,533 - AMOS_data_loader - INFO - Train case 0: Image torch.Size([1, 57, 57, 64]), Mask torch.Size([1, 57, 57, 64])
2025-10-16 04:26:42,263 - AMOS_data_loader - INFO - Train case 1: Image torch.Size([1, 57, 57, 64]), Mask torch.Size([1, 57, 57, 64])
2025-10-16 04:26:50,564 - AMOS_data_loader - INFO - Train case 2: Image torch.Size([1, 57, 57, 64]), Mask torch.Size([1, 57, 57, 64])
2025-10-16 04:54:30,903 - AMOS_data_loader - INFO - Training: 192 | Validation: 48
2025-10-16 04:54:30,904 - __main__ - INFO - Loaded 192 training samples, 48 validation samples
2025-10-16 04:54:32,415 - __main__ - INFO - Training dataset: 10000 episodes
2025-10-16 04:54:32,415 - __main__ - INFO - Validation dataset: 2500 episodes
2025-10-16 04:54:32,415 - __main__ - INFO - Creating Iris model...
2025-10-16 04:54:32,742 - __main__ - INFO - Model Information:
2025-10-16 04:54:32,742 - __main__ - INFO -   total_parameters: 38885850
2025-10-16 04:54:32,742 - __main__ - INFO -   trainable_parameters: 38885850
2025-10-16 04:54:32,742 - __main__ - INFO -   embed_dim: 192
2025-10-16 04:54:32,742 - __main__ - INFO -   num_classes: 11
2025-10-16 04:54:32,742 - __main__ - INFO -   deep_supervision: False
2025-10-16 04:54:32,742 - __main__ - INFO -   multi_scale: True
2025-10-16 04:54:32,742 - __main__ - INFO -   model_size_mb: 148.3377456665039
2025-10-16 04:54:32,979 - fixed_episodic_trainer - INFO - Using Lamb optimizer with lr=0.001, wd=0.0001
2025-10-16 04:54:32,979 - fixed_episodic_trainer - INFO - Warmup iterations: 1000
2025-10-16 04:54:32,979 - fixed_episodic_trainer - INFO - Save interval: 10000
2025-10-16 04:54:32,980 - __main__ - INFO - Tensorboard logging enabled: outputs/training/iris_universal_segmentation/tensorboard
2025-10-16 04:54:32,980 - __main__ - INFO - Starting training...
2025-10-16 04:54:32,980 - fixed_episodic_trainer - INFO - Starting fixed episodic training...
2025-10-16 04:54:32,988 - __main__ - ERROR - Training failed with error: Input and output must have the same number of spatial dimensions, but got input with spatial dimensions of [0, 51, 56, 64] and output size of (57, 57, 64). Please provide input tensor in (N, C, d1, d2, ...,dK) format and output size in (o1, o2, ...,oK) format.
2025-10-16 04:54:32,989 - __main__ - ERROR - Failed to complete training: Input and output must have the same number of spatial dimensions, but got input with spatial dimensions of [0, 51, 56, 64] and output size of (57, 57, 64). Please provide input tensor in (N, C, d1, d2, ...,dK) format and output size in (o1, o2, ...,oK) format.
2025-10-16 08:14:35,627 - __main__ - INFO - Training history saved to outputs/training/iris_universal_segmentation/training_history.pth
2025-10-16 08:14:35,628 - __main__ - INFO - ==================================================
2025-10-16 08:14:35,628 - __main__ - INFO - Running Real Inference (Single Sample)
2025-10-16 08:14:35,629 - __main__ - INFO - ==================================================
2025-10-16 08:14:35,631 - data_loader - INFO - Found 31 training cases
2025-10-16 08:14:35,631 - data_loader - INFO - Found 4 test cases
2025-10-16 08:14:35,631 - data_loader - INFO - Enhanced Dataset Info:
2025-10-16 08:14:35,631 - data_loader - INFO -  Training cases: 31
2025-10-16 08:14:35,631 - data_loader - INFO -  Test cases: 4
2025-10-16 08:14:35,631 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-16 08:14:35,631 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-16 08:14:35,631 - data_loader - INFO -  Normalization: robust
2025-10-16 08:14:35,631 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-16 08:14:42,184 - data_loader - INFO - Global statistics computed:
2025-10-16 08:14:42,185 - data_loader - INFO -   Mean: -55.44
2025-10-16 08:14:42,185 - data_loader - INFO -   Std: 100.41
2025-10-16 08:14:42,185 - data_loader - INFO -   Median: -125.00
2025-10-16 08:14:42,186 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-16 08:14:43,111 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-16 08:14:43,111 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 08:14:43,111 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 08:14:44,227 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-16 08:14:44,228 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 08:14:44,228 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 08:14:45,348 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-16 08:14:45,348 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 08:14:45,348 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 08:15:08,111 - data_loader - INFO - Successfully loaded 25 cases
2025-10-16 08:15:08,111 - data_loader - INFO - Loading 4 test cases...
2025-10-16 08:15:12,483 - data_loader - INFO - Final enhanced dataset:
2025-10-16 08:15:12,484 - data_loader - INFO -  Training: 25 cases
2025-10-16 08:15:12,484 - data_loader - INFO -  Validation: 4 cases
2025-10-16 08:15:12,484 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 08:15:12,487 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 08:15:12,488 - __main__ - INFO - Processing Sample 0:
2025-10-16 08:15:12,488 - __main__ - INFO -  - Query Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-16 08:15:12,488 - __main__ - INFO -  - Reference Image Shape: torch.Size([1, 1, 64, 64, 64])
2025-10-16 08:15:12,488 - __main__ - INFO -  - Reference Mask Shape: torch.Size([1, 64, 64, 64])
2025-10-16 08:15:12,620 - __main__ - INFO - -------------------------
2025-10-16 08:15:12,620 - __main__ - INFO - Inference Results:
2025-10-16 08:15:12,620 - __main__ - INFO -  - Predicted Mask Shape: torch.Size([1, 11, 64, 64, 64])
2025-10-16 08:15:12,620 - __main__ - INFO -  - Task Embedding Shape: torch.Size([1, 7, 192])
2025-10-16 08:15:12,620 - __main__ - INFO -  - Dice Score: {'class_2': 0.0, 'class_3': 0.0, 'class_4': 0.0, 'class_5': 0.0, 'class_6': 0.0, 'class_7': 0.0, 'class_8': 0.0, 'class_9': 0.0, 'class_10': 0.0}
2025-10-16 08:15:12,620 - __main__ - INFO - -------------------------
2025-10-16 08:15:12,620 - __main__ - INFO - ================================================================================
2025-10-16 08:15:12,620 - __main__ - INFO - STARTING DEEP DEBUG INFERENCE (5 samples)
2025-10-16 08:15:12,620 - __main__ - INFO - ================================================================================
2025-10-16 08:15:12,623 - data_loader - INFO - Found 31 training cases
2025-10-16 08:15:12,623 - data_loader - INFO - Found 4 test cases
2025-10-16 08:15:12,623 - data_loader - INFO - Enhanced Dataset Info:
2025-10-16 08:15:12,623 - data_loader - INFO -  Training cases: 31
2025-10-16 08:15:12,623 - data_loader - INFO -  Test cases: 4
2025-10-16 08:15:12,623 - data_loader - INFO -  Target size: (64, 64, 64)
2025-10-16 08:15:12,623 - data_loader - INFO -  Target spacing: (1.5, 1.0, 1.0)
2025-10-16 08:15:12,623 - data_loader - INFO -  Normalization: robust
2025-10-16 08:15:12,623 - data_loader - INFO - Computing global statistics from 31 cases...
2025-10-16 08:15:18,866 - data_loader - INFO - Global statistics computed:
2025-10-16 08:15:18,866 - data_loader - INFO -   Mean: -55.44
2025-10-16 08:15:18,866 - data_loader - INFO -   Std: 100.41
2025-10-16 08:15:18,866 - data_loader - INFO -   Median: -125.00
2025-10-16 08:15:18,868 - data_loader - INFO - Loading 25 training cases with enhanced preprocessing...
2025-10-16 08:15:19,764 - data_loader - INFO - Loaded AUTO_SEG_1:
2025-10-16 08:15:19,765 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 08:15:19,765 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 08:15:20,861 - data_loader - INFO - Loaded AUTO_SEG_10:
2025-10-16 08:15:20,861 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 08:15:20,861 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 08:15:21,959 - data_loader - INFO - Loaded AUTO_SEG_11:
2025-10-16 08:15:21,959 - data_loader - INFO -   Image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 08:15:21,959 - data_loader - INFO -   Mask: torch.Size([64, 64, 64]), labels=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 08:15:44,588 - data_loader - INFO - Successfully loaded 25 cases
2025-10-16 08:15:44,588 - data_loader - INFO - Loading 4 test cases...
2025-10-16 08:15:48,955 - data_loader - INFO - Final enhanced dataset:
2025-10-16 08:15:48,956 - data_loader - INFO -  Training: 25 cases
2025-10-16 08:15:48,956 - data_loader - INFO -  Validation: 4 cases
2025-10-16 08:15:48,956 - data_loader - INFO -  Sample image: torch.Size([1, 64, 64, 64]), range=[0.000, 1.000]
2025-10-16 08:15:48,959 - data_loader - INFO -  Sample mask: torch.Size([64, 64, 64]), classes=[0, 2, 3, 4, 5, 6, 7, 8, 9, 10]
2025-10-16 08:15:48,963 - __main__ - INFO - [TASK] Reference Class ID: 2
2025-10-16 08:15:48,963 - __main__ - INFO - [TASK] Ref Mask Shape (Binary): torch.Size([1, 1, 64, 64, 64])
2025-10-16 08:15:48,963 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-16 08:15:48,963 - __main__ - INFO - Processing Sample 1/4
2025-10-16 08:15:49,036 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.5468
2025-10-16 08:15:49,494 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_0
2025-10-16 08:15:49,672 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-16 08:15:49,672 - __main__ - INFO - Processing Sample 2/4
2025-10-16 08:15:49,744 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.6005
2025-10-16 08:15:50,187 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_1
2025-10-16 08:15:50,357 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-16 08:15:50,357 - __main__ - INFO - Processing Sample 3/4
2025-10-16 08:15:50,429 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.6207
2025-10-16 08:15:50,880 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_2
2025-10-16 08:15:51,050 - __main__ - INFO - --------------------------------------------------------------------------------
2025-10-16 08:15:51,050 - __main__ - INFO - Processing Sample 4/4
2025-10-16 08:15:51,127 - __main__ - INFO - [METRIC] Dice Score (Task 2 overlap): 0.5543
2025-10-16 08:15:51,574 - __main__ - INFO - [FILES] Debug files saved to: outputs/training/iris_universal_segmentation/debug_inference/sample_3
2025-10-16 08:15:51,748 - __main__ - INFO - ================================================================================
2025-10-16 08:15:51,748 - __main__ - INFO - FINAL AVG DICE over 4 samples: 0.5806
2025-10-16 08:15:51,748 - __main__ - INFO - ================================================================================
2025-10-16 08:15:51,749 - __main__ - INFO - Training and demonstration completed successfully!
